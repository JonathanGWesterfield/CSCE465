<html><head><title>18.4. IKE Phases</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch18lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch18lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch18lev1sec4"></a>
<h3 id="title-IDACUM5D" class="docSection1Title">18.4. IKE Phases</h3>
<p class="docText">IKE defines two phases. Phase 1 does mutual authentication and establishes session keys. It is based on identities such as names, and secrets such as public key pairs, or pre-shared secrets between the two entities. Then using the keys established in phase 1, multiple phase-2 SAs between the same pair of entities can be established. The phase-1 exchange is known as the ISAKMP SA, or sometimes it is referred to as the IKE SA. An ESP or AH SA would be established through phase 2.</p>
<p class="docText">Why not just establish an ESP or AH SA in a single exchange and not bother with a separate phase 2? It would certainly be simpler and cheaper to just set up an SA in a single exchange, and do away with the phases, but the theory is that although the phase-1 exchange is necessarily expensive (if based on public keys), the phase-2 exchanges can then be simpler and less expensive because they can use the session key created out of the phase-1 exchange. This reasoning only makes sense if there <span class="docEmphasis">will</span> be multiple phase-2 setups inside the same phase-1 exchange. Here are some arguments people give for the two phases:</p>
<ul><li><p class="docList">The ISAKMP designers assumed ISAKMP would be used by more than just IPsec, and in addition to setting up IPsec (e.g., AH, ESP) SAs, it might be used to establish SAs for other protocols. The IETF even assigned values for DOI for some routing protocols such as RIP and OSPF, but never wound up designing exchanges for them. And indeed since those protocols run on top of IP, they didn't need their own protocol. They could use IPsec.</p></li><li><p class="docList">Some people advocate setting up different SAs for different traffic <span class="docEmphStrong">flows</span> (conversations). In that case, a firewall-to-firewall link might require many SAs, one perhaps for each source/ destination/port pair. Even if the SA is end-to-end, there might be multiple processes on one machine talking to processes on the other.</p><p class="docList">The concern is that there might be security weaknesses if different flows used the same key. Indeed such a weakness was discovered if the SA used encryption only (no integrity protection). Imagine two machines <span class="docEmphasis">M</span><sub>1</sub> and <span class="docEmphasis">M</span><sub>2</sub> with an SA over which traffic for many source/destination pairs flows. The source/destination pairs might be applications on <span class="docEmphasis">M</span><sub>1</sub> and <span class="docEmphasis">M</span><sub>2</sub>, or <span class="docEmphasis">M</span><sub>1</sub> and <span class="docEmphasis">M</span><sub>2</sub> might be firewalls forwarding traffic from one portion of the net to machines on another portion of the net. Suppose there are conversations between <span class="docEmphasis">A</span> and <span class="docEmphasis">B</span>, and between <span class="docEmphasis">C</span> and <span class="docEmphasis">D</span> that go through the <span class="docEmphasis">M</span><sub>1</sub>-<span class="docEmphasis">M</span><sub>2</sub> SA. If <span class="docEmphasis">C</span> wants to decrypt a packet sent by <span class="docEmphasis">A</span> to <span class="docEmphasis">B</span>, then it can record an encrypted packet between <span class="docEmphasis">A</span> and <span class="docEmphasis">B</span>, and between <span class="docEmphasis">C</span> and <span class="docEmphasis">D</span>, and splice the first encrypted part (the part that contains the source and destination) from the <span class="docEmphasis">C</span>-<span class="docEmphasis">D</span> packet onto the <span class="docEmphasis">A</span>-<span class="docEmphasis">B</span> encrypted packet, and forward the packet to <span class="docEmphasis">M</span><sub>2</sub>. <span class="docEmphasis">M</span><sub>2</sub> will decrypt the spliced packet, deliver the decrypted data from the <span class="docEmphasis">A</span>-<span class="docEmphasis">B</span> packet to <span class="docEmphasis">D</span> (because the initial portion of the packet was spliced from a packet that indicated <span class="docEmphasis">M</span><sub>2</sub> should forward the packet to <span class="docEmphasis">D</span>).</p><p class="docList"><a name="iddle1021"></a><a name="iddle1593"></a>This is not an issue if integrity protection is used, because the spliced packet would not pass the integrity check, and there is no excuse for ever using encryption without integrity protection. But because of this bug with multiplexing flows over an encryption-only SA, some people think it is safer not to multiplex flows over an SA. Without multiplexing flows, there might then be many SAs between the same pair of machines.</p></li><li><p class="docList">Key rollover is cheaper using phase 2 rather than restarting the phase-1 connection setup.</p></li><li><p class="docList">You can set up multiple connections with different security properties, such as integrity-only, encryption with a short (insecure, snooper-friendly) key, or encryption with a long key. We disagree with this since it would seem logical to use the strongest protection needed by any of the traffic for <span class="docEmphasis">all</span> the traffic rather than having separate SAs in order to give weaker protection to some traffic. There might be some legal or performance reasons to want to use different protection for different forms of traffic, but this should be a relatively rare case not worth optimizing for. A cleaner method of doing this would be to have completely different SAs rather than multiple SAs loosely linked together with the same phase-1 SA.</p></li></ul>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch18lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch18lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>