<html><head><title>14.8. Cryptographic Algorithms</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec7.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec9.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch14lev1sec8"></a>
<h3 id="title-IDAMGOBD" class="docSection1Title">14.8. Cryptographic Algorithms</h3>
<p class="docText">Kerberos V4 assumes DES is the encryption algorithm. There are two problems with DES. One is that it is not secure enough for high-security environments. The other is that it is considered by the U.S. government to be too secure to export. Kerberos V5 is designed in a modular way which allows insertion of different encryption algorithms. When encryption is used, there is a type field allowing the receiver to know which decryption algorithm to use.</p>
<p class="docText">Since different encryption systems use different-length keys, and since some encryption systems allow variable-length keys, in V5 keys are tagged with a type and length.</p>
<p class="docText">DES continues to be used in all actual implementations of Kerberos (to our knowledge). Two cryptographic weaknesses in Kerberos V4 (modified Jueneman checksum, which was used for integrity protection without encryption, and PCBC, which was used for encryption and integrity protection) were repaired.</p>
<a name="ch14lev2sec3"></a>
<h4 id="title-IDA4GOBD" class="docSection2Title">14.8.1. Integrity-Only Algorithms</h4>
<p class="docText"><a name="iddle1173"></a><a name="iddle1585"></a><a name="iddle1645"></a>The modified Jueneman checksum used in Kerberos V4, while never (publicly) broken, was not considered sufficiently secure (see &sect;<a class="docLink" href="ch13lev1sec10.html#ch13lev1sec10">13.10</a> <span class="docEmphasis">Encryption for Integrity Only</span>). So in V5 it was replaced by a choice of algorithms.</p>
<p class="docText">Why did V5 not simply choose one known-to-be-secure integrity protection algorithm? No algorithm is ever known to be secure. It's just not known to be broken. So V5 selected a few algorithms, with the intent that if a serious cryptographic flaw was found in one of the algorithms being used, a different one could be substituted without changing the rest of the implementation. Unfortunately, if a recipient does not accept all defined algorithms, there is a possibility of non-interoperability (acceptable algorithms are not negotiated). Another problem with having a choice of algorithms is that Kerberos is really only as secure as the weakest algorithm the recipient will accept rather than the strongest. The reason for this is that if one algorithm is weak, then even if your implementation does not transmit it, a forger could use the weak algorithm to impersonate you to any implementation which accepts it.</p>
<p class="docText">If Kerberos V5 were designed today, the algorithms of choice would probably be AES-CBC and HMAC-SHA-1. Kerberos V5 does something probably equivalent in terms of security, but harder to explain. Much harder to explain, as a matter of fact. We agonized as to whether to bother you with the details. The algorithms are baroque and technically uninteresting. There never would be a reason to implement them except to be compatible with a Kerberos V5 implementation. But in the interest of completeness, we'll explain them here.</p>
<p class="docText">Kerberos V5 documentation refers to an integrity check as a <i><a class="docLink" href="app02.html#gloss01_040">checksum</a></i>. We prefer the term <i><a class="docLink" href="app02.html#gloss01_124">MAC</a></i> (message authentication code). The MACs specified in V5 are as follows, using the names in the Kerberos documentation. Three of them are required to be supported by implementations. The other two are optional.</p>
<ul><li><p class="docList"><span class="docEmphRomanAlt">rsa-md5-des</span> (required)</p></li><li><p class="docList"><span class="docEmphRomanAlt">des-mac</span> (required)</p></li><li><p class="docList"><span class="docEmphRomanAlt">des-mac-k</span> (required)</p></li><li><p class="docList"><span class="docEmphRomanAlt">rsa-md4-des</span> (optional)</p></li><li><p class="docList"><span class="docEmphRomanAlt">rsa-md4-des-k</span> (optional)</p></li></ul>
<a name="ch14lev3sec1"></a>
<h5 id="title-IDAJKOBD" class="docSection3Title">14.8.1.1. rsa-md5-des</h5>
<p class="docText">This MAC is one of the required ones. The name is not particularly helpful, except that it's a combination of <span class="docEmphRomanAlt">md5</span> and <span class="docEmphRomanAlt">des</span>. It has nothing to do with RSA other than that RSADSI (the company) owns rights to MD5, which is freely distributable provided that RSADSI is credited with every mention of it (or some such legalism).</p>
<p class="docText"><a name="iddle1202"></a>The way the MAC is calculated is as follows:</p>
<a name="ch14pro01"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Choose a 64-bit random number, known as a <span class="docEmphStrong">confounder.</span><br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Prepend it to the message:<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="2"><col width="100"></col><col width="300"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">confounder</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Calculate the MD5 message digest of the result, getting a 128-bit quantity.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Prepend the confounder chosen in Step 1 to the message digest:<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="2"><col width="100"></col><col width="300"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText">64 bits</p></td><td class="docTableCell" align="center" valign="top"><p class="docText">128 bits</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">confounder</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message digest</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Calculate a modified key by taking the KDC-supplied shared secret key and <img src="U2295.GIF" border="0" />ing it with F0F0F0F0F0F0F0F0<sub>16</sub>. Call the result <span class="docEmphasis">K</span>'.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>6. </b></div></td><td><div class="docText">Encrypt the result, using DES in CBC mode, using <span class="docEmphasis">K</span>' and an IV (initialization vector) of 0, resulting in a 192-bit encrypted quantity. That 192-bit quantity is the MAC.<br /><br /></div></td></tr></table>
<p class="docText">How is this MAC verified? It's actually quite straightforward. You just reverse all the steps.</p>
<a name="ch14pro02"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Calculate the modified key, by performing Step 5 above (<img src="U2295.GIF" border="0" />ing the KDC-supplied shared secret key with F0F0F0F0F0F0F0F0<sub>16</sub> to get <span class="docEmphasis">K</span>').<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Decrypt the MAC, using <span class="docEmphasis">K</span>' in CBC mode, resulting in a 192-bit quantity. Let's call the first 64 bits of the decrypted quantity <span class="docEmphasis">X</span>, and the remainder <span class="docEmphasis">Y</span>:<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="2"><col width="100"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText">64 bits</p></td><td class="docTableCell" align="center" valign="top"><p class="docText">128 bits</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">X</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">Y</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">The first 64 bits of the result (<span class="docEmphasis">X</span>) should be the confounder. To verify that, append <span class="docEmphasis">X</span> to the message, and calculate the MD5 message digest of the result.<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="2"><col width="100"></col><col width="250"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">X</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">If the 128-bit result matches <span class="docEmphasis">Y</span>, then the MAC is verified as valid.<br /><br /></div></td></tr></table>
<a name="ch14lev3sec2"></a>
<h5 id="title-IDA5TOBD" class="docSection3Title">14.8.1.2. des-mac</h5>
<p class="docText">This is another of the required MACs. To calculate it do the following:</p>
<a name="ch14pro03"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Choose a 64-bit random number, known as a <span class="docEmphStrong">confounder</span>.<br /><br /></div></td></tr><tr><td></td><td></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Prepend it to the message:<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="2"><col width="100"></col><col width="300"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">confounder</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Calculate the DES CBC residue of the result (confounder prepended to the message) using the unmodified KDC-supplied shared secret key <span class="docEmphasis">K</span>, and using an IV of 0. The result is a 64-bit quantity we'll call <span class="docEmphasis">R</span>, for the <span class="docEmphasis">Residue</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Calculate the modified key <span class="docEmphasis">K</span>' = <span class="docEmphasis">K</span> <img src="U2295.GIF" border="0" /> F0F0F0F0F0F0F0F0<sub>16</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Prepend the 64-bit confounder <span class="docEmphasis">C</span> to the 64-bit residue <span class="docEmphasis">R</span>, getting a 128-bit value.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>6. </b></div></td><td><div class="docText">Perform DES encryption in CBC mode on the 128-bit <span class="docEmphasis">C</span>|<span class="docEmphasis">R</span> from the previous step, using <span class="docEmphasis">K</span>' as the key, and an IV of 0.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>7. </b></div></td><td><div class="docText">The result is the 128-bit MAC.<br /><br /></div></td></tr></table>
<p class="docText">Verifying this MAC is straightforward (see <a class="docLink" href="ch14lev1sec16.html#ch14qa1q9">Homework Problem 9</a>).</p>
<a name="ch14lev3sec3"></a>
<h5 id="title-IDANYOBD" class="docSection3Title">14.8.1.3. des-mac-k</h5>
<p class="docText">This is another of the MACs which are required. The MACs that end with &quot;-k&quot; in their name are the old-style ones, before it occurred to the Kerberos designers that using a modified key would be a good idea. These are no longer recommended, but need to be implemented for backward compatibility.</p>
<p class="docText">This MAC is calculated by doing a CBC-residue over the message using the original key <span class="docEmphasis">K</span>, and using <span class="docEmphasis">K</span> also as the IV. The MAC is verified the same way.</p>
<a name="ch14lev3sec4"></a>
<h5 id="title-IDAAZOBD" class="docSection3Title">14.8.1.4. rsa-md4-des</h5>
<p class="docText">This MAC is the same as <span class="docEmphRomanAlt">rsa-md5-des</span>, except that MD4 is used instead of MD5.</p>
<a name="ch14lev3sec5"></a>
<h5 id="title-IDARZOBD" class="docSection3Title">14.8.1.5. rsa-md4-des-k</h5>
<p class="docText">This MAC is no longer recommended, and is only there for backward compatibility. Again, the &quot;-k&quot; in the name indicates that it was designed before the Kerberos designers realized it would be a good idea to use a modified version of the key for calculating the MAC.</p>
<p class="docText">This MAC is calculated as follows. First calculate MD4 of the message, yielding 128 bits (16 octets). Take the result and encrypt it using DES in CBC mode, with the unmodified session key <span class="docEmphasis">K</span> used as both the encryption key and the IV. The 128-bit result of the encryption is the MAC.</p>
<a name="ch14lev2sec4"></a>
<h4 id="title-IDAG0OBD" class="docSection2Title">14.8.2. Encryption for Privacy and Integrity</h4>
<p class="docText"><a name="iddle1644"></a><a name="iddle1892"></a>The algorithms in this section provide encryption and integrity protection. The idea is to have an algorithm that not only encrypts the data, but allows Kerberos, when decrypting it, to detect if the message has been altered since being transmitted by the source.</p>
<p class="docText">The three algorithms are known in the Kerberos documentation as <span class="docEmphRomanAlt">des-cbc-crc</span>, <span class="docEmphRomanAlt">des-cbc-md4</span>, and <span class="docEmphRomanAlt">des-cbc-md5</span>. The basic idea is that a checksum is combined with the message, and then the message is encrypted with DES in CBC mode. The algorithms use the checksums <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_056">CRC-32</a></span>, MD4, and MD5, respectively. All the algorithms do the following:</p>
<a name="ch14pro04"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Choose a 64-bit random number known in the Kerberos documentation as a <span class="docEmphStrong">confounder</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Create the following data structure, where the field <span class="docEmphSmaller">CHECKSUM</span> is filled with zeroes and is of the right length for the checksum algorithm of choice (32 bits for <span class="docEmphRomanAlt">des-cbc-crc</span> and 128 bits for the others):<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="3"><col width="150"></col><col width="150"></col><col width="150"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">confounder</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">checksum</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Calculate the appropriate checksum over the above data structure.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Fill in the result in the <span class="docEmphSmaller">CHECKSUM</span> field<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Add enough padding to make the data structure an integral number of 64-bit chunks:<br /><br />
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="center" span="4"><col width="125"></col><col width="125"></col><col width="125"></col><col width="125"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">confounder</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">checksum</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">message</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">padding</span></p></td></tr></table></p><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>6. </b></div></td><td><div class="docText">Encrypt the result using DES in CBC mode with an IV of 0.<br /><br /></div></td></tr></table>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec7.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec9.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>