<html><head><title>25.6. Other Web Security Problems</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch25lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch25lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch25lev1sec6"></a>
<h3 id="title-IDAMO2GJ" class="docSection1Title">25.6. Other Web Security Problems</h3>
<a name="ch25lev2sec4"></a>
<h4 id="title-IDAVO2GJ" class="docSection2Title">25.6.1. Spoofing a Site to a User</h4>
<p class="docText">Suppose you want to trick a user into thinking he is visiting, say, his stock broker site, (say <span class="docEmphRomanAlt">respectablestockbroker.com</span>), but instead he is visiting <span class="docEmphRomanAlt">EmbezzlersInc</span>. Let's say that <span class="docEmphRomanAlt">EmbezzlersInc</span> manages to convince the manager of the domains under country code <span class="docEmphRomanAlt">tv</span> to give it an innocuous sounding name like <span class="docEmphRomanAlt">gg.tv</span>. If <span class="docEmphRomanAlt">EmbezzlersInc</span> can trick you into thinking they are your stock broker, they can connect to the site you want to talk to and act as a man-in-the-middle, learning your password, and then being able to make stock trades with your money. One would hope that using SSL would make this impossible. However, using SSL you can be assured you are talking to the correct site if:</p>
<ul><li><p class="docList"><span class="docEmphasis">None</span> of the CAs you trust ever accidentally or maliciously issued a certificate certifying <span class="docEmphRomanAlt">EmbezzlersInc</span>'s public key as belonging to the name <span class="docEmphRomanAlt">respectablestockbroker.com</span>.</p></li><li><p class="docList">Nobody maliciously or accidentally modified your configured list of trusted CA public keys to include the key of a disreputable organization.</p></li><li><p class="docList">You carefully check the URL at the top of your browser page to make sure that you are indeed connected to respectablestockbroker.com. You also check the little lock at the bottom of your browser page to make sure the connection is using SSL. But URLs can be very confusing. Where does the URL</p><blockquote><p></p><p class="docList"><span class="docEmphRomanAlt"><a class="docLink" target="_blank" href="http://www.respectablestockbroker.com!rated_AAA_by_US-Treasury-Dept@gg.tv/">http://www.respectablestockbroker.com!rated_AAA_by_US-Treasury-Dept@gg.tv/</a></span></p></blockquote><p class="docList">go to? SSL will check that the name in the certificate is really <span class="docEmphRomanAlt">gg.tv</span>, and will raise no warnings, but most users will assume that this URL really is to <span class="docEmphRomanAlt"><a class="docLink" target="_blank" href="http://www.respectablestocker.com">www.respectablestocker.com</a></span>.</p></li></ul>
<a name="ch25lev2sec5"></a>
<h4 id="title-IDASR2GJ" class="docSection2Title">25.6.2. Merchants Unclear on the Concept</h4>
<p class="docText">Suppose the user is very careful, so the user is talking to the correct server, and the user session is cryptographically protected. After the user does his SSL-protected transaction, where the credit card is cryptographically protected while on the wire, it is not uncommon for the merchant to subsequently email a confirmation to the user, in the clear, with all details of the transaction, including the credit card number!</p>
<a name="ch25lev2sec6"></a>
<h4 id="title-IDA4R2GJ" class="docSection2Title">25.6.3. Getting Impersonated by a Subsequent User</h4>
<p class="docText">The authorization feature of HTTP lets a web server signal the browser that it should prompt the user for a username and password, and then the browser can calculate the proper authorization information for that server. It is natural for the browser to store the user's name and password so that on subsequent visits to that same site, the browser will not need to prompt the user for name and password again. The browser can complete the authentication on the user's behalf. This is similar to the behavior that would occur if the user typed her name and password at a login page at the server's site, and the server sent the client a cookie to be used with subsequent requests (so as to bypass the login page). If a user is surfing the web from a public workstation, say at a library, and then walks away from the machine without logging out of the browser, the next user who walks up to that machine will be assumed to be the authenticated previous user. For this reason, it is important for cookies and authorization information to only be cached for a short time, and certainly deleted when the user exits from the browser.</p>
<p class="docText">However, some cookies are retained in stable storage, and the next user to use the machine will have the use of those cookies. Few users have the expertise to make sure all cookies are deleted when they finish their session.</p>
<p class="docText">But it gets worse! Some browser vendors have thought up a really &quot;helpful&quot; feature that gives us the chills. When a server requests authorization information, causing the client machine to prompt the user for username and password, the browser asks the user Alice whether she'd like the browser to remember this information (in stable storage even after the user exits the browser) so <a name="iddle1012"></a><a name="iddle1506"></a><a name="iddle1507"></a>that she won't be bothered in the future. How nice. That means that every subsequent user will be automatically authorized as Alice on any site that Alice authenticated at (assuming she answered &quot;yes&quot; to the browser's &quot;would you like me to store your name and password so that you won't be bothered in the future and so that any person who walks up to the machine you are currently using can steal all your money?&quot;). If Alice realizes her horrible error after answering &quot;yes&quot;, and wants to take it back, there is no easy way. You might think that she can cause the prompt to appear and this time overwrite her real information with bogus information in order to erase the dangerous information from being stored for the next user. But the browser will never prompt again!</p>
<p class="docText">This is such a bad feature that it should certainly be removed from browsers. But until it is, servers should not use the authorization feature of HTTP and instead accomplish the same thing by presenting the user with a login page at the server site, and giving the client machine a cookie proving the user is authorized. And the server should specify that the cookie be deleted after the user exits the browser.</p>
<p class="docText">Browser vendors are finding new ways of making life convenient for the users, as well as creating more security issues. When a user fills in a form, such as her telephone number or address, the browser remembers the responses that have been filled into such a form recently, and shows the choices so the user can select one of those rather than going through the tedium of typing in the information. Again, if the browser is used by more than one user, the other user can see the information filled into the form by the other user. It is possible to configure such browsers not to store such information, but it takes sophistication, and someone at a public workstation might change those preference settings.</p>
<a name="ch25lev2sec7"></a>
<h4 id="title-IDAHT2GJ" class="docSection2Title">25.6.4. Cross-Site Scripting</h4>
<p class="docText">One of the types of content that can be embedded in a web page is <span class="docEmphStrong">active content</span>, i.e., a program, e.g., <span class="docEmphRomanAlt">&lt;SCRIPT&gt;</span><span class="docEmphasis"><span class="docEmphRomanAlt">script commands</span></span><span class="docEmphRomanAlt">&lt;/SCRIPT&gt;</span>. Types of active content are Java, Javascript, and ActiveX. Javascript is designed for commands such as &quot;click on this button&quot;, to simulate what a user might do to a page (to save the user the work of doing it herself). Java runs in a limited sand-box on the client, so what it can do at the client is very limited, but it can send arbitrary commands to the server. ActiveX runs arbitrary executables on your desktop, but the safeguard is that these executables must have been signed.</p>
<p class="docText">It is theoretically possible for someone to post a message on a bulletin board with embedded active content, and anyone who displayed the message would inadvertently run his script. The script commands run in a sandbox on the client machine, but the client machine would allow the script to transmit anything it wants to the server. So the program can do anything on the server that the user duped into running the script is allowed to do. For instance, if the server stores the user's email, the script might send a command to delete all the user's email, or send email viruses to everyone he knows. The way this vulnerability was &quot;fixed&quot; was that servers that display such things check to make sure they aren't displaying anything dangerous. Figuring out whether something is dangerous is tricky, and if they don't get it right, there will be a loophole to exploit.</p>
<p class="docText">Cross-site scripting is a security vulnerability in which one site, A, can create a program (a &quot;script&quot;) that they can trick you into running on another site B. It has been published as a theoretical vulnerability, but never been exploited (to our knowledge) for several reasons:</p>
<ul><li><p class="docList">It requires B to have a strange and not very good design, though the design would be legal within HTTP.</p></li><li><p class="docList">It requires A to have reverse engineered B's design.</p></li><li><p class="docList">It requires A to embed an incriminating piece of content in its page. There are paranoid people who have their browsers alert them to such things, and if it were ever found it would be widely publicized. Unlike a virus, in which it is difficult to trace the source, A would be to blame for its own web site. It could claim that someone had broken in and replaced their innocent content with the malicious content, but it is still A's fault for having lax security.</p></li></ul>
<p class="docText">Even though it's probably not a real vulnerability, it is somewhat interesting to understand. Assume that the design of site B's web page is such that a client can issue commands by doing a <span class="docEmphRomanAlt">GET</span> of a URL, where the instructions for what to do (delete all your email, transfer money to an account number) are included in the portion of the URL to the right of the single slash. For instance,</p>
<blockquote><p></p><p class="docList"><span class="docEmphRomanAlt"><a class="docLink" target="_blank" href="">http://www.respectablestockbroker.com/transfer&amp;$50000.&amp;mainacount&amp;account#14567</a></span>.</p></blockquote>
<p class="docText">Assume the user has visited <span class="docEmphRomanAlt">respectablestockbroker</span> recently, so has a cookie from them identifying her. When she visits site A's web page and hits the embedded URL above, this will cause her to visit site B with that URL and her cookie. The cookie will identify her to B, so B will know what her account number is.</p>
<p class="docText">That example doesn't involve code. Here's an example, again convoluted and unlikely, that does involve code. Suppose site B's web site allows you to specify a greeting that it will display when you enter the web site, and the greeting is passed to it in the URL. So, if you entered B using</p>
<blockquote><p></p><p class="docList"><span class="docEmphRomanAlt"><a class="docLink" target="_blank" href="http://www.respectablestockbroker.com/hello">http://www.respectablestockbroker.com/hello</a> there!</span></p></blockquote>
<p class="docText">it would display <span class="docEmphRomanAlt">hello there</span>. But suppose instead of a text string, A puts an HTML file that specifies active content, e.g., <span class="docEmphRomanAlt">&lt;SCRIPT&gt;</span><span class="docEmphasis"><span class="docEmphRomanAlt">script commands</span></span><span class="docEmphRomanAlt">&lt;/SCRIPT&gt;</span>. When the user's browser does a <span class="docEmphSmaller">GET</span> of that URL, site B repeats the string back to the user's browser. Since site B is trusted, the browser will be willing to run the program.</p>
<p class="docText">This is far-fetched for many reasons. It's unlikely site B would use the information in the right-hand portion of the URL that way. If they did, they should ensure that it was just text, and not send it back if it contained active content.</p>
<a name="ch25lev2sec8"></a>
<h4 id="title-IDAAX2GJ" class="docSection2Title">25.6.5. Poisoning Cookies</h4>
<p class="docText">Some servers used cookies without any cryptographic protection<sup class="docFootnote"><a class="docLink" href="#ch25fn02">[*]</a></sup>. It was easy to look at their contents and modify them. For instance:</p><blockquote><p class="docFootnote"><sup><a name="ch25fn02">[*]</a></sup> We are using past tense because we are assuming that after the incident in the second bullet was publicized, servers used cryptographic protection on cookies to prevent modification. This is perhaps optimistic.</p></blockquote>
<ul><li><p class="docList">if the cookie contained a user ID (an index into a database), user A could modify the user ID in the cookie so that the web site would assume user A was really user B (and had authenticated as B sometime in the recent past). This would enable A to impersonate B and have access, say, to his bank account.</p></li><li><p class="docList">(this example actually occurred) An on-line merchant stored the contents of the user's shopping cart, including the prices of items, in the cookie. When the user checked out, the prices charged were those stored in the cookie. So it was easy to modify the prices in the cookie so that instead of paying $60 for an item, the user would pay 35 cents.</p></li></ul>
<a name="ch25lev2sec9"></a>
<h4 id="title-IDA3X2GJ" class="docSection2Title">25.6.6. Other Misuse of Cookies</h4>
<p class="docText">In the wonderful paper FU01, four students describe their investigation of client authentication as actually implemented by various sites. By examining cookies received, modifying them, and testing which modified cookies the site accepted, they were able to gain unauthorized access to several sites, and even find out the secret key used to create the cryptographic authentication information used in one site's cookies!</p>
<p class="docText">The paper gives several examples of bad security practice. The most spectacular bad example, though, was one site that was intending their cookie to be a hash of the concatenation of the username and a server secret. Their mistake was in not understanding the property of the particular hash function they were using. By examing the cookies received with various user names, the authors were able to figure out that the site was concatenating the username with some sort of cryptographic MAC to create the client authenticator used in the cookie. By experimentation, the authors were able to determine that the MAC was the output of the UNIX function used for hashing passwords (see &sect;<a class="docLink" href="ch05lev1sec2.html#ch05lev3sec3">5.2.4.1</a> <span class="docEmphasis">UNIX Password Hash</span>), with input consisting of a concatenation of the username and a server secret.</p>
<p class="docText">The problem is that function ignores all but the first 8 characters of the input string. So if the username was longer than 8 characters, the server secret would not affect the output of the hash. This enabled the authors to construct authenticators that would allow them to gain access to the site. All they needed to do was run the hash on a username of at least 8 characters to produce a cookie the site would accept (the username concatenated with the output of the hash on that username).</p>
<p class="docText">But it gets worse! They were also able to easily find out the server secret. They'd guessed that the site was using that particular hash function, because authenticators for all usernames with the same 8-character prefix were identical. If the username was 8 characters or more, the server secret was ignored. However, if the username was 7 characters, then the hash function would do its calculations on the username and the first octet of the server secret. That function uses the input string as a DES key, ignoring the high-order bit, so there were 128 possibilities for each octet of the server secret.</p>
<p class="docText">So the authors used a 7-character username, and tried each of the 128 possible values of the first octet of the server secret until they found an authenticator value that the server would accept. This told them the first character of the server secret. Next they tried a 6-character username, concatenated with the first character of the server secret, and tried each of the possible values of the second octet of the server secret (again, at most 128 values needed to be tried), until they found one that worked. They did this until they discovered the entire server secret, which turned out to be the ASCII string <span class="docEmphRomanAlt">MARCH20</span>. Even if the site had chosen a high quality 8-octet secret, at most 128 x 8 attempts would have been required to determine the secret. If, instead, a proper keyed hash had been done, it would have required 128<sup>8</sup> attempts.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch25lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch25lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>