<html><head><title>4.4. Multiple Encryption DES</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch04lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch04lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="15051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch04lev1sec4"></a>
<h3 id="title-IDAWO4WE" class="docSection1Title">4.4. Multiple Encryption DES</h3>
<p class="docText"><a name="iddle1259"></a><a name="iddle1315"></a><a name="iddle2065"></a>The generally accepted method of making DES more secure through multiple encryptions is known as <b><a class="docLink" href="app02.html#gloss01_081">EDE</a></b> (for encryptÂdecryptÂencrypt) or <b><a class="docLink" href="app02.html#gloss01_223">3DES</a></b>.</p>
<p class="docText">Actually, any encryption scheme might be made more secure through multiple encryptions. Multiple encryption, though, has specifically been discussed in the industry in order to arrive at a &quot;standard&quot; means of effectively increasing DES's key length. EDE could as easily be done with, say, IDEA. It is more important with DES than with IDEA, though, because of DES's key length (or lack thereof).</p>
<p class="docText">Remember that a cryptographic scheme has two functions, known as <span class="docEmphasis">encrypt</span> and <span class="docEmphasis">decrypt</span>. The two functions are inverses of each other, but in fact each one takes an arbitrary block of data and garbles it in a way that is reversed by the other function. So it makes sense to perform decrypt on the plaintext as a method of encrypting it, and then perform encrypt on the result as a method of getting back to the plaintext again. It might be confusing to say something like <span class="docEmphasis">encrypt with decryption</span>, so we'll just refer to the two functions as E and D.</p>
<p class="docText">How to do multiple encryption is not completely obvious, especially since there is also the problem of turning block encryption into <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_214">stream encryption</a></span>. The standard method for using EDE is:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Two keys are used: <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub>.</p></div></li><li><div style="font-weight:normal"><p class="docList">Each block of plaintext is subjected to E with <span class="docEmphasis">K</span><sub>1</sub>, then D with <span class="docEmphasis">K</span><sub>2</sub>, and then E with <span class="docEmphasis">K</span><sub>1</sub>. The result is simply a new secret key schemeÂa 64-bit block is mapped to another 64-bit block.</p>
<a name="f109equ01"></a>
<p class="docText">
<img border="0" alt="" width="220" height="60" src="109equ01.jpg" /></p>
<br /><p class="docList">Decryption simply reverses the operation.</p>
<a name="f109equ02"></a>
<p class="docText">
<img border="0" alt="" width="230" height="63" src="109equ02.jpg" /></p>
<br /></div></li><li><div style="font-weight:normal"><p class="docList">CBC is used to turn the block encryption scheme resulting from step 2 into a stream encryption (<a class="docLink" href="#ch04fig15">Figure 4-15</a>).</p><a name="ch04fig15"></a><p><center>
<h5 class="docFigureTitle">Figure 4-15. EDE with CBC on the Outside (3DES)</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="220" src="04fig15.jpg" /></p>
</div></li></ol></div>
<p class="docText">Now we'll discuss why 3DES is defined this way. There are various choices that could have been made:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList"><a name="iddle1149"></a><a name="iddle1150"></a>Three encryptions were chosen. It could have been 2 or 714. Is three the right number?</p></div></li><li><div style="font-weight:normal"><p class="docList">Why are the functions EDE rather than, say, EEE or EDD?</p></div></li><li><div style="font-weight:normal"><p class="docList">Why is the cipher block chaining done on the outside rather than on the inside? Doing CBC on the <span class="docEmphStrong">inside</span> (<a class="docLink" href="#ch04fig16">Figure 4-16</a>) means completely encrypting the message with CBC, then completely decrypting the result with CBC using a second key, and then completely CBC-encrypting the message again. Doing CBC on the <span class="docEmphStrong">outside</span> (<a class="docLink" href="#ch04fig15">Figure 4-15</a>) means performing the DES encryptions and decryption on each block, but only doing the CBC once.</p><a name="ch04fig16"></a><p><center>
<h5 class="docFigureTitle">Figure 4-16. EDE with CBC on the Inside</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="260" src="04fig16.jpg" /></p>
</div></li></ol></div>
<a name="ch04lev2sec11"></a>
<h4 id="title-IDAXW4WE" class="docSection2Title">4.4.1. How Many Encryptions?</h4>
<p class="docText"><a name="iddle1052"></a><a name="iddle1056"></a><a name="iddle1544"></a><a name="iddle1626"></a>Let's assume that the more times the block is encrypted, the more secure it is. So encrypting 749 times would therefore be some amount more secure than encrypting 3 times. The problem is, it is expensive to do an encryption. We don't want to do any more encryptions than are necessary for the scheme to be really secure.</p>
<a name="ch04lev3sec3"></a>
<h5 id="title-IDACY4WE" class="docSection3Title">4.4.1.1. Encrypting Twice with the Same Key</h5>
<p class="docText">Suppose we didn't want to bother reading in two keys. Would it make things more secure if we encrypted twice in a row with the same key?</p>
<a name="f111equ01"></a>
<p class="docText">
<img border="0" alt="" width="250" height="22" src="111equ01.jpg" /></p>
<br />
<p class="docText">This turns out not to be much more secure than single encryption with <span class="docEmphasis">K</span>, since exhaustive search of the keyspace still requires searching only 2<sup>56</sup> keys. Each step of testing a key is twice as much work, since the attacker needs to do double encryption, but a factor of two for the attacker is not considered much added security, especially since the good guys have their work doubled with this scheme as well.</p>
<p class="docText">(How about E followed by D using the same key? That's double the work for the good guy and no work for the bad guy, so that's generally not considered good cryptographic form.)</p>
<a name="ch04lev3sec4"></a>
<h5 id="title-IDAGZ4WE" class="docSection3Title">4.4.1.2. Encrypting Twice with Two Keys</h5>
<p class="docText">If encrypting twice, using two different keys, were as secure as a DES-like scheme with a key length of 112 bits, then encrypting twice would have sufficed. However, it isn't, as we will show.</p>
<p class="docText">We'll use two DES keys, <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub>, and encrypt each block twice, first using key <span class="docEmphasis">K</span><sub>1</sub> and then using key <span class="docEmphasis">K</span><sub>2</sub>. For the moment, let's ignore any block chaining schemes and assume we're just doing block encryption.</p>
<a name="f111equ02"></a>
<p class="docText">
<img border="0" alt="" width="250" height="22" src="111equ02.jpg" /></p>
<br />
<p class="docText">Is this as cryptographically strong as using a double-length secret key (112 bits)? The reason you might think it would be as strong as a 112-bit key is that the straightforward brute-force attack would have to guess both <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub> in order to determine if a particular plaintext block encrypted to a particular ciphertext block.</p>
<p class="docText">However, there is a less straightforward attack that breaks double-encryption DES in roughly twice the time of a brute-force breaking of single-encryption DES. The attack is not particularly practical, but the fact that it exists makes double encryption sufficiently suspect that it's not generally done.</p>
<p class="docText">The threat involves the following steps:</p>
<a name="ch04pro01"></a>
<table border="0" class="docText"><tr><td></td><td></td></tr><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Assume you have a few &lt;plaintext,ciphertext&gt; pairs &lt;<span class="docEmphasis">m</span><sub>1</sub>,<span class="docEmphasis">c</span><sub>1</sub>&gt;, &lt;<span class="docEmphasis">m</span><sub>2</sub>,<span class="docEmphasis">c</span><sub>2</sub>&gt;, &lt;<span class="docEmphasis">m</span><sub>3</sub>,<span class="docEmphasis">c</span><sub>3</sub>&gt; where <span class="docEmphasis">c<sub>i</sub></span> was derived from doubly encrypting <span class="docEmphasis">m<sub>i</sub></span> with <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub>. You want to find <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">First make Table A with 2<sup>56</sup> entries, where each entry consists of a DES key <span class="docEmphasis">K</span> and the result <span class="docEmphasis">r</span> of applying that key to encrypt <span class="docEmphasis">m</span><sub>1</sub>. Sort the table in numerical order by <span class="docEmphasis">r</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Now make Table B with 2<sup>56</sup> entries, where each entry consists of a DES key <span class="docEmphasis">K</span> and the result <span class="docEmphasis">r</span> of applying that key to decrypt <span class="docEmphasis">c</span><sub>1</sub>. Sort the table in numerical order by <span class="docEmphasis">r</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Search through the sorted lists to find matching entries, &lt;<span class="docEmphasis">K</span><sub>A</sub>,<span class="docEmphasis">r</span>&gt; from table A and &lt;<span class="docEmphasis">K</span><sub>B</sub>,<span class="docEmphasis">r</span>&gt; from Table B. Each match provides <span class="docEmphasis">K</span><sub>A</sub> as a candidate <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>B</sub> as a candidate <span class="docEmphasis">K</span><sub>2</sub> because <span class="docEmphasis">K</span><sub>A</sub> encrypts <span class="docEmphasis">m</span><sub>1</sub> to <span class="docEmphasis">r</span> and <span class="docEmphasis">K</span><sub>B</sub> encrypts <span class="docEmphasis">r</span> to <span class="docEmphasis">c</span><sub>1</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">If there are multiple intermediate values (which there almost certainly will be), test the candidate <span class="docEmphasis">K</span><sub>1</sub> and <span class="docEmphasis">K</span><sub>2</sub> against <span class="docEmphasis">m</span><sub>2</sub> and <span class="docEmphasis">c</span><sub>2</sub>. If you've tested all the candidate &lt;<span class="docEmphasis">K</span><sub>1</sub>,<span class="docEmphasis">K</span><sub>2</sub>&gt; pairs and multiple of them work on <span class="docEmphasis">m</span><sub>2</sub> and <span class="docEmphasis">c</span><sub>2</sub>, then try <span class="docEmphasis">m</span><sub>3</sub> and <span class="docEmphasis">c</span><sub>3</sub>. The correct pair will always work, of course, and an incorrect pair will almost certainly fail to work on any particular &lt;<span class="docEmphasis">m<sub>i</sub></span>, <span class="docEmphasis">c<sub>i</sub></span>&gt; pair. (See below for exact numbers, if you care.)<br /><br /></div></td></tr></table>
<p class="docText">This attack is not really practical, since a table of size 2<sup>56</sup> is a bit daunting. The existence of the attack, though, is enough reason to bother doing triple DES encryption. It may be that double encryption would be good enough, but since triple encryption isn't that much harder, it will save you from defending yourself to management when they ask you why you're doing double encryption when they've heard that double encryption isn't secure.</p>
<p class="docText">How many matches should you expect to find after searching the two tables? Well, there are 2<sup>64</sup> possible blocks, and only 2<sup>56</sup> table entries in each table (because there are only 2<sup>56</sup> keys). Therefore each 64-bit block has only a 1 in 256 chance of appearing in each of the tables. Of the 2<sup>56</sup> blocks that appear in Table A, only 1/256 of them also appear in Table B. That means that there should be about 2<sup>48</sup> entries which appear in both tables. One of those corresponds to the correct &lt;<span class="docEmphasis">K</span><sub>1</sub>,<span class="docEmphasis">K</span><sub>2</sub>&gt; pair and the others are imposters. We'll test them against &lt;<span class="docEmphasis">m</span><sub>2</sub>,<span class="docEmphasis">c</span><sub>2</sub>&gt;. If &lt;<span class="docEmphasis">K</span><sub>1</sub>,<span class="docEmphasis">K</span><sub>2</sub>&gt; is an imposter, the probability that D(<span class="docEmphasis">c</span><sub>2</sub>,<span class="docEmphasis">K</span><sub>2</sub>) will equal E(<span class="docEmphasis">m</span><sub>2</sub>,<span class="docEmphasis">K</span><sub>1</sub>) is about 1/2<sup>64</sup>. There are about 2<sup>48</sup> imposters, so the probability of one of them satisfying D(<span class="docEmphasis">c</span><sub>2</sub>,<span class="docEmphasis">K</span><sub>2</sub>) = E(<span class="docEmphasis">m</span><sub>2</sub>,<span class="docEmphasis">K</span><sub>1</sub>) is about 2<sup>48</sup>/2<sup>64</sup>, or roughly 1 in 2<sup>16</sup>. Each test against an additional &lt;<span class="docEmphasis">m<sub>i</sub></span>, <span class="docEmphasis">c<sub>i</sub></span>&gt; reduces the probability by a factor of 2<sup>64</sup>, so the probability that there will still be false matches after trying three &lt;<span class="docEmphasis">m</span>, <span class="docEmphasis">c</span>&gt; pairs is about 1/2<sup>80</sup>.</p>
<a name="ch04lev3sec5"></a>
<h5 id="title-IDAGD5WE" class="docSection3Title">4.4.1.3. Triple Encryption with only Two Keys</h5>
<p class="docText">3DES does triple encryption. Why does 3DES use only two keys? Presumably, security cannot possibly be enhanced because <span class="docEmphasis">K</span><sub>1</sub> is used twice rather than using a third key. People believe using <span class="docEmphasis">K</span><sub>1</sub> twice in this way is sufficiently secure that there's no reason to bother generating, transmitting, and storing a third key. For avoiding the brute-force exhaustive key space attack, 112 bits of key is considered sufficient, and no attacks other than the straightforward brute-force search is known for EDE. Some systems do implement 3DES with three independent keys, but this is not the standard.</p>
<p class="docText">An esoteric reason for using only two keys is that in some applications (like &sect;<a class="docLink" href="ch05lev1sec2.html#ch05lev3sec3">5.2.4.1</a> <span class="docEmphasis">UNIX Password Hash</span>) an important property of a cryptosystem is that given a &lt;plaintext, ciphertext&gt; pair, it is impractical to find any key that maps the plaintext to the ciphertext. (With 64-bit blocks and 112-bit keys, there will be lots of such keys.) Using EDE with three keys, it is straightforward to find a triple of keys that maps a given plaintext to a given ciphertext (<a class="docLink" href="ch04lev1sec5.html#ch04qa1q4">Homework Problem 4</a>). There is no known practical way of finding such a triple with <span class="docEmphasis">K</span><sub>1</sub> = <span class="docEmphasis">K</span><sub>3</sub>.</p>
<p class="docText">Why is <span class="docEmphasis">K</span><sub>2</sub> used in decrypt mode? Admittedly, it is no more trouble to run DES in either mode, and either way gives a mapping. DES would be just as good always done backwards (i.e., swap <span class="docEmphasis">encrypt</span> and <span class="docEmphasis">decrypt</span>). One reason for the choice of EDE is that an EDE system with <span class="docEmphasis">K</span><sub>1</sub> = <span class="docEmphasis">K</span><sub>2</sub> is equivalent to simple DES, so that such a system can interoperate with a simple DES system.</p>
<a name="ch04lev2sec12"></a>
<h4 id="title-IDAFF5WE" class="docSection2Title">4.4.2. CBC Outside vs. Inside</h4>
<p class="docText">To review, the 3DES commonly used in the industry (and defined in &sect;<a class="docLink" href="#ch04lev1sec4">4.4</a> <span class="docEmphasis">Multiple Encryption DES</span>) does CBC on the outside, which means that each block is triply encrypted, and the CBC is done on the triply encrypted block (see <a class="docLink" href="#ch04fig15">Figure 4-15</a>). The alternative would be to completely encrypt the message with <span class="docEmphasis">K</span><sub>1</sub> and CBC, and then take the result and completely decrypt it with <span class="docEmphasis">K</span><sub>2</sub> and CBC, and then take the result and completely encrypt it with <span class="docEmphasis">K</span><sub>1</sub> (see <a class="docLink" href="#ch04fig16">Figure 4-16</a>).</p>
<p class="docText">What are the implications of this choice?</p>
<p class="docText">As shown in &sect;<a class="docLink" href="ch04lev1sec2.html#ch04lev3sec1">4.2.2.1</a> <span class="docEmphasis">CBC Threat 1ÂModifying Ciphertext Blocks</span>, with CBC it is possible to make a predictable change to plaintext block <span class="docEmphasis">n</span>, for instance flipping bit <span class="docEmphasis">x</span>, by flipping bit <span class="docEmphasis">x</span> in ciphertext block <span class="docEmphasis">n</span>-1. There is a side-effect, though, of completely garbling plaintext block <span class="docEmphasis">n</span>-1. Whether an attacker can use this for nefarious purposes depends on the exact application.</p>
<p class="docText">With CBC done on the outside, an attacker can still do the same attack. The fact that the encryption scheme involves triple use of DES does not change the effects of CBC. An attacker that flips bit <span class="docEmphasis">x</span> in ciphertext block <span class="docEmphasis">n</span>-1 will completely and unpredictably (to the attacker) garble plaintext block <span class="docEmphasis">n</span>-1. However, plaintext block <span class="docEmphasis">n</span> will have bit <span class="docEmphasis">x</span> flipped. And all plaintext blocks other than <span class="docEmphasis">n</span>-1 and <span class="docEmphasis">n</span> will be unaffected.</p>
<p class="docText"><a name="iddle1975"></a>With CBC done on the inside, any change to ciphertext block <span class="docEmphasis">n</span> completely and unpredictably garbles all plaintext blocks from <span class="docEmphasis">n</span> to the end of the message. This makes CBC done on the inside more secure, and perhaps would therefore have been a better choice. However, sometimes people would prefer if garbling of a ciphertext block did not garble the entire rest of the message. They'd prefer that the encryption scheme be <b><a class="docLink" href="app02.html#gloss01_201">self-synchronizing</a></b>, which means that after some small number of garbled blocks, the plaintext will start decrypting properly again. There are also subtle security flaws with CBC on the inside if the attacker can supply chosen plaintext and IV and examine the output.</p>
<p class="docText">Another advantage of CBC on the inside is performance. With CBC on the inside it is possible to use three times as much hardware and pipeline the encryptions so that it is as fast as single encryption. With CBC on the outside, this is not possible.</p>
<p class="docText">One reason that people choose CBC on the outside despite its disadvantages is that EDE encryption can be considered a new secret key block encryption scheme that uses a 112-bit key. This can then be used with any of the chaining methods (OFB, ECB, CFB, CTR, as well as CBC).</p>
<a href="15051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch04lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch04lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>