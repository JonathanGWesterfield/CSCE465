<html><head><title>19.13. Exportability</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="16051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec12.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec14.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch19lev1sec13"></a>
<h3 id="title-IDA0A3UR" class="docSection1Title">19.13. Exportability</h3>
<p class="docText"><a name="iddle1357"></a>The acrobatics we had to go through back in the dark ages of export control! Even if export controls have been permanently relaxed, we have to understand the mechanisms they engendered, since that is what is deployed and what must be implemented in order to be compatible with what was deployed. The simplest thing to have done with export controls was to always use weak crypto, even domestically. But it was legal to deploy strong crypto domestically, so complex mechanisms were built in order to make something that could be as secure as possible within the political constraints, and have the domestic and exportable versions interoperate.</p>
<a name="ch19lev2sec5"></a>
<h4 id="title-IDAMB3UR" class="docSection2Title">19.13.1. Exportability in SSLv2</h4>
<p class="docText">SSLv2 domestic clients supported 128-bit encryption. But the U.S. government limited exportable cryptographic keys to 40 bits. Some &quot;exportable&quot; suites were defined for SSLv2 which effectively used a 40-bit encryption key even though the actual cryptographic algorithm used a 128-bit key. In these exportable suites, instead of sending a 128-bit secret encrypted with the server's public key, the client sends a 40-bit secret encrypted with the server's public key, and sends an additional 88 bits in the clear. So in a non-exportable suite, there will be 128 secret bits. In an exportable suite, there will be 40 secret bits and 88 non-secret bits. So in either case there are 128 bits, which are known in SSLv2 as the <span class="docEmphStrong">client master key</span> (not a terrific name for a quantity in which most of the bits are not secret). This key is used to produce the session keys.</p>
<p class="docText">Interestingly, the export laws were that encryption was limited to 40-bit secret keys and 512-bit RSA encryption keys, the latter normally used to encrypt secret keys. This is kind of weird, because if the encryption key is 40 bits, why should they care if it's sent encrypted in a really long RSA key? Or likewise, if they felt they could break 512-bit RSA, why couldn't you use a long encryption key as long as it had been sent across the wire encrypted with a short (512-bit) RSA key? But non-weird was never an important consideration in export rules.</p>
<p class="docText">So exportable servers had 512-bit RSA keys. Domestic servers had large RSA keys (e.g., 1024 bits). If a domestic server were talking to an exportable client, the client would wind up sending its 40-bit secret in the domestic server's large RSA key, which was technically illegal but apparently nobody noticed until after the protocol was approved and shipped. At that point, they agreed to let SSLv2 continue to be exported, with clients that would encrypt a 40-bit key in a 1024-bit RSA key, though they warned the designers they would not approve the same approach in SSLv3.</p>
<a name="ch19lev2sec6"></a>
<h4 id="title-IDAEC3UR" class="docSection2Title">19.13.2. Exportability in SSLv3</h4>
<p class="docText"><a name="iddle1341"></a>In SSLv3 the pre-master secret sent by the client (and encrypted with the server's public key) is always a 48-octet number, but only 46 octets are random. The other two octets are used for version number. In the domestic version the pre-master secret is hashed with the <span class="docEmphasis">R</span>s to produce the master secret, and the master secret is hashed with the <span class="docEmphasis">R</span>s to produce the stream from which the six data protection keys are extracted.</p>
<p class="docText">If the cipher suite negotiated is exportable, then the integrity keys are computed as before, because export rules did not preclude strong integrity, but only 40 bits are extracted for each of the two encryption keys. And (due to someone's misunderstanding of the export rules), the IVs are computed solely from the two <span class="docEmphasis">R</span>s, so for the exportable cipher suites, the IVs are not secret. The export rules would have allowed strong IVs, but non-secret IVs are not a security vulnerability anyway.</p>
<p class="docText">But the 40 bits are only seeds for the encryption keys. These 40-bit seeds are hashed with the two <span class="docEmphasis">R</span>s to produce 128-bit keys. The reason for this step is similar to the reason for using salt: although there is still only a <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_243">work factor</a></span> of 2<sup>40</sup> for breaking any individual encrypted session, you couldn't build up a table of 2<sup>40</sup> keys for all sessions, since although there are only 2<sup>40</sup> possible keys in any one session, the total number of possible keys is 2<sup>128</sup> (for encryption algorithms with 128-bit keys).</p>
<p class="docText">But wait! 40-bit encryption keys wasn't sufficient to meet export restrictions. It was also a crime to send the 40-bit secret encrypted with an RSA key larger than 512 bits. A domestic server would have a 1024-bit RSA key, and might be speaking to an exportable client. It wouldn't be legal for the client to send its pre-master secret encrypted with a 1024-bit RSA key.</p>
<p class="docText">SSLv3 solves this problem by having the server (Bob) generate at random a 512-bit RSA key. This key can be changed periodically and is signed by Bob using his long-term key. The 512-bit key is known as the <span class="docEmphStrong">ephemeral key</span>. In SSLv2 the client chose the cipher suite, but in SSLv3, since the server chooses the cipher suite, Bob figures out from the client's list of cipher suites in message 1 (and his own cipher suite capabilities) if he needs to be speaking exportable crypto. So in message 2, if Bob chooses an exportable cipher suite, then, in addition to sending his regular certificate (the one certifying his long-term key), Bob sends his 512-bit ephemeral key, signed using his long-term key. The client then sends the pre-master secret encrypted with Bob's ephemeral key.</p>
<p class="docText">This could have been implemented in a way that improved performance by having Bob sign the 512-bit ephemeral key once and use it for many connections. He would then only have to do a 512-bit private key operation for each connection instead of having to use the longer key. But doing so would have introduced a security vulnerability since someone who learned or broke a single 512-bit key could impersonate Bob indefinitely. Rather than putting an expiration time under the signature and risking clock synchronization problems, the protocol requires that Bob sign a combination of the ephemeral public key and the two nonces.</p>
<p class="docText"><a name="iddle1978"></a><a name="iddle2034"></a>Aside from the performance penalty, in a perverse way, this hack, created for exportability, enhances security, because it allows weak-key perfect forward secrecy. Once Bob forgets the ephemeral private key, it would require breaking the 512-bit ephemeral public key or the 40-bit encryption key in order to decrypt the conversation, whereas with the non-exportable cipher suites, someone obtaining Bob's long-term private key would be able to directly decrypt previous conversations. So ironically, the NSA would have been better off with the SSLv2 solution. Although this perfect forward secrecy solution would have been useful in the non-exportable case, it is not supported in any server.</p>
<a name="ch19lev2sec7"></a>
<h4 id="title-IDAQE3UR" class="docSection2Title">19.13.3. Server Gated Cryptography/Step-Up</h4>
<p class="docText">The U.S. allowed an exported client to use strong cryptography when talking to some servers doing financial transactions. This meant that the client had to have all the code necessary for doing strong cryptography. But it would only use strong cryptography if the server's certificate specified that the server was one with which the client was allowed to speak strong crypto. This concept was implemented by both Netscape and Microsoft, but called <span class="docEmphStrong">SGC</span> (<span class="docEmphStrong">Server Gated Cryptography</span>) by Microsoft and <span class="docEmphStrong">Step-Up</span> by Netscape. The protocols are slightly different, and the certificate extensions are different, since they were independently developed.</p>
<p class="docText">Whereas the usual certificates would be honored if signed with a chain starting with any of the trust anchors, the SGC certificate had to be signed by Verisign or Thawte (but Verisign bought Thawte so it was just Verisign), since this wasn't a matter of whom the client trusted, but whom the U.S. government trusted. Whereas the set of trust anchors for regular certificates could be modified by the user, the trusted SGC-certificate issuer(s) were wired into the implementation.</p>
<p class="docText">In the Step-Up exchange between an exportable client (Alice) with Step-Up capability and a server (Bob) with the Step-Up extension in its Verisign-signed certificate, there is the usual initial exchange (see <a class="docLink" href="ch19lev1sec4.html#ch19fig01">Protocol 19-1</a>) in which Alice offers only weak (exportable) crypto suites, Bob selects one of the weak suites, and they complete an exchange with a 40-bit key <span class="docEmphasis">K</span><sub>1</sub>. But Alice notices the Step-Up extension in Bob's certificate, so she continues with another handshake, with the handshake protected with <span class="docEmphasis">K</span><sub>1</sub>. (Once an SSL connection is established, handshake messages are allowed as well as data messages, so it is possible to conduct a new handshake protected by the keys established by the previous handshake.) In the new exchange, Alice proposes strong crypto and Bob accepts a strong cipher, and the new handshake completes, this time agreeing upon a strong key <span class="docEmphasis">K</span><sub>2</sub>. Then Alice sends a ChangeCipherSpec message, indicating a change from the weak crypto suite and key <span class="docEmphasis">K</span><sub>1</sub> to the strong crypto suite and key <span class="docEmphasis">K</span><sub>2</sub>.</p>
<p class="docText">This might seem like a lot of messages, but this protocol would allow a server without special Step-Up code to speak strong crypto as long as it is given a certificate with the Step-Up option. Microsoft's SGC protocol is more efficient, but requires the server to have code that supports a new SGC exchange in addition to a certificate with the SGC extension.</p>
<p class="docText">In SGC, Alice's message 1 offers weak crypto, and Bob's message 2 sends his certificate, and has him choose one of Alice's weak crypto suite offers. Alice notices the SGC extension in Bob's Verisign-signed certificate, and Alice then sends a new <span class="docEmphasis">client-hello</span>, this time offering strong crypto suites. This would confuse a server that did not have special SGC code, because it wouldn't expect a second <span class="docEmphasis">client-hello</span> within the same TCP connection.</p>
<ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="16051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec12.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec14.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>