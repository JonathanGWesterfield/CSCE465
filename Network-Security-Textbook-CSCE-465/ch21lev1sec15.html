<html><head><title>21.15. Message Formats</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch21lev1sec14.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch21lev1sec16.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch21lev1sec15"></a>
<h3 id="title-IDAMWPRH" class="docSection1Title">21.15. Message Formats</h3>
<p class="docText">The PEM message formats have fields that consist of text. Sometimes the fields are encrypted, and sometimes they are encoded (which looks encrypted to humans but isn't).</p>
<p class="docText">The types of messages are <span class="docEmphRomanAlt">MIC-CLEAR, MIC-ONLY,</span> and <span class="docEmphRomanAlt">ENCRYPTED</span>, and the format for each of these varies slightly depending on whether public or secret key cryptography is being used. We'll describe the public key and secret key variants separately. If some recipients use public key and some use secret key, then fields from both variants must be present.</p>
<p class="docText">Each field in the message has a label indicating what it contains. There are a few reasons for this label:</p>
<ul><li><p class="docList">To provide a visual clue to a human reader wondering what all the cybercrud is (but a civilized PEM mailer ought not show the cybercrud to the human)</p></li><li><p class="docList">To identify the fieldÂthe position of the field in the message does not uniquely identify it because some fields are optional and/or repeated (e.g., CA <span class="docEmphSmaller">CERTIFICATE</span>)</p></li></ul>
<a name="ch21lev2sec2"></a>
<h4 id="title-IDAXXPRH" class="docSection2Title">21.15.1. ENCRYPTED, Public Key Variant</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1331"></a><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,ENCRYPTED</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Content-Domain: RFC822</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message form</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>DEK-Info: DES-CBC,</tt></span><span class="docEmphItalicAlt">16 hex digits</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message encryption algorithm, IV</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-Certificate:</tt></span> <span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender's encoded certificate (optional)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-ID-Asymmetric:</tt></span> <span class="docEmphItalicAlt">cybercrud,number</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender ID (present only if sender's certificate not present)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Key-Info: RSA,</tt></span> <span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">key-info for CC'd sender (if needed)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Issuer-Certificate:</span> <span class="docEmphItalicAlt">cybercrud</span>

                  .
                  .
                  .</pre></div><br /></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sequence of zero or more CA certificates (possibly whole chain from the sender's certificate to the IPRA's)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>MIC-Info: RSA-MD</tt></span><span class="docEmphItalicAlt">x</span><span class="docEmphStrong"><tt>,RSA,</tt></span> <span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message digest algorithm, message digest encryption algorithm, encoded encrypted MIC</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Recipient-ID-Asymmetric:</span> <span class="docEmphItalicAlt">cybercrud,number</span>
<span class="docEmphStrong">Key-Info: RSA,</span><span class="docEmphItalicAlt">cybercrud</span>

                  .
                  .
                  .</pre></div><br /></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">for each recipient: recipient ID (encoded X.500 name of CA that signed certificate, certificate serial number); key-info for recipient</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">blank line</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">encoded encrypted message</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">PRE-ENCAPSULATION BOUNDARY</span>. This is just to show that a PEM-processed portion of the mail message is about to begin.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Proc-Type: 4,ENCRYPTED</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE TYPE</span>. The first subfield (<span class="docEmphRomanAlt">4</span>) specifies that this is version four of PEM. There are currently no other legal values for this field. The second subfield (<span class="docEmphRomanAlt">ENCRYPTED</span>) specifies that this is an encrypted message. The other legal values for this field are <span class="docEmphRomanAlt">MIC-ONLY</span> and <span class="docEmphRomanAlt">MIC-CLEAR</span>.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Content-Domain: RFC822</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE FORM</span>. The intention is that there might eventually be lots of types of mail messages, such as PostScript, spreadsheet, bitmap, executable image for an XYZ processor, and so on. However, the only defined type is <span class="docEmphRomanAlt">RFC822</span>, which is an Internet standard for ordinary text messages.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">DEK-Info: DES-CBC,0123456789ABCDEF</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE ENCRYPTION ALGORITHM, IV</span>. The first subfield identifies the cryptographic algorithm used to encrypt the message. Currently the only &quot;registered&quot; algorithm is <span class="docEmphRomanAlt">DES-CBC</span>. The second subfield specifies the IV as 16 hex digits. So in the example above, the IV is 0123456789ABCDEF<sub>16</sub>.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Originator-Certificate: MIIBfzCCASkCAQIwDQYJKoZIhvcNAQECBQAwQzELM</span>
 <span class="docEmphStrong">AkGA1UEBhMCVVMxJjAkBgNVBAoTHURpZ2l0YWwgRXF1aXBtZW50IENvcnBvcmF0a</span>
 <span class="docEmphStrong">W9uMQwwCgYDVQQLEwNMS0cwHhcNOTIwOTA4MjAxODMzWhcNOTQwOTA4MjAxODMzW</span>
 <span class="docEmphStrong">jBXMQswCQYDVQQGEwJVUzEmMCQGA1UEChMdRGlnaXRhbCBFcXVpcG1lbnQgQ29yc</span>
 <span class="docEmphStrong">G9yYXRpb24xDDAKBgNVBAsTA0xLRzESMBAGA1UEAxMJSm9obiBMaW5uMFcwCgYEV</span>
 <span class="docEmphStrong">QgBAQICAgADSQAwRgJBAMEom520pxxpN7Y+0e8nWsI2yVK4YPu30+meJEwH9w0Xu</span>
 <span class="docEmphStrong">O3hmHTHowzrNwgdgFeic4SHlkFOwf1K7RrOgnTurQ0CAQMwDQYJKoZIhvcNAQECB</span>
 <span class="docEmphStrong">QADQQBq/+L5hKVZvN/jtgsjeUE5eQBrMpSf3ND4kqyP65xj29OhFk5Mbh4DpfJ+7</span>
 <span class="docEmphStrong">wOwJATwUjOERhzwVJm5WmI0oRs4</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">SENDER'S CERTIFICATE</span>. BIG pile of cybercrud as specified in X.509. Since a certificate is ASN.1-coded information (as opposed to nice printable text strings), the certificate is encoded as per &sect;<a class="docLink" href="ch21lev1sec7.html#ch21lev1sec7">21.7</a> <span class="docEmphasis">Reformatting Data to Get Through Mailers</span>. Certificates are described in <a class="docLink" href="ch15.html#ch15">Chapter 15</a> <span class="docEmphasis">PKI (Public Key Infrastructure)</span>.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Originator-ID-Asymmetric: MEMxCzAJBgNVBAYTAlVTMSYwJAYDVQQKEx1EaWd</span>
 <span class="docEmphStrong">pdGFsIEVxdWlwbWVudCBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDTEtH,216</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">SENDER ID</span>. This field can replace the <span class="docEmphSmaller">SENDER'S CERTIFICATE</span> field to save space. It consists of the X.500 name of the CA that issued the sender her certificate, coded in ASN.1 and encoded 6 bits per character, followed by a comma, followed by the serial number of the sender's certificate in decimal using decimal digits. In the example above, the serial number is 216.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Key-Info: RSA,Pv3W7Ds86/fQBnvB5DsvUXgpK7+6h5aSVcNeYf9uWtly9m2VHzC</span>
 <span class="docEmphStrong">v2t7A6qgbXtIcf4kaMj1FL2yl9/N9mWpm4w==</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">KEY-INFO</span>. This is strictly necessary only if the sender CC's herself on the message. It is also useful when the mail system returns the message to the sender due to some error condition. The purpose of this field is to enable the sender to decrypt the message. The first subfield specifies the cryptographic algorithm used for encrypting the per-message key. The only defined public key algorithm is <span class="docEmphRomanAlt">RSA</span>. The second subfield contains the per-message key encrypted with the sender's public key and then encoded.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Issuer-Certificate: MIIBXzCCAQkCAQowDQYJKoZIhvcNAQECBQAwNzELMAkGA</span>
 <span class="docEmphStrong">1UEBhMCVVMxKDAmBgNVBAoTH1RydXN0ZWQgSW5mb3JtYXRpb24gU3lzdGVtcyBQQ</span>
 <span class="docEmphStrong">0EwHhcNOTIwOTA4MTk0NTQzWhcNOTQwOTA4MTk0NTQzWjBDMQswCQYDVQQGEwJVU</span>
 <span class="docEmphStrong">zEmMCQGA1UEChMdRGlnaXRhbCBFcXVpcG1lbnQgQ29ycG9yYXRpb24xDDAKBgNVB</span>
 <span class="docEmphStrong">AsTA0xLRzBXMAoGBFUIAQECAgIAA0kAMEYCQQDkwhgRGX6ScwOHTVk48NK07tiih</span>
 <span class="docEmphStrong">t9bBExsbxphdp7brUrypA4kZDYqZNVv9Ee5kHv5qn428Pc3lbGH+zlS7bq/AgEDM</span>
 <span class="docEmphStrong">A0GCSqGSIb3DQEBAgUAA0EARfI+2huFXK9jsROeK+CaohcB23cBFjzqhslhI50UU</span>
 <span class="docEmphStrong">Y4rBx8QhcApY/g+mhXzBz1JPe/HANQMG567DHB3AJKaTQ==</span></pre></div><br />
<p class="docText"><span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_026">CA</a></span> <span class="docEmphSmaller">CERTIFICATE</span>. The certificate of one of the CAs in the chain from the sender to the IPRA. The first one certifies the sender's CA, the next one certifies the sender's CA's parent, ..., the last one certifies the IPRA. However, it is permissible to include in the message only an initial subsequence of this certificate chain (even an empty subsequence!), as long as no certificates are skipped.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">MIC-Info: RSA-MD5,RSA,FUiVRM3x5Ku0aZveGIJ1hv/hi3Iowpm1iypd9VP7MGw</span>
 <span class="docEmphStrong">PPQra+42TkbR/2jhnqXyVEXLaJ7BSyNhBh/9znIUj5uk0N7IXeBxX</span></pre></div><br />
<p class="docText">M<span class="docEmphSmaller">ESSAGE</span> D<span class="docEmphSmaller">IGEST</span> A<span class="docEmphSmaller">LGORITHM</span>, M<span class="docEmphSmaller">ESSAGE</span> D<span class="docEmphSmaller">IGEST</span> E<span class="docEmphSmaller">NCRYPTION</span> A<span class="docEmphSmaller">LGORITHM</span>, MIC. The choices for message digest algorithm are <span class="docEmphRomanAlt">RSA-MD2</span> and <span class="docEmphRomanAlt">RSA-MD5</span>. RSA-MD2 is merely MD2. RSA-MD5 is MD5. In both cases, RSA is included in the name to acknowledge that MD2 and MD5 were donated for use in PEM by RSADSI. The choices for message digest encryption algorithm are <span class="docEmphRomanAlt">RSA</span>. (Luckily RSA is a good choice). The MIC (the message digest encrypted with the sender's private key, then encrypted with the per-message key) is an encoded 512-bit number.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Recipient-ID-Asymmetric: MEMxCzAJBgNVBAYTAlVTMSYwJAYDVQQKEx1EaWdp</span>
 <span class="docEmphStrong">dGFsIEVxdWlwbWVudCBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDTEtH,729</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">RECIPIENT ID</span>. This is an identifier for a recipient's certificate. It consists of the X.500 name of the CA that issued this recipient's certificate, coded in ASN.1 and encoded 6 bits per character, followed by a comma, followed by the serial number of the certificate in decimal using decimal digits. In the above example, the serial number is 729. Note that identifying the recipient in this arcane manner, rather than simply by name, allows a recipient with multiple public keys to know which key to use to decrypt his <span class="docEmphSmaller">KEY-INFO</span> field:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Key-Info: RSA,dpUp7/QoY9YOZzZCVcIwxIDMN0WbGCFAGN3T+xlV/0pBu2n5+x8</span>
 <span class="docEmphStrong">PmBvMUN0NcBi5vtqBS4cfmgShiK0I4zu05Q==</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">KEY-INFO.</span> This field provides the recipient (identified by the immediately preceding <span class="docEmphSmaller">RECIPIENT</span> ID field) with the per-message key. The second subfield contains the per-message key encrypted with the recipient's public key and then encoded. The first subfield specifies the cryptographic algorithm used for encrypting the per-message key. The only defined public key algorithm is <span class="docEmphRomanAlt">RSA</span>. Note that even if there were more choices, there would be no reason to specify the algorithm since the algorithm is whatever algorithm is specified for the key in the recipient's certificate. However, bit-bumming the encoding of mail messages did not seem to be a priority with the PEM designers.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">21OHDuHTP5BABnlsqENz1WVerZxxWo2AsPHhm2SIz9qpLMvxT/x0+8UEf8dDsTDr</span>
<span class="docEmphStrong">wbQo9/x+</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">ENCRYPTED MESSAGE</span>. The message DES-CBC encrypted with the per-message key and then encoded.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----END PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">POST-ENCAPSULATION BOUNDARY</span>. This is just to show that a PEM-processed portion of the mail message has ended.</p>
<a name="ch21lev2sec3"></a>
<h4 id="title-IDAMPQRH" class="docSection2Title">21.15.2. ENCRYPTED, Secret Key Variant</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,ENCRYPTED</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Content-Domain: RFC822</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message form</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>DEK-Info: DES-CBC,</tt></span><span class="docEmphItalicAlt">16 hex digits</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message encryption algorithm, IV</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-ID-Symmetric:</tt></span> <span class="docEmphItalicAlt">entity identifier</span><span class="docEmphStrong"><tt>,</tt></span><span class="docEmphItalicAlt">issuing authority</span><span class="docEmphStrong"><tt>,</tt></span><span class="docEmphItalicAlt">version/expiration</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender ID</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Recipient-ID-Symmetric:</span> <span class="docEmphItalicAlt">entity identifier</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">issuing authority</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">version/expiration</span>
<span class="docEmphStrong">Key-Info: DES-ECB,RSA-MD</span><span class="docEmphItalicAlt">x</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">16 hex digits</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">32 hex digits</span>
                          .
                          .
                          .</pre></div><br /></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">for each recipient: recipient ID; key-info for recipient</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">blank line</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">encoded encrypted message</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">PRE-ENCAPSULATION BOUNDARY</span>. This is just to show that a PEM-processed portion of the mail message is about to begin.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Proc-Type: 4,ENCRYPTED</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE TYPE</span>. The first subfield (<span class="docEmphRomanAlt">4</span>) specifies that this is version four of PEM. There are currently no other legal values for this field. The second subfield (<span class="docEmphRomanAlt">ENCRYPTED</span>) specifies that this is an encrypted message. The other legal values for this field are <span class="docEmphRomanAlt">MIC-ONLY</span> and <span class="docEmphRomanAlt">MIC-CLEAR</span>.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Content-Domain: RFC822</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE FORM</span>. The intention is that there might eventually be lots of types of mail messages, such as PostScript, spreadsheet, bitmap, executable image for an XYZ processor, and so on. However, the only defined type is <span class="docEmphRomanAlt">RFC822</span>, which is an Internet standard for ordinary text messages.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">DEK-Info: DES-CBC,0123456789ABCDEF</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">MESSAGE ENCRYPTION ALGORITHM, IV</span>. The first subfield identifies the cryptographic algorithm used to encrypt the message. Currently the only &quot;registered&quot; algorithm is <span class="docEmphRomanAlt">DES-CBC</span>. The second subfield specifies the IV as 16 hex digits. So in the example above, the IV is 0123456789ABCDEF<sub>16</sub>.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Originator-ID-Symmetric: Alice@Wonderland.edu,,</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">SENDER ID</span>. This field uniquely identifies the sender to the recipients. There are three subfields. The first subfield identifies the sender. The other two subfields are useless, but are there to make the sender ID have the same format as the recipient IDs. In practice, the two useless subfields are omitted (except for the delimiting commas). There is no standard for the format of any of the subfields, but RFC 1421 strongly recommends using an internet mail address for the first subfield.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Recipient-ID-Symmetric: WhiteRabbit@Wonderland.edu,</span>
 <span class="docEmphStrong">MadHatter@Wonderland.edu,1</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">RECIPIENT ID</span>. This field uniquely identifies the interchange key to be used by the recipient. There are three subfields. The first subfield identifies the recipient (so that the recipient knows this field and the immediately following <span class="docEmphSmaller">KEY-INFO</span> field are for him). The second subfield identifies the issuer of the shared key (in the event that multiple issuing authorities have assigned shared keys between the sender and recipient). The third subfield uniquely identifies the key (in the event that multiple keys have been issued between the sender and recipient by the same issuing authority). There is no standard for the format of any of the subfields, but RFC 1421 strongly recommends using an internet mail address for the first subfield.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Key-Info: DES-ECB,RSA-MD5,0123456789ABCDEF,</span>
 <span class="docEmphStrong">FEDCBA98765432100123456789ABCDEF</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">KEY-INFO</span>. This field provides the recipient (identified by the immediately preceding <span class="docEmphSmaller">RECIPIENT</span> ID field) with the per-message key and the MIC. The first subfield specifies the cryptographic algorithm used to encrypt the per-message key. The choices are <span class="docEmphRomanAlt">DES-ECB</span> (see &sect;<a class="docLink" href="ch04lev1sec2.html#ch04lev2sec1">4.2.1</a> <span class="docEmphasis">Electronic Code Book (ECB)</span>) and <span class="docEmphRomanAlt">DES-EDE</span> (see &sect;<a class="docLink" href="ch04lev1sec4.html#ch04lev1sec4">4.4</a> <span class="docEmphasis">Multiple Encryption DES</span>). <span class="docEmphRomanAlt">DES-EDE</span> is used when the shared interchange key is double length. The second subfield <a name="iddle1653"></a><a name="iddle1655"></a>specifies the algorithm used to compute the message digest. The choices are <span class="docEmphRomanAlt">RSA-MD2</span> (for MD2) and <span class="docEmphRomanAlt">RSA-MD5</span> (for MD5). The third subfield is the per-message key encrypted with the interchange key, expressed as a 16-digit hexadecimal number. The fourth subfield is the MIC, which is the message digest encrypted with the per-message key in ECB mode, expressed as a 32-digit hexadecimal number.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">21OHDuHTP5BABnlsqENz1WVerZxxWo2AsPHhm2SIz9qpLMvxT/x0+8UEf8dDsTDr</span>
<span class="docEmphStrong">wbQo9/x+</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">ENCRYPTED MESSAGE</span>. The message DES-CBC encrypted with the per-message key and then encoded.</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----END PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText"><span class="docEmphSmaller">POST-ENCAPSULATION BOUNDARY</span>. This is just to show that a PEM-processed portion of the mail message has ended.</p>
<a name="ch21lev2sec4"></a>
<h4 id="title-IDAR5QRH" class="docSection2Title">21.15.3. MIC-ONLY or MIC-CLEAR, Public Key Variant</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,MIC-ONLY</tt></span> <span class="docEmphItalicAlt">or</span> <span class="docEmphStrong"><tt>MIC-CLEAR</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Content-Domain: RFC822</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message form</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-Certificate:</tt></span> <span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender's encoded certificate (optional)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-ID-Asymmetric:</tt></span> <span class="docEmphItalicAlt">cybercrud,number</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender ID (present only if sender's certificate not present)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Issuer-Certificate:</span> <span class="docEmphItalicAlt">cybercrud</span>
                  .
                  .
                  .</pre></div><br /></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sequence of zero or more CA certificates (possibly whole chain from sender to the root)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>MIC-Info: RSA-MD</tt></span><span class="docEmphItalicAlt">x</span><span class="docEmphStrong"><tt>,RSA,</tt></span> <span class="docEmphItalicAlt">cybercrud</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message digest algorithm, message digest encryption algorithm, encoded MIC</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">blank line</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphItalicAlt">message</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message (encoded if MIC-ONLY)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<p class="docText">The only differences between an <span class="docEmphRomanAlt">ENCRYPTED</span> public key PEM message and a <span class="docEmphRomanAlt">MIC-ONLY</span> or <span class="docEmphRomanAlt">MIC-CLEAR</span> public key PEM message are the following:</p>
<ul><li><p class="docList">The <span class="docEmphSmaller">TYPE OF MESSAGE</span> field specifies <span class="docEmphRomanAlt">MIC-ONLY</span> or <span class="docEmphRomanAlt">MIC-CLEAR</span>.</p></li><li><p class="docList">The MIC is not encrypted, though it is encoded 6 bits per character.</p></li><li><p class="docList">The message is not encrypted; for <span class="docEmphRomanAlt">MIC-ONLY</span> it is encoded 6 bits per character, while for <span class="docEmphRomanAlt">MIC-CLEAR</span> it is included unmodified (except for the insertion of a &quot;<span class="docEmphRomanAlt">-</span>&quot; before each beginning-of-line &quot;<span class="docEmphRomanAlt">-</span>&quot;).</p></li><li><p class="docList">The <span class="docEmphSmaller">MESSAGE ENCRYPTION ALGORITHM, IV</span> field is omitted.</p></li><li><p class="docList">All the fields giving per-recipient information are omitted.</p></li><li><p class="docList">The <span class="docEmphSmaller">KEY-INFO</span> field for giving information about the sender's key is omitted.</p></li></ul>
<a name="ch21lev2sec5"></a>
<h4 id="title-IDAYJRRH" class="docSection2Title">21.15.4. MIC-ONLY and MIC-CLEAR, Secret Key Variant</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,MIC-ONLY</tt></span> <span class="docEmphItalicAlt">or</span> <span class="docEmphStrong"><tt>MIC-CLEAR</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Content-Domain: RFC822</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message form</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Originator-ID-Symmetric:</tt></span> <span class="docEmphItalicAlt">entity identifier</span><span class="docEmphStrong"><tt>,</tt></span><span class="docEmphItalicAlt">issuing authority</span><span class="docEmphStrong"><tt>,</tt></span><span class="docEmphItalicAlt">version/expiration</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">sender ID</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Recipient-ID-Symmetric:</span> <span class="docEmphItalicAlt">entity identifier</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">issuing authority</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">version/expiration</span>
<span class="docEmphStrong">Key-Info: DES-ECB,RSA-MD</span><span class="docEmphItalicAlt">x</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">16 hex digits</span><span class="docEmphStrong">,</span><span class="docEmphItalicAlt">32 hex digits</span>
                          .
                          .
                          .</pre></div><br /></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">for each recipient:</span></p>
<p class="docText"><span class="docEmphRomanAlt">recipient ID; key-info for recipient</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">blank line</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphItalicAlt">message</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message (encoded if MIC-ONLY)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<p class="docText">The only differences between an <span class="docEmphRomanAlt">ENCRYPTED</span> secret key PEM message and a <span class="docEmphRomanAlt">MIC-ONLY</span> or <span class="docEmphRomanAlt">MIC-CLEAR</span> secret key PEM message are the following:</p>
<ul><li><p class="docList">The <span class="docEmphSmaller">TYPE OF MESSAGE</span> field specifies <span class="docEmphRomanAlt">MIC-ONLY</span> or <span class="docEmphRomanAlt">MIC-CLEAR</span>.</p></li><li><p class="docList">The message is not encrypted; for <span class="docEmphRomanAlt">MIC-ONLY</span> it is encoded 6 bits per character, while with <span class="docEmphRomanAlt">MIC-CLEAR</span> it is included unmodified (except for the insertion of a &quot;<span class="docEmphRomanAlt">-</span>&quot; before each beginning-of-line &quot;<span class="docEmphRomanAlt">-</span>&quot;).</p></li><li><p class="docList">The <span class="docEmphSmaller">MESSAGE ENCRYPTION ALGORITHM, IV</span> field is omitted.</p></li></ul>
<a name="ch21lev2sec6"></a>
<h4 id="title-IDAQTRRH" class="docSection2Title">21.15.5. CRL-Retrieval-Request</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1152"></a><a name="iddle1222"></a><a name="iddle1590"></a><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,CRL-RETRIEVAL-REQUEST</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Issuer:</span> <span class="docEmphItalicAlt">cybercrud</span>
                 .
                 .
                 .</pre></div><br /></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">for each CRL requested: the encoded X.500 name of the issuing CA</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<a name="ch21lev2sec7"></a>
<h4 id="title-IDAZXRRH" class="docSection2Title">21.15.6. CRL</h4>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="275"></col><col width="275"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----BEGIN PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">pre-encapsulation boundary</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>Proc-Type: 4,CRL</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">type of PEM message (version,type)</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">CRL:</span> <span class="docEmphItalicAlt">cybercrud</span>
<span class="docEmphStrong">Originator-Certificate:</span> <span class="docEmphItalicAlt">cybercrud</span>
                   .
                   .
                   .</pre></div><br /></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">for each CRL retrieved: encoded X.509 format CRL; encoded X.509 certificate of the CA that issued the CRL</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphStrong"><tt>----END PRIVACY-ENHANCED MESSAGE-----</tt></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">post-encapsulation boundary</span></p></td></tr></table></p><br />
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch21lev1sec14.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch21lev1sec16.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>