<html><head><title>22.10. Object Formats</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch22lev1sec9.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="part05.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch22lev1sec10"></a>
<h3 id="title-IDALTZQL" class="docSection1Title">22.10. Object Formats</h3>
<p class="docText">PGP reads and writes a variety of objects. Objects may contain a variety of fields, and some objects contain other objects. Each object can be represented in two formatsÂ<span class="docEmphasis">compact</span> and <i><a class="docLink" href="app02.html#gloss01_209">SMTP</a></i> <span class="docEmphasis">mailable</span>. The SMTP mailable format is computed from the compact format by performing the same encoding that PEM uses (see &sect;<a class="docLink" href="ch21lev1sec7.html#ch21lev1sec7">21.7</a> <span class="docEmphasis">Reformatting Data to Get Through Mailers</span>) and adding a human-readable header and trailer so that a human (or a smart mail receiver) will know the cyber-crud between the header and trailer needs to be processed by PGP. The human-readable header is</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PGP MESSAGE-----</span>
<span class="docEmphStrong">Version 2.2</span></pre></div><br />
<p class="docText">and the human readable trailer is</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----END PGP MESSAGE-----</span></pre></div><br />
<a name="ch22lev2sec3"></a>
<h4 id="title-IDAOVZQL" class="docSection2Title">22.10.1. Message Formats</h4>
<p class="docText"><a name="iddle1167"></a><a name="iddle1447"></a>PGP messages are composed of a sequence of primitive objects (see &sect;<a class="docLink" href="#ch22lev2sec4">22.10.2</a> <span class="docEmphasis">Primitive Object Formats</span>). We'll describe the message formats in this section.</p>
<a name="ch22lev3sec1"></a>
<h5 id="title-IDAOWZQL" class="docSection3Title">Encrypted Message</h5>
<p class="docText">PGP encrypts messages with the secret key algorithm IDEA using 64-bit CFB mode with a randomly chosen IV that is included with the message. The sending PGP chooses a random IDEA key for encrypting the message, and then encrypts that IDEA key with the public key of the recipient, placing the encrypted IDEA key in the header. If the message is being sent to multiple recipients, the IDEA key is individually encrypted with the key of each recipient, and all the encrypted keys are placed in the header.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="rows" cellpadding="4"><colgroup align="left" span="1"><col width="350"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient<sub>1</sub>'s public key</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient<sub>2</sub>'s public key</span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient<span class="docEmphasis"><sub>k</sub></span>'s public key</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message encrypted with IDEA key</span></p></td></tr></table></p><br />
<p class="docText">When the final object is decrypted with the IDEA key, the result is either <span class="docEmphSmaller">PLAINTEXT DATA</span> or <span class="docEmphSmaller">COMPRESSED DATA</span>, depending on whether PGP decided the data was compressible. If PGP decided the data was compressible, then when the <span class="docEmphSmaller">COMPRESSED DATA</span> is uncompressed, the result is <span class="docEmphSmaller">PLAINTEXT DATA</span>.</p>
<a name="ch22lev3sec2"></a>
<h5 id="title-IDAI0ZQL" class="docSection3Title">Signed Message</h5>
<p class="docText">This is likely to be <span class="docEmphSmaller">COMPRESSED DATA</span>. When uncompressed, the result is</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="rows" cellpadding="4"><colgroup align="left" span="1"><col width="100"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">plaintext data</span></p></td></tr></table></p><br />
<a name="ch22lev3sec3"></a>
<h5 id="title-IDAB2ZQL" class="docSection3Title">Encrypted Signed Message</h5>
<p class="docText">This is just like an <span class="docEmphSmaller">ENCRYPTED MESSAGE</span>, but with the message replaced by a <span class="docEmphSmaller">SIGNED MESSAGE</span>.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="rows" cellpadding="4"><colgroup align="left" span="1"><col width="350"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient<sub>1</sub>'s public key</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient<sub>2</sub>'s public key</span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with recipient</span><span class="docEmphasis"><sub>k</sub></span>'s public key</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">signed message encrypted with IDEA key</span></p></td></tr></table></p><br />
<p class="docText"><a name="iddle1186"></a><a name="iddle1232"></a>When the final object is decrypted with the IDEA key, the result will probably be <span class="docEmphSmaller">COMPRESSED DATA</span> (unless PGP noticed that it was not compressible), which when uncompressed is a <span class="docEmphSmaller">SIGNED MESSAGE</span>.</p>
<a name="ch22lev3sec4"></a>
<h5 id="title-IDAJIV1H" class="docSection3Title">Signed Human-Readable Message</h5>
<p class="docText">Usually PGP modifies even an unencrypted message before mailing it, for two reasons. It compresses it for ecological reasons (saves bits), and it encodes it so it will have some hope of making it through mailers unmodified. This is nice but it means that if the recipient does not have PGP, the human at the other end will not be able to read the message (see &sect;<a class="docLink" href="ch21lev1sec7.html#ch21lev1sec7">21.7</a> <span class="docEmphasis">Reformatting Data to Get Through Mailers</span>). So PGP allows you to tell it not to muck with the message. You will hold PGP harmless if the message gets modified by mailers and the signature then does not verify. This form of message is</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="rows" cellpadding="4"><colgroup align="left" span="1"><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PGP SIGNED MESSAGE-----</span></pre></div><br /></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">cleartext message</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PGP SIGNATURE-----</span>
<span class="docEmphStrong">Version: 2.2</span></pre></div><br /></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><div class="docText"><pre>50</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----END PGP SIGNATURE-----</span></pre></div><br /></p></td></tr></table></p><br />
<p class="docText">Just like with PEM, we have to ensure that the string</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PGP SIGNATURE-----</span></pre></div><br />
<p class="docText">does not appear in the text of the message. And just like PEM, PGP protects against such a mishap by prepending '<span class="docEmphStrong"><tt>-</tt></span>' to any line that begins with '<span class="docEmphStrong"><tt>-</tt></span>'. The PGP at the receiver is smart enough to strip that off before attempting to verify the signature.</p>
<a name="ch22lev2sec4"></a>
<h4 id="title-IDA4MV1H" class="docSection2Title">22.10.2. Primitive Object Formats</h4>
<p class="docText">Primitive object formats are</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="none" cellpadding="5"><colgroup align="left" span="3"><col width="50"></col><col width="100"></col><col width="175"></col></colgroup><thead></thead><tr><td class="rightBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">CTB</span></p></td><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphasis">length</span></p></td><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphasis">stuff</span></p></td></tr></table></p><br />
<p class="docText">where <span class="docEmphStrong">CTB</span> stands for <span class="docEmphStrong">cipher type byte</span> (aren't you glad you asked?) and specifies the PGP object type and the length of <span class="docEmphasis">length</span>. We'll describe the interpretation of <span class="docEmphasis">stuff</span> for the various object types in this section.</p>
<p class="docText">Certain object types contain one or more integers in their stuff field. Integers are encoded as a length in bits (two octets, most significant first) followed by the binary integer with leading <span class="docEmphRomanAlt">0</span> bits to pad to a multiple of 8 bits then packed into octets most significant first.</p>
<p class="docText">The CTB is interpreted bit by bit (most significant to least significant) as follows:</p>
<blockquote><p></p><p class="docList">bit 7: <span class="docEmphRomanAlt">1</span></p><p></p><p class="docList">bit 6: reserved, i.e. set to <span class="docEmphRomanAlt">0</span> and ignored</p><p></p><p class="docList">bit 5Â2: a 4-bit field indicating which type of object follows. The defined values are</p><p></p><p class="docList"><a name="iddle1816"></a><span class="docEmphRomanAlt">0001</span>Âsomething encrypted using someone's public key (the only thing ever actually encrypted this way is an IDEA key)</p><p></p><p class="docList"><span class="docEmphRomanAlt">0010</span>Âsignature</p><p></p><p class="docList"><span class="docEmphRomanAlt">0101</span>Âprivate key encrypted with a password</p><p></p><p class="docList"><span class="docEmphRomanAlt">0110</span>Âpublic key</p><p></p><p class="docList"><span class="docEmphRomanAlt">1000</span>Âcompressed data</p><p></p><p class="docList"><span class="docEmphRomanAlt">1001</span>Âsomething encrypted with a secret key</p><p></p><p class="docList"><span class="docEmphRomanAlt">1011</span>Âplaintext data plus a file name and mode (binary or text)</p><p></p><p class="docList"><span class="docEmphRomanAlt">1100</span>Âkey ring trust information</p><p></p><p class="docList"><span class="docEmphRomanAlt">1101</span>Âuser identification</p><p></p><p class="docList"><span class="docEmphRomanAlt">1110</span>Âcomment</p></blockquote>
<p class="docText">bits 1Â0: a 2-bit field indicating the length of the length field. The defined values are:</p>
<blockquote><p></p><p class="docList"><span class="docEmphRomanAlt">00</span>Â1-octet length field follows CTB</p><p></p><p class="docList"><span class="docEmphRomanAlt">01</span>Â2-octet length field follows CTB</p><p></p><p class="docList"><span class="docEmphRomanAlt">10</span>Â4-octet length field follows CTB</p><p></p><p class="docList"><span class="docEmphRomanAlt">11</span>Âthere is no length field (this can only occur for the last object in a messageÂthe length is to the externally determined end of data)</p></blockquote>
<a name="ch22lev3sec5"></a>
<h5 id="title-IDAFUV1H" class="docSection3Title">Key Encrypted under a Public Key (0001 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="300"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span> (2)</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">8 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">key ID (low order 64 bits of RSA modulus)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">algorithm ID (</span>1<span class="docEmphRomanAlt"> for RSA, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key encrypted with RSA</span></p></td></tr></table></p><br />
<a name="ch22lev3sec6"></a>
<h5 id="title-IDAQYV1H" class="docSection3Title">IDEA key before RSA-encryption</h5>
<p class="docText">PGP follows the PKCS #1 standard, which defines how to encrypt something with RSA, usually a key (see &sect;<a class="docLink" href="ch06lev1sec3.html#ch06lev2sec9">6.3.6</a> <span class="docEmphasis">Public-Key Cryptography Standard (PKCS)</span>). PGP encrypts a little more than just the IDEA key. PGP encrypts a 19-octet quantity consisting of an octet = <span class="docEmphRomanAlt">1</span>, the 16-octet IDEA key, and a 2-octet CRC-16 of the IDEA key. The purpose of the extra data is so that in case you accidentally decrypt with the wrong RSA key the contents will not look right. So PGP encrypts, using RSA,</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="cols" cellpadding="5"><colgroup align="center" span="7"><col width="20"></col><col width="30"></col><col width="200"></col><col width="30"></col><col width="30"></col><col width="100"></col><col width="75"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">0</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt"><span class="docEmphasis">n</span> random non-zero octets</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">0</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">IDEA key</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">CRC</span></p></td></tr></table></p><br />
<a name="ch22lev3sec7"></a>
<h5 id="title-IDAT2V1H" class="docSection3Title">Signature (0010 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="75"></col><col width="475"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText"><a name="iddle2000"></a>field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span> (2)</p></td></tr><tr><td class="rightBorder" align="center" valign="middle"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt"># of octets before key ID field</span></p>
<p class="docText"><span class="docEmphRomanAlt">(</span>5<span class="docEmphRomanAlt"> if validity period missing, else</span> 7 <span class="docEmphRomanAlt">)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature type (see below)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">4 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">time when signed</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">0 or 2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="middle"><p class="docText"><span class="docEmphRomanAlt">validity period in days (</span> 0 <span class="docEmphRomanAlt">means infinite)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">8 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">key ID (low order 64 bits of RSA key)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key algorithm (</span> 1 <span class="docEmphRomanAlt">for RSA, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message digest algorithm (</span> 1 <span class="docEmphRomanAlt">for MD5, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">first two octets of message digest, to reassure us that we decrypted with the proper key</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message digest signed with RSA (see below)</span></p></td></tr></table></p><br />
<p class="docText">The defined signature types (written in hex) are</p>
<blockquote><p></p><p class="docList"><span class="docEmphRomanAlt">00</span>Âsignature on a binary message or document</p><p></p><p class="docList"><span class="docEmphRomanAlt">01</span>Âsignature on a text message with &lt;CR&gt;&lt;LF&gt; indicating EOL</p><p></p><p class="docList"><span class="docEmphRomanAlt">10</span>Âcertificate with unspecified assurance</p><p></p><p class="docList"><span class="docEmphRomanAlt">11</span>Âkey certification with no assurance</p><p></p><p class="docList"><span class="docEmphRomanAlt">12</span>Âkey certification with casual assurance</p><p></p><p class="docList"><span class="docEmphRomanAlt">13</span>Âkey certification with heavy-duty assurance</p><p></p><p class="docList"><span class="docEmphRomanAlt">20</span>Âkey revocation (attempt to revoke key that signed this)</p><p></p><p class="docList"><span class="docEmphRomanAlt">30</span>Âcertificate revocation (revokes a certificate signed with the key that signed this)</p><p></p><p class="docList"><span class="docEmphRomanAlt">40</span>Âsignature of a signature (notary service)</p></blockquote>
<p class="docText">The message digest is computed on</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="cols" cellpadding="5"><colgroup align="center" span="4"><col width="175"></col><col width="150"></col><col width="100"></col><col width="125"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">message to be signed</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature type</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">timestamp</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">validity period</span></p></td></tr></table></p><br />
<p class="docText">The quantity signed using RSA is</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="cols" cellpadding="5"><colgroup align="left" span="6"><col width="30"></col><col width="30"></col><col width="125"></col><col width="30"></col><col width="175"></col><col width="125"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">0</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">1</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis"><span class="docEmphRomanAlt">n</span></span> <span class="docEmphRomanAlt">octets of FF<sub>16</sub></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">0</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">3020300c06082a864886f70d020505000410<sub>16</sub></span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message digest</span></p></td></tr></table></p><br />
<p class="docText">The 18-octet constant is ASN.1 cybercrud meaning MD5.</p>
<a name="ch22lev3sec8"></a>
<h5 id="title-IDAMNW1H" class="docSection3Title">Private key encrypted with password (0101 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="75"></col><col width="475"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText"><a name="iddle1766"></a><a name="iddle1856"></a><a name="iddle1875"></a>field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span> (2)</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">4 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">time when key created</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">validity period in days (</span> 0 <span class="docEmphRomanAlt">means infinite)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key algorithm (</span> 1 <span class="docEmphRomanAlt">for RSA, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public modulus</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public exponent</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">algorithm encrypting private key (</span> 1 <span class="docEmphRomanAlt">for IDEA, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">8 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">random if key encrypted, else</span> 0</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">encrypted quantity</span></p></td></tr></table></p><br />
<p class="docText">The encrypted quantity, before encryption, looks like</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="75"></col><col width="475"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">private exponent</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphasis"><span class="docEmphRomanAlt">p</span></span> <span class="docEmphRomanAlt">(the first prime, in format of integer)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphasis"><span class="docEmphRomanAlt">q</span></span> <span class="docEmphRomanAlt">(the second prime, in format of integer)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">information for speeding up the RSA operations (see &sect;<a class="docLink" href="ch06lev1sec3.html#ch06lev3sec4">6.3.4.4</a> <span class="docEmphasis">Optimizing RSA Private Key Operations</span>)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">CRC-16 of preceding fields</span></p></td></tr></table></p><br />
<p class="docText">Encryption is done using IDEA in 64-bit CFB mode (see &sect;<a class="docLink" href="ch03lev1sec4.html#ch03lev1sec4">3.4</a> <span class="docEmphasis">International Data Encryption Algorithm (IDEA)</span> and &sect;<a class="docLink" href="ch04lev1sec2.html#ch04lev1sec2">4.2</a> <span class="docEmphasis">Encrypting a Large Message</span>)</p>
<a name="ch22lev3sec9"></a>
<h5 id="title-IDAX1W1H" class="docSection3Title">Public key (0110 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="75"></col><col width="475"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span> (2)</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">4 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">time when key created</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">validity period in days (</span> 0 <span class="docEmphRomanAlt">means infinite)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key algorithm (</span>1 <span class="docEmphRomanAlt">for RSA, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public modulus</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">integer</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">public exponent</span></p></td></tr></table></p><br />
<a name="ch22lev3sec10"></a>
<h5 id="title-IDAQBX1H" class="docSection3Title">Compressed Data (1000 in CTB)</h5>
<p class="docText">Any PGP object or sequence of objects can be compressed.</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="75"></col><col width="475"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">compression algorithm (</span>1 <span class="docEmphRomanAlt">for ZIP, no others defined)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">compressed data</span></p></td></tr></table></p><br />
<a name="ch22lev3sec11"></a>
<h5 id="title-IDAREX1H" class="docSection3Title">Something Encrypted with a Secret Key (1001 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText"><a name="iddle1503"></a><a name="iddle1540"></a><a name="iddle1825"></a>field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">encrypted data</span></p></td></tr></table></p><br />
<p class="docText">Encryption is done using IDEA in 64-bit CFB mode with an IV of 0. The data being encrypted is</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="300"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">8 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">random data</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">last two octets of random data</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">unencrypted data</span></p></td></tr></table></p><br />
<p class="docText">The purpose of the random data is so that successive encryptions of the same unencrypted data will result in different ciphertext. The purpose of repeating the last two octets of random data is to recognize that decryption worked properly.</p>
<a name="ch22lev3sec12"></a>
<h5 id="title-IDATKX1H" class="docSection3Title">Plaintext Data (1011 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">mode (ASCII</span> b <span class="docEmphRomanAlt">for binary,</span> t <span class="docEmphRomanAlt">for text)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of following field in octets</span></p></td></tr><tr><td class="rightBorder" align="left" valign="top">&nbsp;</td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">file name (ASCII string)</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">4 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">time file last modified, or</span> 0</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">message</span></p></td></tr></table></p><br />
<a name="ch22lev3sec13"></a>
<h5 id="title-IDAPPX1H" class="docSection3Title">Key Ring</h5>
<p class="docText">The key ring stores public keys and information about each key. The information about each key consists of the name of the human associated with the key (the user ID), the set of certificate signatures you've received vouching for the fact that that user has that public key, and trust information about each of the pieces of information. Key revocations and certificate revocations (see <span class="docEmphSmaller">SIGNATURE</span> object format) are also stored on the key ring.</p>
<p class="docText">So the key ring looks like</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="9"><col width="100"></col><col width="50"></col><col width="50"></col><col width="50"></col><col width="50"></col><col width="50"></col><col width="30"></col><col width="50"></col><col width="50"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">user ID</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">...</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">user ID</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">...</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td></tr><tr><td class="docTableCell" align="center" valign="top" colspan="9"><p class="docText"><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span><br /><span class="docEmphRomanAlt">.</span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">public key</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">user ID</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">...</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">trust</span></p></td></tr></table></p><br />
<p class="docText">The trust information following the public key indicates how much that public key is trusted to sign things, and is manually set. If the key has been revoked, the key revocation is inserted immediately before the user ID. The trust information following the user ID indicates how much confidence is placed on the public key belonging to the user, and is computed from the trust information following the signatures. The trust information following each signature is copied from the trust information of the public key that did the signing. Certificate revocations are included with the normal signatures.</p>
<p class="docText">PGP encourages people to share the information in their key rings. However, users should make their own trust decisions. So when key ring information is transmitted, the trust information is removed.</p>
<a name="ch22lev3sec14"></a>
<h5 id="title-IDAG0X1H" class="docSection3Title">Key Ring Trust Information (1100 in CTB)</h5>
<p class="docText">Since this format is only used locally, we won't bother documenting its gory details, but we will say that it has two different interpretations depending on whether the previous item is a user ID or not.</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1 octet</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">how much the preceding item should be trusted</span></p></td></tr></table></p><br />
<a name="ch22lev3sec15"></a>
<h5 id="title-IDAM2X1H" class="docSection3Title">User Identification (1101 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">ASCII string giving user's name, perhaps email address also</span></p></td></tr></table></p><br />
<a name="ch22lev3sec16"></a>
<h5 id="title-IDAQ4X1H" class="docSection3Title">Comment (1110 in CTB)</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="100"></col><col width="200"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top">&nbsp;</td><td class="bottomBorder" align="center" valign="top"><p class="docText">field description</p></td></tr><tr><td class="rightBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">Â</span></p></td><td class="rightBorder bottomBorder" align="left" valign="top"><p class="docText"><span class="docEmphRomanAlt">ASCII string</span></p></td></tr></table></p><br />
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch22lev1sec9.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="part05.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>