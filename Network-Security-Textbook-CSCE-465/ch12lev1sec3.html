<html><head><title>12.3. Strong Password Protocols</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch12lev1sec2.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch12lev1sec4.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch12lev1sec3"></a>
<h3 id="title-IDAQEMLP" class="docSection1Title">12.3. Strong Password Protocols</h3>
<p class="docText">Strong password protocols are designed so that someone who eavesdrops on an authentication exchange, or someone impersonating either end will not obtain enough information to do off-line verification of password guesses. An eavesdropper should not be able to gain any information from observing any number of legitimate exchanges. Someone impersonating either endpoint will be able to do a single on-line password guess. There's really no way to avoid that. If someone correctly guesses the password, they will be able to successfully authenticate. If they guess incorrectly, they will know that they have not successfully authenticated, and therefore their guess must not be the user's password. A false guess will result in an authentication failure, which should generate alarms if they occur in large numbers.</p>
<a name="ch12lev2sec1"></a>
<h4 id="title-IDA1EMLP" class="docSection2Title">12.3.1. The Basic Form</h4>
<p class="docText">Bellovin and Merritt created the first strong password protocol. They called it EKE for <span class="docEmphasis">encrypted key exchange</span>. There are other protocols, but they are all conceptually similar. The idea of EKE is that Alice and Bob share a weak secret <span class="docEmphasis">W</span>, which is a hash of Alice's password. Bob knows <span class="docEmphasis">W</span> because he stores <span class="docEmphasis">W</span>. Alice knows <span class="docEmphasis">W</span> because she computes it from the password.</p>
<p class="docText">They do a Diffie-Hellman exchange, encrypting the Diffie-Hellman numbers with <span class="docEmphasis">W</span>, and then do mutual authentication based on the agreed-upon Diffie-Hellman shared secret, which is a strong secret.</p>
<p class="docText">This protocol is quite subtle. The reason it is secure from an eavesdropper is that a Diffie-Hellman transmitted value looks like a random number. An eavesdropper doing a trial decryption of <span class="docEmphasis">W</span>{<span class="docEmphasis">g</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span>} and W{<span class="docEmphasis">g</span><span class="docEmphasis"><sup>b</sup></span> mod <span class="docEmphasis">p</span>} cannot verify a password guess because decrypting with any password will still just look like random numbers. And someone impersonating one side or the other can verify a single password guess as incorrect or correct, but this is an on-line, auditable guess. There is no way to do an off-line dictionary attack. The Diffie-Hellman secret <span class="docEmphasis">K</span> is a strong secret because an attacker would both have to guess the password and break Diffie-Hellman.</p>
<p class="docText">The reason it is secure from someone, say Trudy, impersonating Alice or Bob is that Trudy only knows <span class="docEmphasis">x</span> for one value of <span class="docEmphasis">g</span><span class="docEmphasis"><sup>x</sup></span> mod <span class="docEmphasis">p</span>. Once Trudy encrypts with <span class="docEmphasis">W</span>, she is committing to a single password guess. (See <a class="docLink" href="ch12lev1sec5.html#ch12qa1q14">Homework Problem 14</a>.)</p>
<p class="docText"></p><a name="ch12fig02"></a><p><center>
<h5 class="docFigureTitle">Protocol 12-2. Basic EKE Protocol</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="12fig02_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="207" src="12fig02.jpg" /></p>
<br />
<p class="docText"><a name="iddle1505"></a><a name="iddle1789"></a><a name="iddle2021"></a><a name="iddle2029"></a>Several years later, more or less simultaneously, two other strong password protocols were invented. One was done by Jablon, and was called SPEKE (<span class="docEmphasis">simple password exponential key exchange</span>), and the other was done by Wu and known as SRP (<span class="docEmphasis">secure remote password</span>). We'll describe SRP in section &sect;<a class="docLink" href="#ch12lev2sec4">12.3.4</a> <span class="docEmphasis">SRP (Secure Remote Password)</span>. Several years after SRP and SPEKE, we<sub>1,2</sub> designed PDM (<span class="docEmphasis">password derived moduli</span>).</p>
<p class="docText">SPEKE uses <span class="docEmphasis">W</span> in place of <span class="docEmphasis">g</span> in the Diffie-Hellman exchange, so rather than transmitting <span class="docEmphasis">W</span>{<span class="docEmphasis">g</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span>} and agreeing upon <span class="docEmphasis">K</span> = <span class="docEmphasis">g</span><span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span> (as would be done in EKE), SPEKE transmits <span class="docEmphasis">W</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> and <span class="docEmphasis">W</span><span class="docEmphasis"><sup>b</sup></span> mod <span class="docEmphasis">p</span>, and agrees upon the key <span class="docEmphasis">K</span> = <span class="docEmphasis">W</span><span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span>.</p>
<p class="docText">PDM chooses a modulus <span class="docEmphasis">p</span> which is a function of the password, and uses 2 as the base, so the Diffie-Hellman numbers transmitted are 2<span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> and 2<span class="docEmphasis"><sup>b</sup></span> mod <span class="docEmphasis">p</span>, and the agreed-upon Diffie-Hellman key is 2<span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span>.</p>
<a name="ch12lev2sec2"></a>
<h4 id="title-IDAFLMLP" class="docSection2Title">12.3.2. Subtle Details</h4>
<p class="docText">There is more to making these schemes secure than the basic idea. The original EKE paper proposed many variants of the protocol, many of which were later found to be flawed. The successor protocols have had similar difficulties. To be secure, a protocol must carefully specify some implementation details to avoid an eavesdropper being able to eliminate password guesses. Subsequent papers noted other potential implementation issues. For instance, assume a straightforward encryption of <span class="docEmphasis">g</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> with <span class="docEmphasis">W</span>. Since <span class="docEmphasis">g</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> will be less than <span class="docEmphasis">p</span>, an eavesdropper that does a trial decryption with a guessed password and obtains a value greater than <span class="docEmphasis">p</span> can eliminate that password. If <span class="docEmphasis">p</span> were just a little more than a power of 2, an incorrect password would have almost a 50% chance of being eliminated. Each time an eavesdropper saw a value <span class="docEmphasis">W</span>{<span class="docEmphasis">g</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span>} (each time presumably <a name="iddle1402"></a><a name="iddle1790"></a><a name="iddle1945"></a><a name="iddle2022"></a>with a different <span class="docEmphasis">a</span>), the eavesdropper could eliminate almost half of the passwords. With a dictionary of, say, 50000 potential passwords, the eavesdropper would only need to see about twenty exchanges before narrowing down the possibilities in the dictionary to a single choice.</p>
<p class="docText">If SPEKE were not designed carefully it would also have a flaw whereby an eavesdropper might be able to eliminate some password guesses based on seeing <span class="docEmphasis">W</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span>. The flaw can be eliminated by making sure that <span class="docEmphasis">W</span> is a perfect square mod <span class="docEmphasis">p</span>. Some numbers are generators mod <span class="docEmphasis">p</span> (<span class="docEmphasis">g</span> is a generator if <span class="docEmphasis">g</span><sup>1</sup>, <span class="docEmphasis">g</span><sup>2</sup>, <span class="docEmphasis">g</span><sup>3</sup>,...<span class="docEmphasis">g</span><span class="docEmphasis"><sup>p</sup></span>-<span class="docEmphasis">1</span> mod <span class="docEmphasis">p</span> cycles through all the values from 1 through <span class="docEmphasis">p</span>-1). If <span class="docEmphasis">g</span> is a generator mod <span class="docEmphasis">p</span>, then its even powers are the perfect squares mod <span class="docEmphasis">p</span> (so half of all numbers mod <span class="docEmphasis">p</span> are perfect squares, and any power of a perfect square is also a perfect square). If some of the <span class="docEmphasis">W</span>s generated from passwords for use in SPEKE were perfect squares and some not, then if an eavesdropper Trudy saw a value <span class="docEmphasis">W</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> that was not a perfect square, she would know that none of the passwords that resulted in <span class="docEmphasis">W</span>s that were perfect squares could have been Alice's password (since such a password could not have generated a value that was not a square). (To tell if a number is a perfect square mod <span class="docEmphasis">p</span>, raise it to the power (<span class="docEmphasis">p</span>-1)/2 and see if the result is 1 (mod <span class="docEmphasis">p</span>).) This is a less serious vulnerability than the EKE vulnerability in the previous paragraph, because in each EKE exchange a different half of the passwords could be eliminated. But in this SPEKE vulnerability, half the passwords (the ones for which <span class="docEmphasis">W</span> would be a square) would be eliminated if a value <span class="docEmphasis">W</span><span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> that was not a perfect square were seen by an eavesdropper, but there would be no further narrowing down the possibilities no matter how many exchanges were observed.</p>
<p class="docText">Both the vulnerabilities mentioned are easily avoided. The EKE vulnerability is avoided by choosing a <span class="docEmphasis">p</span> which is just a little less than a power of 2. The SPEKE vulnerability is avoided by ensuring that <span class="docEmphasis">W</span> is a perfect squareÂhash the password, then square it mod <span class="docEmphasis">p</span> to get <span class="docEmphasis">W</span>.</p>
<p class="docText">To build a workable protocol from the basic idea of PDM (generating the modulus deterministically from the password with reasonable performance) involves some math that we won't go into in detail because it's not that important for the purpose of this chapter. (For subtle reasons, using 2 for <span class="docEmphasis">g</span>, the modulus <span class="docEmphasis">p</span> has to be a safe prime, i.e. (<span class="docEmphasis">p</span>-1)/2 must also be prime, and <span class="docEmphasis">p</span> must be equal to 11 mod 24.) And there are other attacks that need to be avoided, including timing attacks and the attack in <a class="docLink" href="ch12lev1sec5.html#ch12qa1q6">Homework Problem 6</a>.</p>
<p class="docText">PDM has interesting performance characteristics. Generating an appropriate prime is very compute-intensive for the client machine (a few seconds). But since the modulus is secret, it is likely that the prime can be smaller than would be considered in traditional Diffie-Hellman, since Diffie-Hellman would have to be broken for each password guess, for each user. If this premise survives scrutiny, PDM can be much more efficient (a factor of about five) for the server. Server performance is more important than client performance because the compute-intensive step of generating the PDM modulus only has to be done once at the client, whereas a server has to process a large and unpredictable number of login attempts.</p>
<a name="ch12lev2sec3"></a>
<h4 id="title-IDATAEZD" class="docSection2Title">12.3.3. Augmented Strong Password Protocols</h4>
<p class="docText"><a name="iddle1072"></a>With the schemes in the previous section, if someone knew <span class="docEmphasis">W</span>, they could impersonate the user. A few years after publishing EKE, Bellovin and Merritt designed a strong password protocol with an additional security property which they called <span class="docEmphasis">augmented EKE</span>. The additional property was preventing someone who has stolen the server database from being able to impersonate the user. The information in the server database would allow an attacker, Trudy, to do a dictionary attack, and if Trudy found the user's password, then she could impersonate the user. But using an augmented form of a strong password protocol, if Trudy's dictionary attack on the stolen server database was unsuccessful, she would not be able to impersonate the user to the server.</p>
<p class="docText">All the basic schemes (EKE, SPEKE, and PDM) can be modified to have the augmented property. Another protocol which we'll describe (SRP) only has an augmented form. The idea is for the server to store a quantity derived from the password that can be used to verify the password, but the client machine is required to know the password (not the derived quantity stored at the server). The scheme in augmented EKE is overly complicated and takes too many messages, so we will instead show a simple scheme with the same properties. The strategy will work with any of the schemes (EKE, SPEKE, and PDM), but we'll show it with PDM.</p>
<p class="docText">The server will store <span class="docEmphasis">p</span>, the safe prime derived from the user's password. The server will also store 2<span class="docEmphasis"><sup>W</sup></span> mod <span class="docEmphasis">p</span>, where <span class="docEmphasis">W</span> is a hash of the user's password. The exchange is as follows:</p>
<a name="ch12fig03"></a><p><center>
<h5 class="docFigureTitle">Protocol 12-3. Augmented form of PDM</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="12fig03_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="153" src="12fig03.jpg" /></p>
<br />
<p class="docText">Bob can compute hash(2<span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span>, 2<span class="docEmphasis"><sup>bW</sup></span> mod <span class="docEmphasis">p</span>) because he knows <span class="docEmphasis">b</span>, 2<span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span>, 2<span class="docEmphasis"><sup>W</sup></span> mod <span class="docEmphasis">p</span>, and <span class="docEmphasis">p</span>. So he can raise each of 2<span class="docEmphasis"><sup>a</sup></span> mod <span class="docEmphasis">p</span> and 2<span class="docEmphasis"><sup>W</sup></span> mod <span class="docEmphasis">p</span> to the power <span class="docEmphasis">b</span>, mod <span class="docEmphasis">p</span>. Similarly, Alice can compute hash'(2<span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span>, 2<span class="docEmphasis"><sup>bW</sup></span> mod <span class="docEmphasis">p</span>) (see <a class="docLink" href="ch12lev1sec5.html#ch12qa1q8">Homework Problem 8</a>).</p>
<p class="docText">In the PDM paper we<sub>1,2</sub> recommend a form of augmentation that is higher performance for the server. Instead of requiring the server to do an additional Diffie-Hellman exponentiation to achieve the augmented property, the server does an RSA verify operation, which is much less expensive. This is accomplished by having Bob store, for Alice, an RSA private key encrypted with <a name="iddle2030"></a><a name="iddle2135"></a>Alice's password, and the corresponding public key. Again, this can be done with any of the basic schemes (EKE, SPEKE, or PDM), but in <a class="docLink" href="#ch12fig04">Protocol 12-4</a> we'll show it using EKE:</p>
<a name="ch12fig04"></a><p><center>
<h5 class="docFigureTitle">Protocol 12-4. Augmentation based on RSA public keys</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="144" src="12fig04.jpg" /></p>
<br />
<p class="docText">In <a class="docLink" href="#ch12fig04">Protocol 12-4</a>, Bob stores <span class="docEmphasis">Y</span>, which is Alice's private key encrypted with a function of her password. (Note that it has to be a different hash of the password than <span class="docEmphasis">W</span>, or else someone that stole the server database would be able to obtain her private key, which breaks the augmented property.) Bob also stores Alice's RSA public key corresponding to the encrypted private key. In message 1, Alice sends the usual first EKE message, consisting of her Diffie-Hellman value encrypted with <span class="docEmphasis">W</span>. In message 2, Bob sends his Diffie-Hellman value, along with <span class="docEmphasis">Y</span> (Alice's encrypted private key), encrypted with the agreed-upon Diffie-Hellman key. Alice extracts <span class="docEmphasis">Y</span> by decrypting with <span class="docEmphasis">g</span><span class="docEmphasis"><sup>ab</sup></span> mod <span class="docEmphasis">p</span>, and then decrypts <span class="docEmphasis">Y</span> with her password to obtain her private key. In message 3, Alice signs a hash of the Diffie-Hellman key and the challenge <span class="docEmphasis">c</span>, and Bob verifies her signature using the stored public key. This achieves mutual authentication as well as the augmented property (see <a class="docLink" href="ch12lev1sec5.html#ch12qa1q9">Homework Problem 9</a>).</p>
<a name="ch12lev2sec4"></a>
<h4 id="title-IDAAHEZD" class="docSection2Title">12.3.4. SRP (Secure Remote Password)</h4>
<p class="docText">SRP was invented by Tom Wu [<a class="docLink" href="biblio01.html#biblio01_171">WU98</a>] and is a popular choice by the IETF for strong password protocols. It is documented in RFC 2945. It is harder to understand than the others, but we describe it here because it does appear in many IETF protocols. Unlike EKE, SPEKE, and PDM, there is no basic form of SRP. The augmented property is an intrinsic part of the protocol.</p>
<p class="docText">SRP is <a class="docLink" href="#ch12fig04">Protocol 12-4</a>. Bob stores <span class="docEmphasis">g</span><span class="docEmphasis"><sup>W</sup></span> mod <span class="docEmphasis">p</span>, where <span class="docEmphasis">W</span> is a function of Alice's password. Alice calculates <span class="docEmphasis">W</span> from the password. The tricky part is how Alice and Bob each manage to compute the session key <span class="docEmphasis">K</span> (see <a class="docLink" href="ch12lev1sec5.html#ch12qa1q11">Homework Problem 11</a>).</p>
<p class="docText"></p><a name="ch12fig05"></a><p><center>
<h5 class="docFigureTitle">Protocol 12-5. The Secure Remote Password Protocol (SRP)</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="12fig05_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="173" src="12fig05.jpg" /></p>
<br />
<ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch12lev1sec2.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch12lev1sec4.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>