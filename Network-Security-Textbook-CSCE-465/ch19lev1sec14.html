<html><head><title>19.14. Encoding</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec13.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec15.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch19lev1sec14"></a>
<h3 id="title-IDAVRBZK" class="docSection1Title">19.14. Encoding</h3>
<p class="docText">The packet encodings in the SSL/TLS specifications are expressed in a pseudo-ASN.1 syntax that is very unpleasant to read and makes it difficult to imagine what the packets actually look like. Hopefully you will appreciate our translating them into pictures here. The problem with the ugly syntax in the spec is that not only does it give the reader a headache, but it resulted in weird formats, for instance redundant fields, and implementation bugs (e.g., see &sect;<a class="docLink" href="#ch19lev3sec4">19.14.2.4</a> <span class="docEmphasis">ClientKeyEx-change</span>).</p>
<p class="docText">Since SSL/TLS runs on top of TCP, SSL/TLS can send an arbitrary-length chunk. TCP will handle breaking it up into packets and reassembling it. SSL/TLS has two layers of chunking itself, which operate somewhat independently. The unit of cryptographic protection is the <span class="docEmphStrong">record</span>, which contains a header and a body, where the body is cryptographically protected if the protocol is far enough along. Records are limited to 2<sup>14</sup> octets by the specification, but there are buggy implementations that send records of up to 2<sup>16</sup>-1 octets so a conservative implementation should be prepared to accept records up to that size. The parts of the handshake are divided into <span class="docEmphStrong">messages</span>, which also contain a header and a body. In principle, a single message could be packaged in multiple records or multiple messages could be placed in a single record. In practice, most implementations combine the two layers and put one message in each record.</p>
<p class="docText">It would have been simpler (and more efficient) for each message to be its own record type, and to have only a single header on each handshake message. But instead the designers chose to have four record types, with most of the handshake messages being enclosed in records of type <span class="docEmphRomanAlt">handshake</span>. A handshake record can contain multiple messages in it, whereas the other records are really free-standing messages. If the server is going to send a <span class="docEmphasis">ServerHello</span>, a <i><a class="docLink" href="app02.html#gloss01_034">Certificate</a></i>, and a <span class="docEmphasis">ServerHelloDone</span> (all of which are handshake messages), these could be sent as three records, or lumped together into a single record, or two of them could be in one record and the third in another record.</p>
<p class="docText">The four record types are:</p>
<ul><li><p class="docList">20=<span class="docEmphRomanAlt">ChangeCipherSpec</span>. This is really part of the handshake, and it's rather strange to have it be its own record type. The reason they did this is that after the <span class="docEmphasis">ChangeCipherSpec</span> message <a name="iddle1120"></a><a name="iddle1429"></a><a name="iddle1689"></a>the data is encrypted and integrity-protected with the key just agreed upon. It would not be possible for only part of a record to be encrypted, so <span class="docEmphasis">ChangeCipherSpec</span> had to be the last thing in a record. They could have had this be a handshake message, mandating that it be the final message in the record. But instead they said that it would be its own record type.</p></li><li><p class="docList">21=<span class="docEmphRomanAlt">alert</span> (any sort of notification)</p></li><li><p class="docList">22=<span class="docEmphRomanAlt">handshake</span> (any of many messages which is part of the handshake)</p></li><li><p class="docList">23=<span class="docEmphRomanAlt">application_data</span> (encrypted and integrity-protected data sent after the handshake is complete)</p></li></ul>
<p class="docText">The record header, which is never encrypted, is:</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">record type</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr></table></p><br />
<p class="docText">Following the record header is the contents of that record, which might be encrypted and integrity-protected. In the case of the handshake record, the record contains handshake messages, each message starting with a 1-octet type and a 3-octet length. It's somewhat mysterious why they would choose a 3-octet length field for the messages and a 2-octet length field for the record, but in theory if there were a message that was bigger than 2<sup>14</sup> octets, it could be split into several records. So the 2-octet length of the record length field does not constrain messages to be smaller than 2<sup>16</sup> octets. All multi-octet integers are sent in big-endian order (also known as network byte order).</p>
<a name="ch19lev2sec8"></a>
<h4 id="title-IDARYBZK" class="docSection2Title">19.14.1. Encrypted Records</h4>
<p class="docText">Records sent after a <span class="docEmphasis">ChangeCipherSpec</span> record are cryptographically protected with the negotiated cipher suite. Integrity protection is provided using HMAC based on MD5 or SHA-1. Encryption uses any of a variety of encryption algorithms, all of which are block ciphers in CBC mode except RC4, which is a stream cipher.</p>
<p class="docText">HMAC takes two arguments, a key and data. The key used is the session integrity key for that direction. The data on which the HMAC is based consists of a 64-bit sequence number followed by the record header followed by the data. The sequence number is not actually transmitted. It only is used in the calculation of the HMAC. It protects against ordering and replay, but does not need to be explicitly transmitted because SSL runs over a reliable protocol (TCP). If TCP failed somehow and lost, reordered, or duplicated data, the two sides would disagree about the sequence number, the integrity check would fail, and this would result in a connection failure.</p>
<p class="docText">If a block cipher is to be used for encryption, the DATA | HMAC is padded to a multiple of the block size. Then DATA | HMAC | padding is encrypted. If a block cipher is used, the initial IV is computed along with the key and the final block of each record is used as the IV for the next.</p>
<a name="ch19fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 19-4. Cryptographically protected record format</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="204" src="19fig04.jpg" /></p>
<br />
<p class="docText">For TLS, HMAC is computed as specified in RFC 2104. For SSLv3, the MAC is computed in a similar fashion, but is different both because the HMAC design was still evolving and they got an early draft and because a typographical error resulted in 40 octets of padding in a spot where there should have been 44. Neither of these differences is likely to affect the security, but they do complicate the documentation.</p>
<p class="docText">To summarize, what is transmitted is the record header, followed by an encrypted blob which, when decrypted, consists of the data followed by the HMAC, followed by padding including the padding length.</p>
<a name="ch19lev2sec9"></a>
<h4 id="title-IDAC0BZK" class="docSection2Title">19.14.2. Handshake Messages</h4>
<p class="docText">A handshake record (type 22) contains handshake messages. The specification allows someone to break a handshake message into pieces, and send each piece in a separate handshake record. It is also permissible for the handshake record to contain multiple handshake messages. For instance, the server might send a <span class="docEmphasis">ServerHello</span>, a <i><a class="docLink" href="app02.html#gloss01_034">Certificate</a></i>, a <span class="docEmphasis">CertificateRequest</span>, and a <span class="docEmphasis">ServerHelloDone</span>, all within the same handshake record. The handshake messages are <span class="docEmphasis">ClientHello</span>, <span class="docEmphasis">ServerHello</span>, <span class="docEmphasis">ClientKeyExchange</span>, <i><a class="docLink" href="app02.html#gloss01_034">Certificate</a></i>, <span class="docEmphasis">ServerHelloDone</span>, <span class="docEmphasis">HandshakeFinished</span>, <span class="docEmphasis">CertificateRequest</span>, <span class="docEmphasis">CertificateVerify</span>, and <span class="docEmphasis">ServerKeyExchange</span>.</p>
<a name="ch19lev3sec1"></a>
<h5 id="title-IDAW1BZK" class="docSection3Title">19.14.2.1. ClientHello</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="right" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=1</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">32</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">random (<span class="docEmphasis">R</span><sub>Alice</sub>)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of session_id (or 0 if field absent)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">session_id</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of cipher suite list (in octets)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">sequence of cipher suites, each a 2-octet type</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of compression list (in octets)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">sequence of compression methods, each a single octet</span></p></td></tr></table></p><br />
<p class="docText">This message contains the optional session_id (to allow a session to be resumed; see &sect;<a class="docLink" href="ch19lev1sec5.html#ch19lev1sec5">19.5</a> <span class="docEmphasis">Session Resumption</span>), <span class="docEmphasis">R</span><sub>Alice</sub>, and Alice's list of cipher suites and compression methods.</p>
<a name="ch19lev3sec2"></a>
<h5 id="title-IDAO13YK" class="docSection3Title">19.14.2.2. ServerHello</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=2</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">32</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">random (<span class="docEmphasis">R</span><sub>Bob</sub>)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of session_id (or 0 if field absent)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">session_id</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">chosen cipher</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">chosen compression method</span></p></td></tr></table></p><br />
<p class="docText">This message contains <span class="docEmphasis">R</span><sub>Bob</sub>, an optional session_id (to allow the session to be resumable), and Bob's choice of cipher and compression method.</p>
<a name="ch19lev3sec3"></a>
<h5 id="title-IDAZZQYK" class="docSection3Title">19.14.2.3. ServerHelloDone</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=14</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length=0</span></p></td></tr></table></p><br />
<p class="docText">This indicates that the server is finished sending its handshake messages. It is the final piece of message 2 in <a class="docLink" href="ch19lev1sec4.html#ch19fig01">Protocol 19-1</a>. It just has a type octet (=14) and a length field (3 octets of 0).</p>
<a name="ch19lev3sec4"></a>
<h5 id="title-IDAY2QYK" class="docSection3Title">19.14.2.4. ClientKeyExchange</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1387"></a># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=16</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length (missing in SSLv3, present in TLS)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">encrypted pre-master secret</span></p></td></tr></table></p><br />
<p class="docText">This is the message in which Alice sends the pre-master secret encrypted with the server's public key. Note the extra length field. It serves no purpose with RSA or Diffie-Hellman. It was in the SSLv3 specification, but not in any implementations. TLS copied the SSLv3 spec, so left the extra length field in. As we said earlier, it is an artifact of the packet specification language they invented, and so difficult to read and visualize that it resulted not only in extra fields but implementation bugs.</p>
<p class="docText">Redundant length fields are a problem. At best it's extra work to set and look at them, and extra octets on the wire. And what are you supposed to do if they disagree? Also, note that the second length field is only 2 octets long and the first one is 3 octets long. If the length never needs to be larger than can be expressed in two octets, why is the other length field 3 octets?</p>
<p class="docText">Although the second length field is redundant in RSA and Diffie-Hellman, there are key exchange algorithms such as FORTEZZA that require multiple variable length fields to express the encrypted pre-master secret. Also, future algorithms might require more than 2<sup>16</sup> octets of information. The information following the 3-octet length field is algorithm dependent, so they could have left out the 2nd length field for RSA and Diffie-Hellman, but had the data for FORTEZZA consist of (length, value) pairs.</p>
<a name="ch19lev3sec5"></a>
<h5 id="title-IDACBGZK" class="docSection3Title">19.14.2.5. ServerKeyExchange</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=12</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of modulus</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">modulus</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of exponent</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">exponent</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of signature</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td></tr></table></p><br />
<p class="docText">This message is used in SSLv3 and TLS for export approval, in which the server signs a (short) ephemeral public key, signed with its long-term key. Instead of sending an X.509 certificate, it is just a signature on the new key. It is also used when the server's long-term public key can only be used for signing, for instance when the server's key is a DSS key.</p>
<a name="ch19lev3sec6"></a>
<h5 id="title-IDAFHGZK" class="docSection3Title">19.14.2.6. CertificateRequest</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=13</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of key type list</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">list of types of keys (each one octet long)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of CA name list</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of 1st CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">1st CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of 2nd CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">2nd CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of 3rd CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">3rd CA name</span></p></td></tr><tr><td class="rightBorder" align="center" valign="top">&nbsp;</td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">...</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of last CA name</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">last CA name</span></p></td></tr></table></p><br />
<p class="docText">This message is sent by the server to request that the client send a certificate and authenticate. See &sect;<a class="docLink" href="ch19lev1sec8.html#ch19lev1sec8">19.8</a> <span class="docEmphasis">PKI as Deployed by SSL</span>. There are several defined &quot;key types&quot;, which not only specify the kind of key, but the kind of authentication method the user will use to authenticate. The most commonly used is type 1=RSA signing.</p>
<a name="ch19lev3sec7"></a>
<h5 id="title-IDAARGZK" class="docSection3Title">19.14.2.7. Certificate</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=11</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length (unnecessary field)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of first certificate</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">first certificate</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">more (3-octet length, certificate) pairs, if more than one certificate is being sent</span></p></td></tr></table></p><br />
<p class="docText">This message contains one or more certificates. Note this also contains a redundant length field. The second length field will always be 3 less than the first length field (since the first length field includes the second length field in the number of octets it is counting).</p>
<a name="ch19lev3sec8"></a>
<h5 id="title-IDA5VGZK" class="docSection3Title">19.14.2.8. CertificateVerify</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=15</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length of signature</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">variable</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">signature</span></p></td></tr></table></p><br />
<p class="docText">This message is sent by the client to prove it knows its private key. The signature (in the case of RSA, which is really all that's deployed), is a modified PKCS #1 RSA-signed quantity consisting of both the MD5 of the handshake messages and the SHA of the handshake messages. The modification to PKCS #1 is that the ASN.1 encoded digest type is omitted and the MD5 and the SHA digests are concatenated.</p>
<a name="ch19lev3sec9"></a>
<h5 id="title-IDA1ZGZK" class="docSection3Title">19.14.2.9. HandshakeFinished</h5>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="80"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">type=20</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">3</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length=36 or 12</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">36 or 12</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">digest</span></p></td></tr></table></p><br />
<p class="docText">This message ensures integrity of the exchange as well as proving knowledge of the key. In SSLv3 the digest, strangely, is a 36-octet quantity consisting of a concatenation of a 16-octet keyed MD5 hash and 20-octet keyed SHA hash of information including the handshake messages. In TLS the digest is 12 octets computed with a complex combination of MD5 and SHA.</p>
<a name="ch19lev2sec10"></a>
<h4 id="title-IDAD3GZK" class="docSection2Title">19.14.3. ChangeCipherSpec</h4>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="center" span="2"><col width="50"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"># octets</p></td><td class="bottomBorder" align="center" valign="top">&nbsp;</td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">record type=20</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">version number</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">2</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">length (set to 1)</span></p></td></tr><tr><td class="rightBorder" align="right" valign="top"><p class="docText">1</p></td><td class="rightBorder bottomBorder" align="center" valign="top"><p class="docText"><span class="docEmphRomanAlt">ChangeCipherSpecType (set to 1)</span></p></td></tr></table></p><br />
<p class="docText">This isn't a handshake message, but is instead its own record type. It indicates that all records following this will be protected with the ciphers agreed upon as of this message. The final field (C<span class="docEmphSmaller">HANGE</span>C<span class="docEmphSmaller">IPHER</span>S<span class="docEmphSmaller">PEC</span>T<span class="docEmphSmaller">YPE</span>) is mysterious. Only one value (1) has been defined, which means <span class="docEmphasis">change to the cipher suite we've agreed to now</span>. It's unclear when you would want to say anything other than that. But, if someone thinks of a new thing to say, they can define a new value for that field.</p>
<a name="ch19lev2sec11"></a>
<h4 id="title-IDAUBHZK" class="docSection2Title">19.14.4. Alerts</h4>
<p class="docText">An alert is sent to advise the other side of some condition. Most alerts are error messages, with a severity level of either 1=warning, or 2=fatal. The one defined alert which is not an error indication is the <span class="docEmphasis">closure</span> alert, in which one side notifies the other that it has no more data to send. This was added in SSLv3 because of a security vulnerability in SSLv2 known as the truncation attack. SSLv2 assumed the other side was finished sending data if the TCP connection closed. However, because TCP commands are not cryptographically protected, there is no way to know whether the TCP connection closed because the other side closed the TCP connection when it finished sending all its data, or an attacker sent the TCP command to close the connection.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec13.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec15.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>