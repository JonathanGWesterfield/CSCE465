<html><head><title>4.2. Encrypting a Large Message</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="15051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch04lev1sec1.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch04lev1sec3.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch04lev1sec2"></a>
<h3 id="643999-990" class="docSection1Title">4.2. Encrypting a Large Message</h3>
<p class="docText">How do you encrypt a message larger than 64 bits? There are several schemes defined in [<a class="docLink" href="biblio01.html#biblio01_044">DES81</a>]. These schemes would be equally applicable to IDEA or any secret key scheme that encrypted fixed-length blocks, and no doubt one could come up with variant schemes as well. The ones defined in [<a class="docLink" href="biblio01.html#biblio01_044">DES81</a>], and which we'll describe in detail, are:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Electronic Code Book (ECB)</p></div></li><li><div style="font-weight:normal"><p class="docList">Cipher Block Chaining (CBC)</p></div></li><li><div style="font-weight:normal"><p class="docList"><span class="docEmphasis">k</span>-Bit Cipher Feedback Mode (CFB)</p></div></li><li><div style="font-weight:normal"><p class="docList"><span class="docEmphasis">k</span>-Bit Output Feedback Mode (OFB)</p><p class="docList">A newer scheme that might be important in the future is:</p></div></li><li><div style="font-weight:normal"><p class="docList">Counter Mode (CTR)</p></div></li></ol></div>
<a name="ch04lev2sec1"></a>
<h4 id="title-IDA4R5LD" class="docSection2Title">4.2.1. Electronic Code Book (ECB)</h4>
<p class="docText"><a name="iddle1312"></a><a name="iddle1319"></a>This mode consists of doing the obvious thing, and it is usually the worst method. You break the message into 64-bit blocks (padding the last one out to a full 64 bits), and encrypt each block with the secret key (see <a class="docLink" href="#ch04fig01">Figure 4-1</a>). The other side receives the encrypted blocks and decrypts each block in turn to get back the original message (see <a class="docLink" href="#ch04fig02">Figure 4-2</a>).</p>
<a name="ch04fig01"></a><p><center>
<h5 class="docFigureTitle">Figure 4-1. Electronic Code Book Encryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="166" src="04fig01.jpg" /></p>
<br />
<a name="ch04fig02"></a><p><center>
<h5 class="docFigureTitle">Figure 4-2. Electronic Code Book Decryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="166" src="04fig02.jpg" /></p>
<br />
<p class="docText">There are a number of problems with this approach that don't show up in the single-block case. First, if a message contains two identical 64-bit blocks, the corresponding two blocks of ciphertext will be identical. This will give an eavesdropper some information. Whether it is useful or not depends on the context. We'll give an example where <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_080">ECB</a></span> would have a problem. Suppose that the eavesdropper knows that the plaintext is an alphabetically sorted list of employees and salaries being sent from management to payroll, tabularly arranged (see <a class="docLink" href="#ch04fig03">Figure 4-3</a>).</p>
<a name="ch04fig03"></a><p><center>
<h5 class="docFigureTitle">Figure 4-3. Payroll Data</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="138" src="04fig03.jpg" /></p>
<br />
<p class="docText">Further suppose that, as luck would have it, each line is exactly 64 bytes long, and the blocks happen to be divided in the salary field between the 1,000's and the 10,000's digit. Since identical plaintext blocks produce identical ciphertext blocks, not only can an eavesdropper figure out which sets of employees have identical salaries, but also which sets of employees have salaries in the same <a name="iddle1147"></a><a name="iddle1184"></a>$10,000 ranges. If he can guess a few relative salaries, he will have a pretty good idea of what all the salaries are from this &quot;encrypted&quot; message.</p>
<p class="docText">Furthermore, if the eavesdropper is one of the employees, he can alter the message to change his own salary to match that of any other employee by copying the ciphertext blocks from that employee to the corresponding blocks of his own entry. Even a human looking at the resulting message would see nothing awry.</p>
<p class="docText">So, ECB has two serious flaws. Someone seeing the ciphertext can gain information from repeated blocks, and someone can rearrange blocks or modify blocks to his own advantage. As a result of these flaws, ECB is rarely used to encrypt messages.</p>
<a name="ch04lev2sec2"></a>
<h4 id="title-IDABX5LD" class="docSection2Title">4.2.2. Cipher Block Chaining (CBC)</h4>
<p class="docText"><span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_030">CBC</a></span> is a method of avoiding some of the problems in ECB. Using CBC, even if the same block repeats in the plaintext, it will not cause repeats in the ciphertext.</p>
<p class="docText">First we'll give an example of how this might be accomplished. Our example is not CBC, but it helps for understanding CBC.</p>
<p class="docText">Generate a 64-bit random number <span class="docEmphasis">r<sub>i</sub></span> for each plaintext block <span class="docEmphasis">m<sub>i</sub></span> to be encrypted. <img src="U2295.GIF" border="0" /> the plaintext block with the random number, encrypt the result, and transmit both the unencrypted random <a name="iddle1459"></a><a name="iddle1501"></a>number <span class="docEmphasis">r<sub>i</sub></span> and the ciphertext block <span class="docEmphasis">c<sub>i</sub></span> (see <a class="docLink" href="#ch04fig04">Figure 4-4</a>). To decrypt this, you'd decrypt all the <span class="docEmphasis">c<sub>i</sub></span>s, and for each <span class="docEmphasis">c<sub>i</sub></span>, after decrypting it, you'd <img src="U2295.GIF" border="0" /> it with the random number <span class="docEmphasis">r<sub>i</sub></span>.</p>
<a name="ch04fig04"></a><p><center>
<h5 class="docFigureTitle">Figure 4-4. Randomized Electronic Code Book Encryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="140" src="04fig04.jpg" /></p>
<br />
<p class="docText">The main problem with this scheme is efficiency. It causes twice as much information to be transmitted, since a random number has to be transmitted along with each block of ciphertext. Another problem with it is that an attacker can rearrange the blocks and have a predictable effect on the resulting plaintext. For instance, if <span class="docEmphasis">r</span><sub>2</sub>|<span class="docEmphasis">c</span><sub>2</sub> were removed entirely it would result in <span class="docEmphasis">m</span><sub>2</sub> being absent in the decrypted plaintext. Or if <span class="docEmphasis">r</span><sub>2</sub>|<span class="docEmphasis">c</span><sub>2</sub> were swapped with <span class="docEmphasis">r</span><sub>7</sub>|<span class="docEmphasis">c</span><sub>7</sub>, then <span class="docEmphasis">m</span><sub>2</sub> and <span class="docEmphasis">m</span><sub>7</sub> would be swapped in the result. Worse yet, an attacker knowing the value of any block <span class="docEmphasis">m<sub>n</sub></span> can change it in a predictable way by making the corresponding change in <span class="docEmphasis">r<sub>n</sub></span>.</p>
<p class="docText">Now we can explain CBC. CBC generates its own &quot;random numbers&quot;. It uses <span class="docEmphasis">c<sub>i</sub></span> as <span class="docEmphasis">r</span><sub><span class="docEmphasis">i</span>+1</sub>. In other words, it takes the previous block of ciphertext and uses that as the random number that will be <img src="U2295.GIF" border="0" />'d into the next plaintext. To avoid having two plaintext messages that start the same wind up with the same ciphertext in the beginning, CBC does select one random number, which gets <img src="U2295.GIF" border="0" />'d into the first block of plaintext, and transmits it along with the data. This initial random number is known as an <b><a class="docLink" href="app02.html#gloss01_113">IV</a></b> (<b><a class="docLink" href="app02.html#gloss01_113">initialization vector</a></b>).</p>
<a name="ch04fig05"></a><p><center>
<h5 class="docFigureTitle">Figure 4-5. Cipher Block Chaining Encryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="140" src="04fig05.jpg" /></p>
<br />
<p class="docText">Decryption is simple because <img src="U2295.GIF" border="0" /> is its own inverse.</p>
<a name="ch04fig06"></a><p><center>
<h5 class="docFigureTitle">Figure 4-6. Cipher Block Chaining Decryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="140" src="04fig06.jpg" /></p>
<br />
<p class="docText">Since the cost of the <img src="U2295.GIF" border="0" /> is trivial compared to the cost of an encryption, CBC encryption has the same performance as ECB encryption except for the cost of generating and transmitting the IV.</p>
<p class="docText">In many cases the security of CBC would not be adversely affected by omitting the IV (or, equivalently, using the value 0 as the IV). However, we'll give one example where it would matter. Suppose the encrypted file of employees and salaries is transmitted weekly. If there were no IV, then an eavesdropper could tell where the ciphertext first differed from the previous week, and therefore perhaps determine the first person whose salary had changed.</p>
<p class="docText">Another example is where a general sends information each day saying <span class="docEmphRomanAlt">continue holding your position</span>. The ciphertext will be the same every day, until the general decides to send something else, like <span class="docEmphRomanAlt">start bombing</span>. Then the ciphertext would suddenly change, alerting the enemy.</p>
<p class="docText">A randomly chosen IV guarantees that even if the same message is sent repeatedly, the ciphertext will be completely different each time.</p>
<p class="docText">Finally, a randomly chosen IV prevents attackers from supplying chosen plaintext to the underlying encryption algorithm even if they can supply chosen plaintext to the CBC.</p>
<a name="ch04lev3sec1"></a>
<h5 id="title-IDAW45LD" class="docSection3Title">4.2.2.1. CBC Threat 1ÂModifying Ciphertext Blocks</h5>
<p class="docText">Using CBC does not eliminate the problem of someone modifying the message in transit; it does change the nature of the threat. Attackers can no longer see repeated values and simply copy or move ciphertext blocks in order to, say, swap the janitor's salary with the salary of the VP of marketing. But they certainly can still modify the ciphertext. What would happen if they changed a block of the ciphertext, say the value of ciphertext block <span class="docEmphasis">c<sub>n</sub></span>? <span class="docEmphasis">c<sub>n</sub></span> gets <img src="U2295.GIF" border="0" />'d with the decrypted <span class="docEmphasis">c</span><sub><span class="docEmphasis">n</span>+1</sub> to yield <span class="docEmphasis">m</span><sub><span class="docEmphasis">n</span>+1</sub>, so changing <span class="docEmphasis">c<sub>n</sub></span> has a predictable effect on <span class="docEmphasis">m</span><sub><span class="docEmphasis">n</span>+1</sub>. For instance, changing bit 3 of <span class="docEmphasis">c<sub>n</sub></span>changes bit 3 of <span class="docEmphasis">m</span><sub><span class="docEmphasis">n</span>+1</sub>. <span class="docEmphasis">c<sub>n</sub></span> also gets decrypted, and then <img src="U2295.GIF" border="0" />'d with <span class="docEmphasis">c</span><sub><span class="docEmphasis">n</span>-1</sub> to produce <span class="docEmphasis">m<sub>n</sub></span>. Our attacker cannot know what a particular new value of <span class="docEmphasis">c<sub>n</sub></span> would decrypt to, so changing <span class="docEmphasis">c<sub>n</sub></span> will most likely garble <span class="docEmphasis">m<sub>n</sub></span> to some random 64-bit value.</p>
<p class="docText">For example, let's say our attacker knows that the plaintext corresponding to a certain byte range in the ciphertext is her personnel record:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre>Tacker, Jo A        System Security Officer      54,122.10
|       |      |      |       |       |     |     |       |</pre></div><br />
<p class="docText">Let's say Jo wants to increase her salary by 20K. In this case she knows that the final <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_024">byte</a></span> of <span class="docEmphasis">m</span><sub>7</sub> is the ten-thousands digit of her salary. The bottom three bits of the <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_007">ASCII</a></span> for <span class="docEmphRomanAlt">5</span> is 101. To give herself a raise of 20K, she merely has to flip the penultimate bit of <span class="docEmphasis">c</span><sub>6</sub>. Since <span class="docEmphasis">c</span><sub>6</sub> gets <img src="U2295.GIF" border="0" />'d into the decrypted <span class="docEmphasis">c</span><sub>7</sub> (<span class="docEmphasis">c</span><sub>7</sub> has not been modified, so the decrypted <span class="docEmphasis">c</span><sub>7</sub> will be the same), the result will be the same as before, i.e. the old <span class="docEmphasis">m</span><sub>7</sub>, but with the penultimate bit flipped, which will change the ASCII <span class="docEmphRomanAlt">5</span> into a <span class="docEmphRomanAlt">7</span>.</p>
<p class="docText">Unfortunately for Jo, as a side-effect a value she will not be able to predict will appear in her department field, since she cannot predict what the modified <span class="docEmphasis">c</span><sub>6</sub> will decrypt to, which will affect <span class="docEmphasis">m</span><sub>6</sub>:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre>Tacker, Jo A        System Security Of#f8Ts9(*      74,122.10
|       |      |      |       |       |       |      |       |</pre></div><br />
<p class="docText"><a name="iddle1039"></a><a name="iddle1126"></a>A human who reads this report and issues checks is likely to suspect something is wrong; however, if it's just a program, it would be perfectly happy with it. And a bank would most likely take the check even if some unorthodox information appeared in what to them is a comment field.</p>
<p class="docText">In the above example, Jo made a change she could control in one block at the expense of getting a value she could neither control nor predict in the preceding block.</p>
<a name="ch04lev3sec2"></a>
<h5 id="title-IDAKEAMD" class="docSection3Title">4.2.2.2. CBC Threat 2ÂRearranging Ciphertext Blocks</h5>
<p class="docText">Suppose Jo knows the plaintext and corresponding ciphertext of some message. So she knows <span class="docEmphasis">m</span><sub>1</sub>, <span class="docEmphasis">m</span><sub>2</sub>,...<span class="docEmphasis">m<sub>n</sub></span>. And she knows IV, <span class="docEmphasis">c</span><sub>1</sub>, <span class="docEmphasis">c</span><sub>2</sub>,...<span class="docEmphasis">c<sub>n</sub></span>. She will also know what each of the <span class="docEmphasis">c<sub>i</sub></span> decrypt to, since the decrypted version of <span class="docEmphasis">c<sub>i</sub></span> is <span class="docEmphasis">c</span><sub><span class="docEmphasis">i</span>-1</sub> <img src="U2295.GIF" border="0" /> <span class="docEmphasis">m<sub>i</sub></span> (see <a class="docLink" href="#ch04fig07">Figure 4-7</a>).</p>
<a name="ch04fig07"></a><p><center>
<h5 class="docFigureTitle">Figure 4-7. Cipher Block Chaining Decryption</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="141" src="04fig07.jpg" /></p>
<br />
<p class="docText">Given this knowledge, she can consider each of the <span class="docEmphasis">c<sub>i</sub></span> as a <span class="docEmphasis">building block</span> and construct a ciphertext stream using any combination of <span class="docEmphasis">c<sub>i</sub></span> and she will be able to calculate what the corresponding plaintext would be.</p>
<p class="docText">How could this be useful? Well, admittedly it's stretching a bit, though people in the security field enjoy stretching. One of the ways to combat threat 1 is to attach a CRC to the plaintext before encrypting it with CBC. That way if Jo modifies any of the ciphertext blocks, the CRC will not match the message and a computer can verify that the message has been tampered with.</p>
<p class="docText">Still following? Well, suppose a 32-bit CRC is chosen. Then there is a 1 in 2<sup>32</sup> chance that the CRC will happen to be correct after the message is tampered with. Suppose Jo doesn't care what she garbles the message to. She just wants the garbage accepted by the computer on the other side, knowing that it will check the CRC. Jo can try constructing lots of ciphertext streams out of <span class="docEmphasis">c</span><sub>1</sub>, <span class="docEmphasis">c</span><sub>2</sub>,...<span class="docEmphasis">c<sub>n</sub></span>, calculate the resulting plaintext from each one, and then test the resulting plaintext to see if the CRC comes out correct. On the average she will only have to try 2<sup>31</sup> arrangements before being able to find a message that will have a correct CRC.</p>
<p class="docText"><a name="iddle1724"></a><a name="iddle1736"></a><a name="iddle1755"></a><a name="iddle2038"></a>What harm could Jo do by garbling a message into something she could not control the contents of, but would be accepted by the computer on the other side? Perhaps Jo is just being malicious, and wants to destroy some data being loaded across the network. But there is a subtle way in which Jo can actually control the garbling of the message to a small extent. Suppose she moves contiguous blocks; for instance, she might move <span class="docEmphasis">c<sub>n</sub></span> and <span class="docEmphasis">c<sub>n</sub></span><sub>+1</sub> to some other place. Then the original <span class="docEmphasis">m<sub>n</sub></span><sub>+1</sub> will appear in that other position. Perhaps if <span class="docEmphasis">m<sub>n</sub></span><sub>+1</sub> contains the president's salary, Jo can swap blocks so that her salary will be changed to his, but then she'll be forced to pretty much totally garble the entire rest of the file in order to find an arrangement of blocks that will result in a correct CRC.</p>
<p class="docText">To prevent Jo from being able to rearrange blocks to find something that will have a correct CRC, a 64-bit CRC could be used. This would certainly suffice if the only attack on the CRC inside CBC encoding was a brute force attack such as we described. There have been some interesting attacks suggested in the theoretical community [<a class="docLink" href="biblio01.html#biblio01_086">JUEN84</a>] though these attacks are not practical. An encryption mode that protects both the confidentiality and the authenticity of a message using a single cryptographic pass over the data has been the holy grail of cryptographic protocol design for many years, with many proposals subsequently discredited. There are some new ones that look promising (for example, see &sect;<a class="docLink" href="ch04lev1sec3.html#ch04lev2sec10">4.3.5</a> <span class="docEmphasis">Offset Codebook Mode (OCB)</span>), but none has been formally standardized.</p>
<a name="ch04lev2sec3"></a>
<h4 id="title-IDAHKAMD" class="docSection2Title">4.2.3. Output Feedback Mode (OFB)</h4>
<p class="docText">Output feedback mode is a stream cipher. Encryption is performed by <img src="U2295.GIF" border="0" />ing the message with the one-time pad generated by OFB.</p>
<p class="docText">Let's assume that the stream is created 64 bits at a time. To start, a random 64-bit number is generated, known as the IV (as in CBC mode). Let's call that <span class="docEmphasis">b</span><sub>0</sub>. Then <span class="docEmphasis">b</span><sub>0</sub> is encrypted (using the secret key) to get <span class="docEmphasis">b</span><sub>1</sub>, which is in turn encrypted to get <span class="docEmphasis">b</span><sub>2</sub>, and so forth. The resulting one-time pad is <span class="docEmphasis">b</span><sub>0</sub>|<span class="docEmphasis">b</span><sub>1</sub>|<span class="docEmphasis">b</span><sub>2</sub>|<span class="docEmphasis">b</span><sub>3</sub>|....</p>
<p class="docText">To encrypt a message, merely <img src="U2295.GIF" border="0" /> it with as many bits of <span class="docEmphasis">b</span><sub>0</sub>|<span class="docEmphasis">b</span><sub>1</sub>|<span class="docEmphasis">b</span><sub>2</sub>|<span class="docEmphasis">b</span><sub>3</sub>|... as necessary. The result is transmitted along with the IV. The recipient computes the same one-time pad based on knowledge of the secret key and the IV. To decrypt the message, the recipient merely <img src="U2295.GIF" border="0" />s it with as many bits of <span class="docEmphasis">b</span><sub>0</sub>|<span class="docEmphasis">b</span><sub>1</sub>|<span class="docEmphasis">b</span><sub>2</sub>|<span class="docEmphasis">b</span><sub>3</sub>|... as necessary.</p>
<p class="docText">The advantages of a system like this are:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">The one-time pad can be generated in advance, before the message to be encrypted is known. When the message arrives to be encrypted, no costly cryptographic operations are needed. Instead only <img src="U2295.GIF" border="0" /> is required, and <img src="U2295.GIF" border="0" /> is extremely fast.</p></div></li><li><div style="font-weight:normal"><p class="docList"><a name="iddle1166"></a><a name="iddle1185"></a>If some of the bits of the ciphertext get garbled, only those bits of plaintext get garbled, as opposed to in CBC mode where if <span class="docEmphasis">c<sub>n</sub></span> is garbled then <span class="docEmphasis">m<sub>n</sub></span> will be completely garbled and the same portion of <span class="docEmphasis">m<sub>n</sub></span><sub>+1</sub> as was garbled in <span class="docEmphasis">c<sub>n</sub></span> will be garbled.</p></div></li><li><div style="font-weight:normal"><p class="docList">A message can arrive in arbitrarily sized chunks, and each time a chunk appears, the associated ciphertext can be immediately transmitted. In contrast, with CBC, if the message is arriving a byte at a time, it cannot be encrypted until an entire 64-bit block of plaintext is available for encryption. This results in either waiting until 7 more bytes arrive, or padding the plaintext to a multiple of 8 bytes before encrypting it, which yields more ciphertext to be transmitted and decrypted.</p></div></li></ol></div>
<p class="docText">The disadvantages of <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_144">OFB</a></span> are:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">If the plaintext and ciphertext are known by a bad guy, he can modify the plaintext into anything he wants by simply <img src="U2295.GIF" border="0" />ing the ciphertext with the known plaintext, and <img src="U2295.GIF" border="0" />ing the result with whatever message he wants to transmit.</p></div></li></ol></div>
<p class="docText">The <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_092">FIPS</a></span> document specifies OFB as being capable of being generated in <span class="docEmphasis">k</span>-bit chunks. The description above would be equivalent to 64-bit OFB as documented in [<a class="docLink" href="biblio01.html#biblio01_044">DES81</a>]. The way <span class="docEmphasis">k</span>-bit OFB (see <a class="docLink" href="#ch04fig10">Figure 4-10</a>) works is as follows. The input to the DES encrypt function is initialized to some IV. If the IV is less than 64 bits long, it is padded with 0's on the left (most significant portion). The output will be a 64-bit quantity. Only <span class="docEmphasis">k</span> bits are used, which happen to be specified in [<a class="docLink" href="biblio01.html#biblio01_044">DES81</a>] as the most significant <span class="docEmphasis">k</span> bits. Cryptographically, any <span class="docEmphasis">k</span> bits would do, though it is nice to standardize which bits will be selected so that implementations will interoperate. So, we've generated the first <span class="docEmphasis">k</span> bits of the one-time pad. Now the same <span class="docEmphasis">k</span> bits are shifted into the rightmost portion of the input, and what was in that register is shifted <span class="docEmphasis">k</span> bits to the left. Now <span class="docEmphasis">k</span> more bits of one-time pad are selected, as before.</p>
<a name="ch04lev2sec4"></a>
<h4 id="title-IDAMQAMD" class="docSection2Title">4.2.4. Cipher Feedback Mode (CFB)</h4>
<p class="docText"><span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_037">CFB</a></span> (see <a class="docLink" href="#ch04fig09">Figure 4-9</a>) is very similar to OFB, in that <span class="docEmphasis">k</span> bits at a time are generated and <img src="U2295.GIF" border="0" />'d with <span class="docEmphasis">k</span> bits of plaintext. In OFB the <span class="docEmphasis">k</span> bits that are shifted into the register used as the input to the DES encrypt are the output bits of the DES encrypt from the previous block. In contrast, in CFB, the <span class="docEmphasis">k</span> bits shifted in are the <span class="docEmphasis">k</span> bits of ciphertext from the previous block. So in CFB the one-time pad cannot be generated before the message is known (as it can be in OFB).</p>
<p class="docText">It is sensible to have <span class="docEmphasis">k</span>-bit CFB with <span class="docEmphasis">k</span> something other than 64, and in particular <span class="docEmphasis">k</span> = 8 makes sense. With OFB or CBC, if characters are lost in transmission, or extra characters are added to the ciphertext stream, the entire rest of the transmission is garbled. With 8-bit CFB, as long as the error is an integral number of bytes, things will resynchronize. If a byte is lost in transmission, one byte of plaintext will be lost and the next 8 bytes will be garbled. However, after that, the plaintext will <a name="iddle1040"></a><a name="iddle1127"></a>decrypt properly. If a byte is added to the ciphertext stream, then a byte of garbage will be added to the plaintext stream, and the following 8 bytes of plaintext will be garbled, but after that it will decrypt properly. It does have the disadvantage that every byte of input requires a DES operation.</p>
<a name="ch04fig08"></a><p><center>
<h5 class="docFigureTitle">Figure 4-8. <span class="docEmphasis">k</span>-bit OFB</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="240" src="04fig08.jpg" /></p>
<br />
<a name="ch04fig09"></a><p><center>
<h5 class="docFigureTitle">Figure 4-9. <span class="docEmphasis">k</span>-bit CFB</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="500" height="240" src="04fig09.jpg" /></p>
<br />
<p class="docText">CFB-encrypted messages are somewhat less subject to tampering than either CBC or OFB. With 8-bit CFB it is possible for an attacker to change any individual byte of plaintext in a predictable way at the cost of unpredictably garbling the next 8 bytes. With 64-bit CFB it is possible for an attacker to modify any 64-bit block in a predictable way at the cost of unpredictably garbling the next 64-bit block. There is no block-rearranging attack as with CBC, though whole sections of the message can be rearranged at the cost of garbling the splice points.</p>
<p class="docText"><a name="iddle1210"></a><a name="iddle1233"></a><a name="iddle1737"></a>In principle, CFB need not be used on a byte boundary. It could iterate for any integer number of bits up to a full block. In practice, it's only used on byte boundaries or as a full block. When done in full-block mode, it has performance comparable to ECB, CBC, and OFB; it has the OFB advantage of being able to encrypt and send each byte as it is known; it lacks OFB's ability to compute a substantial amount of pad ahead; and it detects alterations better than OFB but not as well as CBC.</p>
<a name="ch04lev2sec5"></a>
<h4 id="title-IDATUAMD" class="docSection2Title">4.2.5. Counter Mode (CTR)</h4>
<p class="docText">Counter mode is similar to Output Feedback Mode in that a one-time pad is generated and <img src="U2295.GIF" border="0" />'d with the data. It is different in that instead of chaining by encrypting each one-time pad block to get the next one, OFB increments the IV and encrypts the result to get successive blocks of the one-time pad.</p>
<a name="ch04fig10"></a><p><center>
<h5 class="docFigureTitle">Figure 4-10. Counter Mode (CTR)</h5>
</center></p><p class="docText">
<img border="0" alt="" id="118095013052" width="250" height="170" src="04fig10.jpg" /></p>
<br />
<p class="docText">The main advantage of counter mode is that, like OFB, the cryptography can be pre-computed and encryption is simply an <img src="U2295.GIF" border="0" />, but like CBC, you can decrypt the message starting at any point rather than being forced to start at the beginning. This makes counter mode ideal for applications like encrypting a randomly accessed file. The subset of the data you will need and the order in which you will need it is unpredictable. Like OFB, CTR loses security if different data is encrypted with the same key and IV. An attacker could get the <img src="U2295.GIF" border="0" /> of two plaintext blocks by taking the <img src="U2295.GIF" border="0" /> of the two corresponding ciphertext blocks.</p>
<ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="15051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch04lev1sec1.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch04lev1sec3.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>