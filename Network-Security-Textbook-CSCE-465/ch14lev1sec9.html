<html><head><title>14.9. Hierarchy of Realms</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec8.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec10.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch14lev1sec9"></a>
<h3 id="title-IDAW4JYH" class="docSection1Title">14.9. Hierarchy of Realms</h3>
<p class="docText">In Kerberos V4, in order for principals in realm <span class="docEmphasis">A</span> to be authenticated by principals in realm <span class="docEmphasis">B</span> it was necessary for <span class="docEmphasis">B</span>'s KDC to be registered as a principal in <span class="docEmphasis">A</span>'s KDC. For full connectivity, this means that if there are <span class="docEmphasis">n</span> realms, the KDC in each realm has to be registered as a principal in each of the other <span class="docEmphasis">n</span>-1 realms. This is increasingly nightmarish as <span class="docEmphasis">n</span> gets large (see &sect;<a class="docLink" href="ch09lev1sec7.html#ch09lev3sec1">9.7.4.1</a> <span class="docEmphasis">Multiple KDC Domains</span>).</p>
<p class="docText">In Kerberos V5, it is allowable to go through a series of realms in order to authenticate. For instance, a principal in realm <span class="docEmphasis">A</span> might wish to be authenticated by a principal in realm <span class="docEmphasis">C</span>. However, realm <span class="docEmphasis">C</span> might not be registered in <span class="docEmphasis">A</span>. But perhaps realm <span class="docEmphasis">B</span> is registered in <span class="docEmphasis">A</span>, and realm <span class="docEmphasis">C</span> is registered <a name="iddle2089"></a>in <span class="docEmphasis">B</span>. A principal in <span class="docEmphasis">A</span> can get a ticket for something in <span class="docEmphasis">C</span> by first getting a ticket for <span class="docEmphasis">B</span>, and then asking <span class="docEmphasis">B</span> for a ticket to the KDC in <span class="docEmphasis">C</span>.</p>
<p class="docText">By allowing realm <span class="docEmphasis">B</span> to act as <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_107">intermediary</a></span> between realm <span class="docEmphasis">C</span> and other realms, we give the KDC at <span class="docEmphasis">B</span> the power to impersonate anyone in the world. Kerberos fixes this vulnerability somewhat by including in tickets a <span class="docEmphSmaller">TRANSITED</span> field which lists the names of all the realms that have been transited to obtain the ticket.</p>
<p class="docText">Why is the <span class="docEmphSmaller">TRANSITED</span> field useful? Suppose <span class="docEmphRomanAlt">Woodward@Washington-Post.Com</span> is contacted with a ticket that indicates the ticket was issued to the principal named <span class="docEmphRomanAlt">Deep-Throat@WhiteHouse.gov</span>, with the <span class="docEmphSmaller">TRANSITED</span> field indicating <span class="docEmphRomanAlt">KGB.Russia</span>. It is possible that Woodward should not assume the party using the ticket is really Mr. or Ms. Throat, since it would be in the interest of and the ability of the owner of the KGB realm's KDC to create a ticket that claims the source is anything. The KGB KDC can give such a ticket, along with the corresponding session key, to a confederate. Or the KDC can use the ticket and session key to impersonate the named source directly.</p>
<p class="docText">The only thing the KGB KDC cannot do is avoid being named inside the ticket, since a KDC will reject a ticket if the final entry in the <span class="docEmphSmaller">TRANSITED</span> field doesn't match the key with which the ticket is encrypted. If Alice gives Bob a ticket, Bob knows which KDC issued the ticket (it's the one with which he shares the key used to encrypt the ticket). But for all the other information in the ticket (like Alice's name and the other realms mentioned in the <span class="docEmphSmaller">TRANSITED</span> field), Bob has to trust the KDC which issued the ticket. And although the KDC which issued the ticket to Bob might be trustworthy, if there's any KDC in the path that isn't, all the earlier realms mentioned in the <span class="docEmphSmaller">TRANSITED</span> field and the original principal's name (<span class="docEmphRomanAlt">Alice</span>) are suspect.</p>
<p class="docText">The <span class="docEmphSmaller">TRANSITED</span> field in the ticket gives enough information for Bob (the service being accessed with the ticket) to know whether there are any realms on the path that Bob considers untrustworthy. A realm might be considered completely untrustworthy as a transit realm, but trustworthy when it claims to be acting on behalf of principals in its own realm. Each principal will have its own policy for which realms to trust.</p>
<p class="docText">You could say that by doing this, Kerberos is permitting maximum flexibility in possible policies. Or you could say that Kerberos is abdicating responsibility for this crucial decision by throwing it to the whim of application developers who will almost certainly get it wrong.</p>
<a name="f350fig01"></a>
<p class="docText">
<img border="0" alt="" width="130" height="86" src="350fig01.jpg" /></p>
<p class="docText">Either way, some sort of policy is necessary. One such policyÂand a likely one at thatÂis to arrange realms into a tree such that each realm shares a key with each of its children and with its parent. The set of realms trusted for any authentication is the shortest path through the tree, i.e., the <a name="iddle1225"></a><a name="iddle1992"></a>path that gets no closer to the root than the common ancestor lowest in the tree.</p>
<p class="docText">For example, in the above diagram, realm <span class="docEmphRomanAlt">G</span> shares a key with its parent realm (<span class="docEmphRomanAlt">C</span>) and each of its children (<span class="docEmphRomanAlt">H</span> and <span class="docEmphRomanAlt">I</span>). To get from realm <span class="docEmphRomanAlt">I</span> to realm <span class="docEmphRomanAlt">H</span>, you'd go through <span class="docEmphRomanAlt">G</span>. To get from realm <span class="docEmphRomanAlt">F</span> to realm <span class="docEmphRomanAlt">D</span>, you'd go through the lowest common ancestor (<span class="docEmphRomanAlt">B</span>), and to get there you'd have to go through <span class="docEmphRomanAlt">E</span>, so the path would be <span class="docEmphRomanAlt">FÂEÂBÂD</span>.</p>
<p class="docText">It's especially convenient if the path of realms can be identified solely on the basis of the syntax of names. If realm names were just unstructured strings, it would be difficult to find a path. Luckily realm names in all current implementations of Kerberos are hierarchical, since they follow either Internet or X.500 naming. For instance, assume <span class="docEmphRomanAlt">Cat@Hat.Com</span> wishes to access <span class="docEmphRomanAlt">Dennis@Menace.Com</span>. <span class="docEmphRomanAlt">Cat@Hat.Com</span> resides in realm <span class="docEmphRomanAlt">Hat.Com</span>. <span class="docEmphRomanAlt">Dennis@Menace.Com</span> resides in <span class="docEmphRomanAlt">Menace.Com</span>. The next level of hierarchy is simply called <span class="docEmphRomanAlt">Com</span>. If we create a realm named <span class="docEmphRomanAlt">Com</span> that shares a key with all realms with names of the form <span class="docEmphasis">x</span><span class="docEmphRomanAlt">.Com</span>, it can then serve as an authentication intermediary. In general, to get from one realm to another, one travels upward to a common ancestor, and then downward to the destination realm.</p>
<a name="f351fig01"></a>
<p class="docText">
<img border="0" alt="" width="200" height="51" src="351fig01.jpg" /></p>
<p class="docText">It is likely that some administrative entity exists which would be a likely CA operator for the <span class="docEmphRomanAlt">Com</span> realm, because some such entity must ensure that there are no name collisions in the <span class="docEmphRomanAlt">.Com</span> space.</p>
<p class="docText">Sometimes it might be desirable to shortcut the hierarchy. This might be for efficiency reasons (so authentication between two realms distant in the naming hierarchy does not need to be done via a long sequence of KDCs), or for trust reasons (there might be KDCs along the naming hierarchy path that the two realms would prefer not to have to trust).</p>
<a name="f351fig02"></a>
<p class="docText">
<img border="0" alt="" width="400" height="124" src="351fig02.jpg" /></p>
<p class="docText">It is possible to have links between KDCs that wouldn't ordinarily be linked based on the naming hierarchy. Such links are usually called <span class="docEmphStrong">cross-links</span>. A safe rule with cross-links is that when traversing the naming hierarchy to get to the target, cross-links should always be used if they make the path shorter, because it means fewer KDCs need to be trusted.</p>
<p class="docText">There are two issues with realm paths. One is how the initiator finds a realm path to the target. As we've shown, if names are hierarchical and the path of realms follows the same hierarchy, <a name="iddle1060"></a><a name="iddle1727"></a>with the possible addition of cross-links, it is easy to find a path. The other issue is how the target decides whether the realm path used was acceptable. As we said, Kerberos leaves it up to the application.</p>
<p class="docText">The <span class="docEmphSmaller">TRANSITED</span> field lists the sequence of transited realms, omitting the source and destination realms. Realm names are listed separated by commas. Since the list of realms might get large, Kerberos permits various abbreviations. If the realm list is empty, no realms were transited. But if the realm list consists of a single comma, it means that the hierarchy of realms was transited in the normal way (parent to parent from the source up to the first common ancestor, then child to child down to the destination). Two consecutive commas in a list (or a leading or trailing comma) indicate that the hierarchy was transited in the normal way between the two realms surrounding the comma pair (or between source realm and first-listed realm, or between last-listed realm and destination realm). There are other abbreviation rules as well.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec8.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec10.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>