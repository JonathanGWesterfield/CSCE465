<html><head><title>14.15. Kerberos V5 Messages</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec14.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec16.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch14lev1sec15"></a>
<h3 id="title-IDAVYRBS" class="docSection1Title">14.15. Kerberos V5 Messages</h3>
<p class="docText">Given that the Kerberos V5 messages are defined in ASN.1 notation, it isn't useful to show exact message formats. We will instead just list the information in each of the messages.</p>
<a name="ch14lev2sec5"></a>
<h4 id="title-IDAAZRBS" class="docSection2Title">14.15.1. Authenticator</h4>
<p class="docText">The authenticator is not a free-standing message, but rather is contained in a <span class="docEmphRomanAlt">TGS_REQ</span> or an <span class="docEmphRomanAlt">AP_REQ</span>. The entire thing is encrypted, using the key in the ticket that always accompanies an authenticator. Assume the authenticator is being sent in a message transmitted by Alice. When decrypted, the authenticator contains the following fields:</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="175"></col><col width="375"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTHENTICATOR-VNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CNAME, CREALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CKSUM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) checksum of application data that might have been sent along with the <span class="docEmphRomanAlt">AP_REQ</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CTIME, CUSEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">time at Alice (in seconds, microseconds)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">SUBKEY</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) key Alice would like to use instead of the key in the ticket, for the conversation with Bob</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">SEQ-NUMBER</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">initial sequence number that Alice will use in her <span class="docEmphRomanAlt">KRB_SAFE</span> and <span class="docEmphRomanAlt">KRB_PROT</span> messages to Bob</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTHORIZATION-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">application-specific data limiting Alice's rights</p></td></tr></table></p><br />
<a name="ch14lev2sec6"></a>
<h4 id="title-IDAF4RBS" class="docSection2Title">14.15.2. Ticket</h4>
<p class="docText"><a name="iddle2075"></a>A ticket is not a free-standing message, but is rather carried in messages such as <span class="docEmphRomanAlt">TGS_REQ</span>, <span class="docEmphRomanAlt">AS_REP</span>, <span class="docEmphRomanAlt">TGS_REP</span>, <span class="docEmphRomanAlt">AP_REQ</span>, and <span class="docEmphRomanAlt">KRB_CRED</span>. A ticket given to Alice for use with Bob looks like this:</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="175"></col><col width="375"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">1</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TKT-VNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">REALM, SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="top" colspan="2"><p class="docText">The remainder of the fields are encrypted with Bob's master key (unless this ticket was obtained using Bob's TGT as in &sect;<a class="docLink" href="ch14lev1sec12.html#ch14lev1sec12">14.12</a> <span class="docEmphasis">Double TGT Authentication</span>):</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">FLAGS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">FORWARDABLE</span>, <span class="docEmphSmaller">FORWARDED</span>, <span class="docEmphSmaller">PROXIABLE</span>, <span class="docEmphSmaller">PROXY</span>, <span class="docEmphSmaller">MAY-POST-DATE</span>, <span class="docEmphSmaller">POSTDATED</span>, <span class="docEmphSmaller">INVALID</span>, <span class="docEmphSmaller">RENEWABLE</span>, <span class="docEmphSmaller">INITIAL</span> (ticket was issued using <span class="docEmphRomanAlt">AS_REQ</span> rather than <span class="docEmphRomanAlt">TGS_REQ</span>)</p>
<p class="docText"><span class="docEmphSmaller">PRE-AUTHENT</span> (user authenticated himself to the KDC before the ticket was issued)</p>
<p class="docText"><span class="docEmphSmaller">HW-AUTHENT</span> (user was authenticated before ticket issued, using something like a smart card)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">KEY</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">key to be used when communicating with Alice</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CNAME, CREALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">TRANSITED</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">names of realms transited between Alice's realm and Bob's realm</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTH-TIME</span>, <span class="docEmphSmaller">START-TIME</span>, <span class="docEmphSmaller">END-TIME</span>, <span class="docEmphSmaller">RENEW-TILL</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">timestamps. <span class="docEmphSmaller">START-TIME</span> and <span class="docEmphSmaller">RENEW-TILL</span> are optional. Described in &sect;<a class="docLink" href="ch14lev1sec4.html#ch14lev1sec4">14.4</a> <span class="docEmphasis">Ticket Lifetimes</span>.</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CADDR</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the set of addresses from which this ticket will be valid</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTHORIZATION-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">application-specific data limiting Alice's rights</p></td></tr></table></p><br />
<a name="ch14lev2sec7"></a>
<h4 id="title-IDAQA0FS" class="docSection2Title">14.15.3. AS_REQ</h4>
<p class="docText">An <span class="docEmphRomanAlt">AS_REQ</span> is used to request a TGT. It can also be used to ask for regular tickets, but tickets requested with an <span class="docEmphRomanAlt">AS_REQ</span> (as opposed to a <span class="docEmphRomanAlt">TGS_REQ</span>) will return credentials encrypted with the requester's master key. The <span class="docEmphRomanAlt">TGS_REQ</span> contains a TGT, and the credentials returned in response to a <span class="docEmphRomanAlt">TGS_REQ</span> are encrypted according to the session key in the TGT. Let's assume that the request is on behalf of Alice in Wonderland. Let's assume she's asking for either a TGT or a ticket to Bob.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">10</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">PADATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) preauthentication dataÂtimestamp encrypted with Alice's master key</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">KDC-OPTIONS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">flagsÂeach flag indicates a request to set the corresponding flag in the ticket the KDC will return (see below)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name (the &quot;c&quot; comes from &quot;client&quot;)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's name (or the name <span class="docEmphRomanAlt">krbtgt</span> if the request is for a TGT)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">REALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">realm in which both Alice and Bob reside</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">FROM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(postdated ticket) desired start-time</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TILL</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">desired end-time, which is the expiration time in the ticket</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">RTIME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">desired renew-till time (only in request for renewable ticket)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">NONCE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">number to be returned in the reply to prevent replay attacks (MIT implementation uses current timestamp as the nonce)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">ETYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">type of encryption Alice would like KDC to use when encrypting the credentials</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">ADDRESSES</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">network layer addresses to include in ticketÂused in proxy or forwardable tickets, or when Alice has multiple network layer addresses</p></td></tr></table></p><br />
<p class="docText">The flags that make sense in an <span class="docEmphRomanAlt">AS_REQ</span> are:</p>
<ul><li><p class="docList"><span class="docEmphSmaller">FORWARDABLE</span>ÂPlease set the <span class="docEmphSmaller">FORWARDABLE</span> flag in the returned TGT (so that the TGT can later be sent back to the KDC to request a TGT with a different network layer address inside).</p></li><li><p class="docList"><span class="docEmphSmaller">PROXIABLE</span>ÂPlease set the <span class="docEmphSmaller">PROXIABLE</span> flag in the returned TGT (so that the TGT can be used to request a ticket with a different network layer address inside).</p></li><li><p class="docList"><span class="docEmphSmaller">ALLOW-POSTDATE</span>ÂPlease set the <span class="docEmphSmaller">ALLOW-POSTDATE</span> flag in the returned TGT (so that this TGT can be used to request postdated tickets).</p></li><li><p class="docList"><span class="docEmphSmaller">POSTDATED</span>ÂMake the returned ticket or TGT postdated, using the <span class="docEmphSmaller">START-TIME</span> in the request. Note that the <span class="docEmphSmaller">START-TIME</span> is an optional field, and it probably would have been more elegant to merely assume, if the requester included a <span class="docEmphSmaller">START-TIME</span>, that the requester wanted the ticket to be a postdated ticket. But the way Kerberos is defined, if the requester includes a <span class="docEmphSmaller">START-TIME</span> and does not set the <span class="docEmphSmaller">POSTDATED</span> flag, then the <span class="docEmphSmaller">START-TIME</span> is ignored and an ordinary, non-postdated ticket is returned.</p></li><li><p class="docList"><span class="docEmphSmaller">RENEWABLE</span>ÂPlease set the <span class="docEmphSmaller">RENEWABLE</span> flag in the returned ticket or TGT.</p></li><li><p class="docList"><span class="docEmphSmaller">RENEWABLE-OK</span>ÂThe requester wants a ticket with a long lifetime. If the KDC is not willing to issue a ticket with that long a lifetime, the requester is willing to settle for a renewable ticket with an initial expiration time as far in the future as the KDC is willing to issue and renewable until the requested expiration time.</p></li></ul>
<a name="ch14lev2sec8"></a>
<h4 id="title-IDAVLUZR" class="docSection2Title">14.15.4. TGS_REQ</h4>
<p class="docText">A <span class="docEmphRomanAlt">TGS_REQ</span> is used to request either a TGT or a ticket.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="150"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">12</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PADATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">ticket and authenticator</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">KDC-OPTIONS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">flags from <span class="docEmphRomanAlt">AS_REQ</span>, plus a few more explained above</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(or the name <span class="docEmphRomanAlt">krbtgt</span> if the request is for a TGT)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">REALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">realm in which Bob resides (Alice might reside in a differerent realm in the case of a <span class="docEmphRomanAlt">TGS_REQ</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">FROM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(postdated ticket) desired start-time</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TILL</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">desired end-time, which is the expiration time in the ticket</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">RTIME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">desired renew-till time (only in request for renewable ticket)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">NONCE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">number to be returned in the reply to prevent replay attacks (MIT implementation uses current timestamp as the nonce)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">ETYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">type of encryption Alice would like KDC to use when encrypting the credentials</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">ADDRESSES</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">network layer addresses to include in ticketÂused in proxy or forwardable tickets, or when Alice has multiple network layer addresses</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">AUTHORIZATION-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">application specific data to be copied into TGT and tickets requested using that TGT, intended to convey restrictions on use. Note that this field is encrypted and integrity-protected.</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">ADDITIONAL-TICKETS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's TGT in the case where Bob does not know his master key (see &sect;<a class="docLink" href="ch14lev1sec12.html#ch14lev1sec12">14.12</a> <span class="docEmphasis">Double TGT Authentication</span>)</p></td></tr></table></p><br />
<p class="docText">The differences between a <span class="docEmphRomanAlt">TGS_REQ</span> and an <span class="docEmphRomanAlt">AS_REQ</span> are:</p>
<ul><li><p class="docList">The <span class="docEmphRomanAlt">TGS_REQ</span> contains a TGT or a renewable or postdated ticket (the <span class="docEmphRomanAlt">AS_REQ</span> does not).</p></li><li><p class="docList">The <span class="docEmphRomanAlt">TGS_REQ</span> includes an authenticator in its <span class="docEmphSmaller">PADATA</span> field, proving the requester knows the key contained in the TGT or ticket in the request. The <span class="docEmphRomanAlt">AS_REQ</span> contains an encrypted timestamp in its optional <span class="docEmphSmaller">PADATA</span> field, proving the requester knows Alice's master key.</p></li><li><p class="docList">The reply to a <span class="docEmphRomanAlt">TGS_REQ</span> is usually encrypted with the key inside the TGT or ticket enclosed with the request. However, if the authenticator contains a different key (called a subkey), the reply is encrypted with the subkey inside the authenticator. In contrast, the reply to an <span class="docEmphRomanAlt">AS_REQ</span> is always encrypted with the requester's master key.</p></li><li><p class="docList">There are more flags that might be relevant in a <span class="docEmphRomanAlt">TGS_REQ</span>. All the flags applicable to an <span class="docEmphRomanAlt">AS_REQ</span> are applicable to a <span class="docEmphRomanAlt">TGS_REQ</span>. In addition, the following flags are applicable in a <span class="docEmphRomanAlt">TGS_REQ</span>:</p><ul><li><p class="docList"><span class="docEmphSmaller">FORWARDED</span>ÂA list of addresses appears in the request which is different than the list of addresses (if any) that appears in the ticket. The list in the request should be included in the returned ticket, and the <span class="docEmphSmaller">FORWARDED</span> flag should be set in the returned ticket.</p></li><li><p class="docList"><span class="docEmphSmaller">PROXY</span>ÂSame as <span class="docEmphSmaller">FORWARDED</span>, except this flag is used when requesting a TGT.</p></li><li><p class="docList"><span class="docEmphSmaller">ENC-TKT-IN-SKEY</span>ÂIncluded in this request is Bob's TGT (see &sect;<a class="docLink" href="ch14lev1sec12.html#ch14lev1sec12">14.12</a> <span class="docEmphasis">Double TGT Authentication</span>).</p></li><li><p class="docList"><span class="docEmphSmaller">RENEW</span>ÂPlease renew the enclosed ticket.</p></li><li><p class="docList"><span class="docEmphSmaller">VALIDATE</span>ÂPlease validate the enclosed postdated ticket.</p></li></ul></li><li><p class="docList">The <span class="docEmphRomanAlt">AS_REQ</span> contains the field <span class="docEmphSmaller">CNAME</span>, which does not appear in a <span class="docEmphRomanAlt">TGS_REQ</span>. It is not needed in the <span class="docEmphRomanAlt">TGS_REQ</span> because the KDC obtains the name of the requester from inside the ticket or TGT enclosed with the <span class="docEmphRomanAlt">TGS_REQ</span>.</p></li><li><p class="docList">The <span class="docEmphRomanAlt">TGS_REQ</span> contains the field <span class="docEmphSmaller">AUTHORIZATION-DATA</span>, and the <span class="docEmphRomanAlt">AS_REQ</span> does not. This field is supposed to be copied from the request into the ticket or TGT returned with the reply. It's actually somewhat of a nuisance that Kerberos does not allow this field in an <span class="docEmphRomanAlt">AS_REQ</span>. If you want a TGT or ticket with <span class="docEmphSmaller">AUTHORIZATION-DATA</span>, then you have to first obtain a TGT without that field, and then use that TGT in a <span class="docEmphRomanAlt">TGS_REQ</span> to request a TGT with <span class="docEmphSmaller">AUTHORIZATION-DATA</span>. Note that in order to prevent an intruder from modifying <span class="docEmphSmaller">AUTHORIZATION-DATA</span> in the request on its way to the KDC, the field is encrypted and integrity-protected with the key in the enclosed ticket or TGT, or if a subkey is present in the authenticator, then it's encrypted with that subkey. Note that <span class="docEmphSmaller">AUTHORIZATION-DATA</span> is treated differently than the other fields in the request, such as Bob's name, which are sent unencrypted and without integrity protection. Alice knows those other fields arrived intact because they are encrypted and integrity-protected when the KDC returns the credentials to Alice.</p></li><li><p class="docList">The <span class="docEmphRomanAlt">TGS_REQ</span> also contains the field <span class="docEmphSmaller">ADDITIONAL-TICKETS</span>, which if <span class="docEmphSmaller">ENC-TKT-IN-SKEY</span> is set in the <span class="docEmphSmaller">KDC-OPTIONS</span> field in the <span class="docEmphRomanAlt">TGS_REQ</span>, contains Bob's TGT.</p></li></ul>
<a name="ch14lev2sec9"></a>
<h4 id="title-IDAO15YR" class="docSection2Title">14.15.5. AS_REP</h4>
<p class="docText">An <span class="docEmphRomanAlt">AS_REP</span> is the reply from the KDC to an <span class="docEmphRomanAlt">AS_REQ</span>. It returns a TGT or ticket.</p>
<p class="docText">In practice, <span class="docEmphSmaller">PADATA</span> is absent, indicating that the salt to be used is the user's name and realm. If a different salt is specified, it is not possible to transmit <span class="docEmphSmaller">PADATA</span> in the <span class="docEmphRomanAlt">AS_REQ</span>, because the user's master key would not be known.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">11</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">PADATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) salt to combine with the user's password in order to compute the master key derived from the user's password (see below)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CREALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's realm</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name. The purpose of Alice's name and realm is to help Alice's workstation figure out what key to use to decrypt the encrypted data.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TICKET</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the ticket to Bob that Alice requested</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">ENC-PART</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">encrypted portion (see below)</p></td></tr></table></p><br />
<p class="docText">Kerberos does provide mechanisms for recovery in case Alice's workstation does not know the proper value of salt. One plausible reason why Alice's workstation would not know the salt is that the realm name has changed since Alice last set her password. If the workstation has the wrong salt value, it will supply an incorrect value for <span class="docEmphSmaller">PADATA</span> in the request, and the KDC will return an error message. The error message returned by the KDC contains the proper salt value, and then Alice's workstation can try again, this time knowing the proper salt value.</p>
<p class="docText">The <span class="docEmphSmaller">ENC-PART</span> is encrypted with Alice's master key. When decrypted, it contains the following fields:</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="125"></col><col width="425"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">KEY</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">encryption key associated with the ticket enclosed in the <span class="docEmphRomanAlt">AS_REP</span></p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">LAST-REQ</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">a sequence of from 0 to 5 timestamps specifying such information as when Alice last requested a TGT, or last requested any ticket. The specification is vague about how these times are supposed to be synchronized across KDC replicas. Indeed, the MIT implementation (as of the writing of this book) does not implement any of these, and always returns no timestamps in this field.</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">NONCE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the nonce copied from the <span class="docEmphRomanAlt">AS_REQ</span></p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">KEY-EXPIRATION</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) time when user's master key will expire for the purpose of warning Alice to change her password</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">FLAGS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">a copy of the flags that appear inside the ticket (so that Alice can check if the KDC granted all she requested in the request, and also allows her to detect malicious modification that might have been done to the <span class="docEmphRomanAlt">AS_REQ</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTH-TIME</span>, <span class="docEmphSmaller">START-TIME</span>, <span class="docEmphSmaller">END-TIME</span>, <span class="docEmphSmaller">RENEW-TILL</span></p></td><td class="docTableCell" align="left" valign="middle"><p class="docText">timestamps; <span class="docEmphSmaller">START-TIME</span> and <span class="docEmphSmaller">RENEW-TILL</span> are optional (see &sect;<a class="docLink" href="ch14lev1sec4.html#ch14lev1sec4">14.4</a> <span class="docEmphasis">Ticket Lifetimes</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">SREALM, SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CADDR</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the set of addresses from which this ticket will be valid</p></td></tr></table></p><br />
<a name="ch14lev2sec10"></a>
<h4 id="title-IDABHAZR" class="docSection2Title">14.15.6. TGS_REP</h4>
<p class="docText">A <span class="docEmphRomanAlt">TGS_REP</span> is the reply from the KDC to a <span class="docEmphRomanAlt">TGS_REQ</span>. It is virtually identical to an <span class="docEmphRomanAlt">AS_REP</span>. The differences are</p>
<ul><li><p class="docList">There is never a <span class="docEmphSmaller">PADATA</span> field in a <span class="docEmphRomanAlt">TGS_REP</span>, whereas it is optional in an <span class="docEmphRomanAlt">AS_REP</span>. (The <span class="docEmphSmaller">PADATA</span> field in an <span class="docEmphRomanAlt">AS_REP</span> contains the salt.)</p></li><li><p class="docList">There is no <span class="docEmphSmaller">KEY-EXPIRATION</span> field in a <span class="docEmphRomanAlt">TGS_REP</span>, whereas it is optional in an <span class="docEmphRomanAlt">AS_REP</span>.</p></li><li><p class="docList">The <span class="docEmphSmaller">ENC-PART</span> field is encrypted with the key in the TGT or ticket sent in the <span class="docEmphRomanAlt">TGS_REQ</span>; or if a subkey is included in the authenticator sent in the <span class="docEmphRomanAlt">TGS_REQ</span>, then the <span class="docEmphSmaller">ENC-PART</span> is encrypted with that subkey.</p></li></ul>
<a name="ch14lev2sec11"></a>
<h4 id="title-IDA4JAZR" class="docSection2Title">14.15.7. AP_REQ</h4>
<p class="docText">An <span class="docEmphRomanAlt">AP_REQ</span> is the first message when Alice, who has obtained a ticket to Bob, actually attempts to communicate with Bob.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">14</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">AP-OPTIONS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">flags, of which two are defined:</p>
<p class="docText"><span class="docEmphSmaller">USE-SESSION-KEY</span>, which means the ticket is encrypted under the session key in Bob's TGT (rather than Bob's master keyÂsee &sect;<a class="docLink" href="ch14lev1sec12.html#ch14lev1sec12">14.12</a> <span class="docEmphasis">Double TGT Authentication</span>)</p>
<p class="docText"><span class="docEmphSmaller">MUTUAL-REQUIRED</span>, which tells Bob mutual authentication is requested</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TICKET</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the ticket to Bob</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTHENTICATOR</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">an authenticator, proving Alice knows the key inside the ticket</p></td></tr></table></p><br />
<a name="ch14lev2sec12"></a>
<h4 id="title-IDAQOAZR" class="docSection2Title">14.15.8. AP_REP</h4>
<p class="docText">An <span class="docEmphRomanAlt">AP_REP</span> is Bob's reply to an <span class="docEmphRomanAlt">AP_REQ</span> from Alice.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">15</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="center" valign="top" colspan="2"><p class="docText">The rest is encrypted:</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CTIME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the time copied from the <span class="docEmphSmaller">CTIME</span> field of the authenticator in the <span class="docEmphRomanAlt">AP_REQ</span></p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CUSEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the low order bits of <span class="docEmphSmaller">CTIME</span>, since <span class="docEmphSmaller">CTIME</span> is expressed in seconds; this field specifies microseconds</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">SUBKEY</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">an optional field intended for Bob to be able to influence the Alice-Bob session key in an application-specific way</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">SEQ-NUMBER</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">starting sequence number for messages sent from Bob to Alice</p></td></tr></table></p><br />
<p class="docText">The encrypted section (<span class="docEmphSmaller">CTIME</span> through <span class="docEmphSmaller">SEQ-NUMBER</span>) is encrypted with the key inside the ticket from the <span class="docEmphRomanAlt">AP_REQ</span>, unless a <span class="docEmphSmaller">SUBKEY</span> field is included in the <span class="docEmphSmaller">AUTHENTICATOR</span> from the <span class="docEmphRomanAlt">AP_REQ</span>, in which case it is encrypted with the subkey.</p>
<a name="ch14lev2sec13"></a>
<h4 id="title-IDAZUAZR" class="docSection2Title">14.15.9. KRB_SAFE</h4>
<p class="docText">A <span class="docEmphRomanAlt">KRB_SAFE</span> message transfers data between Alice and Bob with integrity protection.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">20</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">USER-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">whatever the application wants to send</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">TIMESTAMP</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) current time in seconds at the originator of the message, so the recipient can put messages in order, and can make sure the timestamp is within acceptable clock skew</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">USEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the low-order bits (the microsecond portion) of the time, since <span class="docEmphSmaller">TIMESTAMP</span> is in seconds</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">SEQ-NUMBER</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) sequence number of this message, so the recipient can detect lost messages and put messages in order</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">S-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the network address of the sender of the message (the same address is presumably in the network layer header, but here it is cryptographically protected)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">R-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the recipient's network address. Again, presumably it is equal to the destination address in the network layer header, but here it is cryptographically protected.</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CKSUM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">checksum on the fields <span class="docEmphSmaller">USER-DATA</span> through <span class="docEmphSmaller">R-ADDRESS</span>, using one of the checksum types defined in &sect;<a class="docLink" href="ch14lev1sec8.html#ch14lev2sec3">14.8.1</a> <span class="docEmphasis">Integrity-Only Algorithms</span></p></td></tr></table></p><br />
<a name="ch14lev2sec14"></a>
<h4 id="title-IDAH1AZR" class="docSection2Title">14.15.10. KRB_PRIV</h4>
<p class="docText">A <span class="docEmphRomanAlt">KRB_PRIV</span> message is encrypted (and integrity-protected) data sent between Alice and Bob. It is encrypted with the key arranged for this conversation.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">21</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="center" valign="top" colspan="2"><p class="docText">The rest is encrypted:</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">USER-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">whatever the applications wants to send</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">TIMESTAMP</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) current time in seconds at the originator of the message, so the recipient can put messages in order, and make sure the timestamp is within acceptable clock skew</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">USEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the low order bits (the microsecond portion) of the time, since <span class="docEmphSmaller">TIMESTAMP</span> is in seconds</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">SEQ-NUMBER</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) sequence number of this message, so the recipient can detect lost messages and put messages in order</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">S-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the network address of the sender of the message (the same address is presumably in the network layer header, but here it is cryptographically protected)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">R-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the recipient's network address. Again, presumably it is equal to the destination address in the network layer header, but here it is cryptographically protected.</p></td></tr></table></p><br />
<a name="ch14lev2sec15"></a>
<h4 id="title-IDABBBZR" class="docSection2Title">14.15.11. KRB_CRED</h4>
<p class="docText">A <span class="docEmphRomanAlt">KRB_CRED</span> message is used for passing credentials (a ticket and session key) for the purpose of delegation (see &sect;<a class="docLink" href="ch14lev1sec3.html#ch14lev1sec3">14.3</a> <span class="docEmphasis">Delegation of Rights</span>). Assume Alice would like to delegate to Ted her right to access Bob. Alice would send Ted a <span class="docEmphRomanAlt">KRB_CRED</span> message containing a ticket to Bob, along with the session key corresponding to Bob's ticket. The encrypted portion of the <span class="docEmphRomanAlt">KRB_CRED</span> message is encrypted using a key that has been established between Alice and Ted, so the assumption is that Alice has already initiated a Kerberos protected conversation to Ted, and they now share a key.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="100"></col><col width="450"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><a name="iddle1344"></a><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">22</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TICKETS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">a sequence of tickets</p></td></tr><tr><td class="docTableCell" align="center" valign="top" colspan="2"><p class="docText">The rest is encrypted with the Alice-Ted conversation key:</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">TICKET-INFO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">information corresponding to each ticket in <span class="docEmphSmaller">TICKETS</span> field, see below</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">NONCE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) a number supplied by Carol to Alice, which Alice puts into the <span class="docEmphRomanAlt">KRB_CRED</span> message when delegating to Carol, to reassure Carol that the <span class="docEmphRomanAlt">KRB_CRED</span> is not a replay transmitted by an intruder, and is indeed recently transmitted by Alice</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">TIMESTAMP</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) current time in seconds at the originator of the message, so the recipient can put messages in order, and make sure the timestamp is within acceptable clock skew</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">USEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the low order bits (the microsecond portion) of the time, since <span class="docEmphSmaller">TIMESTAMP</span> is in seconds</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">S-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the network address of the sender of the message (the same address is presumably in the network layer header, but here it is cryptographically protected)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">R-ADDRESS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the recipient's network address. Again, presumably it is equal to the destination address in the network layer header, but here it is cryptographically protected.</p></td></tr></table></p><br />
<p class="docText">The <span class="docEmphSmaller">TICKET-INFO</span> field is a sequence of one or more repetitions of the following information:</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="175"></col><col width="375"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">KEY</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">encryption key associated with the corresponding ticket enclosed in the <span class="docEmphRomanAlt">KRB_CRED</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PREALM</span>, <span class="docEmphSmaller">PNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) Alice's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">FLAGS</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) a copy of the flags that appear inside the ticket</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">AUTH-TIME</span>, <span class="docEmphSmaller">START-TIME</span>, <span class="docEmphSmaller">END-TIME</span>, <span class="docEmphSmaller">RENEW-TILL</span></p></td><td class="docTableCell" align="left" valign="middle"><p class="docText">(optional) timestamps</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">SREALM</span>, <span class="docEmphSmaller">SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) Bob's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CADDR</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) the set of addresses from which this ticket will be valid</p></td></tr></table></p><br />
<a name="ch14lev2sec16"></a>
<h4 id="title-IDA4MBZR" class="docSection2Title">14.15.12. KRB_ERROR</h4>
<p class="docText">In Kerberos V4 there were two types of error messages, one that would be returned by the KDC, the other returned by an application when authentication failed. In Kerberos V5 there is only one error message defined, and it is used for both purposes. None of the information in the error message is encrypted or integrity-protected. Let's assume that Alice has sent a message to Bob, and that Bob is returning the error message to Alice because of some problem with Alice's message.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="all" cellpadding="4"><colgroup align="left" span="2"><col width="150"></col><col width="400"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">MSG-TYPE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">message type (<span class="docEmphRomanAlt">30</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">PVNO</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">protocol version number (<span class="docEmphRomanAlt">5</span>)</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">CTIME</span>, <span class="docEmphSmaller">CUSEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) <span class="docEmphSmaller">CTIME</span> and <span class="docEmphSmaller">CUSEC</span> fields copied from the message generated by Alice that caused the error</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">STIME</span>, <span class="docEmphSmaller">SUSEC</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">time at Bob when he generated the <span class="docEmphRomanAlt">KRB_ERROR</span> message</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">ERROR-CODE</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">the error code, indicating the type of error</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">CNAME</span>, <span class="docEmphSmaller">CREALM</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">(optional) Alice's name and realm</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">REALM</span>, <span class="docEmphSmaller">SNAME</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's realm and name</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphSmaller">E-TEXT</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">additional information to help explain the error, in printable text</p></td></tr><tr><td class="docTableCell" align="left" valign="middle"><p class="docText"><span class="docEmphSmaller">E-DATA</span></p></td><td class="docTableCell" align="left" valign="top"><p class="docText">additional information to help explain the error. Not guaranteed to be printable text.</p></td></tr></table></p><br />
<p class="docText">Here are all the error codes. Error codes 1Â30 come only from the KDC, in response to a <span class="docEmphRomanAlt">AS_REQ</span> or <span class="docEmphRomanAlt">TGS_REQ</span>. The others can come from either the KDC or an application, in response to an <span class="docEmphRomanAlt">AP_REQ</span>, <span class="docEmphRomanAlt">KRB_PRIV</span>, <span class="docEmphRomanAlt">KRB_SAFE</span>, or <span class="docEmphRomanAlt">KRB_CRED</span>.</p>
<p><table cellspacing="0" class="allBorders" border="1" rules="none" cellpadding="5"><colgroup align="left" span="2"><col width="50"></col><col width="500"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText">code</p></td><td class="docTableCell" align="center" valign="top"><p class="docText">reason</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">0</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">No error. (Really, it's in the documentation! I'm sure it's annoying to get an error message telling you that you <span class="docEmphasis">didn't</span> make an error but it's not going to do what you asked it to do anyway. In reality, this would never appear, and is probably listed in the documentation just to ensure nobody assigns error code 0 to a real error.)</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">1</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's entry in the KDC database has expired.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">2</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's entry in the KDC database has expired.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">3</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The requested Kerberos version number is not supported.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">4</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC has forgotten the key with which Alice's entry in its database was encrypted. (It was an old version number, and the KDC didn't save that key.)</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">5</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC has forgotten the key with which Bob's entry in its database was encrypted.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">6</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC never heard of Alice.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">7</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC never heard of Bob.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">8</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Either Bob or Alice appears in the KDC database multiple times. (Really, it would make more sense to check this when modifying the KDC database, or have a utility that checks this every once in awhile rather than checking this when requests are made.)</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">9</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Either Bob or Alice's entry in the KDC does not contain a master key (see parenthetical remark for error 8).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">10</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice asked for a postdated ticket, but her TGT does not allow this.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">11</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The requested start time is later than the end time (maybe the KDC should just give Alice the useless ticket that she requested).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">12</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC policy does not allow the request.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">13</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC cannot grant the requested option.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">14</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC doesn't support this encryption type.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">15</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC doesn't support this checksum type.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">16</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC does not support this type of <span class="docEmphSmaller">PADATA</span>.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">17</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">KDC does not support the transited type. (The <span class="docEmphSmaller">TRANSITED</span> field has a type and a value. The type is one that the KDC does not understand.)</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">18</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's credentials have been revokedÂthe account is marked invalid in KDC, or Alice's TGT has been revoked.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">19</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's credentials have been revoked.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">20</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">TGT has been revoked.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">21</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's entry is not yet validÂtry again later.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">22</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob's entry is not yet validÂtry again later.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">23</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's password has expired.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">24</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Pre-authentication information invalid.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">25</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Pre-authentication required.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">26</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Ticket doesn't match server name in double-TGT authentication.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">27</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Double-TGT authentication is required by KDC.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">28</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Set of transited KDCs is not acceptable to KDC.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">29</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob does not have the requested service.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">31</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Integrity check on decrypted field failed.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">32</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The ticket has expired.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">33</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The ticket is not yet valid.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">34</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The request is a replay.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">35</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">This ticket isn't for us.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">36</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The ticket and authenticator don't match.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">37</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The clock skew is too great.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">38</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The network address in the network layer header doesn't match the network layer address inside the ticket.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">39</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The protocol version number doesn't match.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">40</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The message type is unsupported.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">41</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The checksum didn't check. (The documentation describes this error as <span class="docEmphasis">message stream modified</span>, but we prefer not to place blameÂthere might be a perfectly innocent explanation.)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">42</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The message is out of order. In both encrypted and integrity-checked data, there is a sequence number. The network can certainly reorder messages, and such innocent reordering of messages should not generate an error. If the messages are being delivered with a reliable transport layer protocol, then this error would be generated because of some deliberate tampering with the message stream, which can be detected by Kerberos. If the messages are being delivered with a datagram service (like UDP), then since the sequence number is optional, it should not be used.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">44</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The specified version of the key is not available.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">45</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Bob doesn't know his key.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">46</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Mutual authentication failed.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">47</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The message direction is incorrect. In V4 this was determined based on the D BIT. The D BIT no longer exists in V5, but instead, in integrity-protected and encrypted data, there is a <span class="docEmphSmaller">SENDER</span>'S <span class="docEmphSmaller">ADDRESS</span> and a <span class="docEmphSmaller">RECEIVER</span>'S <span class="docEmphSmaller">ADDRESS</span> field. If Bob receives a message from Alice and these fields are swapped, it indicates that an intruder is trying to trick them by mirroring messages back.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">48</p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis">Alternative authentication method required</span>. For instance, Bob does not know his master key, but does have a TGT (see &sect;<a class="docLink" href="ch14lev1sec12.html#ch14lev1sec12">14.12</a> <span class="docEmphasis">Double TGT Authentication</span>).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">49</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The sequence number in the message is incorrect.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">50</p></td><td class="docTableCell" align="left" valign="top"><p class="docText"><span class="docEmphasis">Inappropriate type of checksum in message</span>. Presumably, this is because Bob doesn't support that checksum type. The wording in the documentation implies that Bob is making a value judgement on Alice's choice of checksum. For instance, if Alice were to choose CRC-32 as an integrity check instead of a message digest, Bob might sneeringly send this error message.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">60</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Generic error. The description is in <span class="docEmphSmaller">E-TEXT</span>.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">61</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Some field is too long for this implementation.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">62</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's certificate is unacceptable to the KDC (PKINIT).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">63</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC doesn't have a certificate from an acceptable CA (PKINIT).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">64</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's signature is invalid (PKINIT).</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">65</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's key isn't big enough to suit the KDC.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">66</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name doesn't match the name in her certificate.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">70</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC can't verify Alice's certificate.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">71</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">One of Alice's certificates is invalid.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">72</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">One of Alice's certificates is revoked.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">73</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC can't figure out whether one of Alice's certificates is revoked.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">74</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC can't reach Alice's certificate revocation service.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">75</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">Alice's name doesn't match the name in her certificate.</p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText">76</p></td><td class="docTableCell" align="left" valign="top"><p class="docText">The KDC is not who Alice thinks it is.</p></td></tr></table></p><br />
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch14lev1sec14.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch14lev1sec16.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>