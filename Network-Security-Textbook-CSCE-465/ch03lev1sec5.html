<html><head><title>3.5. Advanced Encryption Standard (AES)</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch03lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch03lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="15051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch03lev1sec5"></a>
<h3 id="title-IDAMEZYF" class="docSection1Title">3.5. Advanced Encryption Standard (AES)</h3>
<p class="docText">The world needed a new secret key standard. DES's key was too small. Triple DES (3DES, see &sect;<a class="docLink" href="ch04lev1sec4.html#ch04lev1sec4">4.4</a> <span class="docEmphasis">Multiple Encryption DES</span>) was too slow. IDEA was encumbered (i.e., had patent protection), suspect, and slow. The National Institute of Standards and Technology (NIST) decided it wanted to facilitate creation of a new standard, but it had at least as difficult a political problem as a technical problem. Years of some branches of the U.S. government trying everything they could to hinder deployment of secure cryptography was likely to raise strong skepticism if a branch of the government stepped forward and said <span class="docEmphasis">We're from the government, and we're here to help you develop and deploy strong crypto</span>. The following quote gives a hint as to the deep resentment and mistrust that previous crypto export policies and the threat of domestic controls on encryption created.</p>
<blockquote>
<p class="docText"><span class="docEmphasis">The NSA regularly lies to people who ask it for advice on export control. They have no reason not to; accomplishing their goal by any legal means is fine by them. Lying by government employees is legal.</span></p>
<p class="docText">ÂJohn Gilmore</p></blockquote>
<p class="docText"><a name="iddle1238"></a><a name="iddle1257"></a><a name="iddle1368"></a><a name="iddle1382"></a><a name="iddle1446"></a><a name="iddle1717"></a><a name="iddle1917"></a><span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_137">NIST</a></span> really did want to help create an excellent new security standard. The new standard should be efficient, flexible, secure, and unencumbered (free to implement). But how could it help create one? Staying out of the picture wouldn't help, since nobody else seemed to have the technical reputation and energy to lead the effort. Proposing an NSA-designed cipher, designed in secret, wouldn't work since everyone would speculate that there were trapdoors. So on January 2, 1997, NIST announced a contest to select a new encryption standard to be used for protecting sensitive, non-classified, U.S. government information. Proposals would be accepted from anyone, anywhere in the world. The candidate ciphers had to meet a bunch of requirements, including having a documented design rationale (and not just <span class="docEmphasis">Here's a bunch of transforms we do on the data</span>). Then there were several years in which conferences were held for presentation of papers analyzing the candidates. There was a group of highly motivated cryptographers (the authors of submitted entries) looking for flaws in the proposals. And NIST also ran tests of the candidates for performance and other characteristics.</p>
<p class="docText">After lots of investigation and discussion in the cryptographic community, NIST chose an algorithm called <span class="docEmphasis">Rijndael</span>, named after the two Belgian cryptographers who developed and submitted itÂDr. Joan Daemen of Proton World International and Dr. Vincent Rijmen, a postdoctoral researcher in the Electrical Engineering Department (ESAT) of Katholieke Universiteit Leuven [DAE99]. As of 26 November 2001, AES, a standardization of Rijndael, is a Federal Information Processing Standard [FIPS01].</p>
<p class="docText">Rijndael provides for a variety of block and key sizes. These two parameters can be chosen independently from 128, 160, 192, 224, and 256 bits. (in particular, key size and block size can be different). AES mandates a block size of 128 bits, and a choice of key size from 128, 192, and 256 bits <sup class="docFootnote"><a class="docLink" href="#ch03fn02">[*]</a></sup>, with the resulting versions imaginatively called AES-128, AES-192, and AES-256, respectively. We'll describe Rijndael, mentioning the AES parameters explicitly from time to time.</p><blockquote><p class="docFootnote"><sup><a name="ch03fn02">[*]</a></sup> We<sub>1,2</sub> can't imagine anyone using 192 bits. 256 is probably not necessary, since 128 bits is really long enough. 256 gives &quot;bragging rights&quot; to those who believe more must be better and are willing to take a performance hit to claim their product is more secure because of having a larger key than the competitors. Anyone willing to take a performance hit in order to advertise a larger key will use 256 bits rather than 192.</p></blockquote>
<p class="docText">Rijndael is based on some beautiful mathematics, but we'll leave the discussion of the mathematics to &sect;<a class="docLink" href="ch08lev1sec5.html#ch08lev1sec5">8.5</a> <span class="docEmphasis">Mathematics of Rijndael</span>. Rijndael is similar to DES and IDEA in that there is a series of rounds which mangles a plaintext block into a ciphertext block, and a key expansion algorithm that takes the key and massages it into a bunch of round keys.</p>
<a name="ch03lev2sec13"></a>
<h4 id="title-IDAEIZYF" class="docSection2Title">3.5.1. Basic Structure</h4>
<p class="docText">Rijndael allows a certain amount of flexibility by use of two independent parameters, with a third parameter derived from the other two:</p>
<ul><li><p class="docList">The block size, <span class="docEmphasis">N<sub>b</sub>.</span> This is the number of 32-bit words (4-octet columns) in an encryption block. AES has <span class="docEmphasis">N<sub>b</sub></span> = 4, because its 128-bit block size is four 32-bit words.</p></li><li><p class="docList"><a name="iddle1949"></a>The key size, <span class="docEmphasis">N<sub>k</sub>.</span> This is the number of 32-bit words (4-octet columns) in an encryption key. AES-128 has <span class="docEmphasis">N<sub>k</sub></span> = 4, AES-192 has <span class="docEmphasis">N<sub>k</sub></span> = 6, AES-256 has <span class="docEmphasis">N<sub>k</sub></span> = 8. Rijndael allows any <span class="docEmphasis">N<sub>k</sub></span> between 4 and 8 inclusive.</p></li><li><p class="docList">The number of rounds <span class="docEmphasis">N<sub>r</sub>.</span> This parameter is a function of the other two parameters. The number of rounds needs to be larger for longer keys so that breaking the encryption is as difficult as a brute-force attack at that key size. The number of rounds needs to be larger for bigger block sizes (and key sizes) to allow sufficient mixing so that each bit of a plaintext block (or key) has a complex effect on each bit of the resulting ciphertext block. So Rijndael specifies that <span class="docEmphasis">N<sub>r</sub></span> = 6 + max(<span class="docEmphasis">N<sub>b</sub></span>, <span class="docEmphasis">N<sub>k</sub></span>). This means that AES-128 has ten rounds, AES-192 has twelve rounds, and AES-256 has fourteen rounds.</p></li></ul>
<p class="docText">Rijndael (<a class="docLink" href="#ch03fig23">Figure 3-23</a>) keeps a rectangular array of octets as its state. The state has <span class="docEmphasis">N<sub>b</sub></span> 4-octet columns. Initially, the state is filled column by column from the 4<span class="docEmphasis">N<sub>b</sub></span>-octet input block. The state is transformed in <span class="docEmphasis">N<sub>r</sub></span> rounds into a final state, which is then read out column by column as the output block. Before round 1, between rounds, and after round <span class="docEmphasis">N<sub>r</sub></span> is an <img src="U2295.GIF" border="0" />, into the state, of the next 4<span class="docEmphasis">N<sub>b</sub></span> octets from the expanded key, read out as columns. Rounds 1 through <span class="docEmphasis">N<sub>r</sub></span>-1 comprise an identical sequence of operations, while round <span class="docEmphasis">N<sub>r</sub></span> omits one of them.</p>
<a name="ch03fig23"></a><p><center>
<h5 class="docFigureTitle">Figure 3-23. Basic Structure of Rijndael</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="03fig23_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="638" src="03fig23.jpg" /></p>
<br />
<p class="docText">The Rijndael key is a 4<span class="docEmphasis">N<sub>k</sub></span>-octet block. The key expansion algorithm flows the key, column by column, into <span class="docEmphasis">N<sub>k</sub></span> 4-octet columns, then proceeds to create additional columns until it has (<span class="docEmphasis">N<sub>r</sub></span>+1)<span class="docEmphasis">N<sub>b</sub></span> columns, the exact amount of expanded key required. Key expansion uses the same kinds of primitive operations as the rounds do.</p>
<p class="docText">Rows, columns, and round keys are numbered starting at 0. Round numbers start at 1.</p>
<a name="ch03lev2sec14"></a>
<h4 id="title-IDAPNZYF" class="docSection2Title">3.5.2. Primitive Operations</h4>
<p class="docText">Rijndael is based on four primitive operations.</p>
<ul><li><p class="docList"><img src="U2295.GIF" border="0" /></p></li><li><p class="docList">An octet-for-octet substitution, called the S-box (see <a class="docLink" href="#ch03fig24">Figure 3-24</a>)</p><a name="ch03fig24"></a><p><center>
<h5 class="docFigureTitle">Figure 3-24. Rijndael S-box</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="418" src="03fig24.jpg" /></p>
</li><li><p class="docList">A rearrangement of octets comprising rotating a row or column by some number of cells</p></li><li><p class="docList">An operation called <span class="docEmphasis">MixColumn</span>, which replaces a 4-octet column with another 4-octet column. <span class="docEmphasis">MixColumn</span> can be implemented with a single table (<a class="docLink" href="#ch03fig26">Figure 3-26</a>) containing 256 4-octet columns. Each of the four octets in an input column is used as an index to retrieve a column from the table; each column retrieved from the table is rotated vertically so that its top octet is in the same row as the input octet; and the four rotated columns are <img src="U2295.GIF" border="0" />'d together to produce the output column. (See <a class="docLink" href="#ch03fig25">Figure 3-25</a>.) We'll describe <span class="docEmphasis">MixColumn</span> mathematically in &sect;<a class="docLink" href="ch08lev1sec5.html#ch08lev1sec5">8.5</a> <span class="docEmphasis">Mathematics of Rijndael</span>.</p></li></ul>
<p class="docText"></p><a name="ch03fig25"></a><p><center>
<h5 class="docFigureTitle">Figure 3-25. <span class="docEmphasis">MixColumn</span> using table-lookup (see <a class="docLink" href="#ch03fig26">Figure 3-26</a>)</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="189" src="03fig25.jpg" /></p>
<br />
<p class="docText"></p><a name="ch03fig26"></a><p><center>
<h5 class="docFigureTitle">Figure 3-26. <span class="docEmphasis">MixColumn</span> table</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="897" src="03fig26.jpg" /></p>
<br />
<a name="ch03lev3sec3"></a>
<h5 id="title-IDAJSZYF" class="docSection3Title">3.5.2.1. What about the inverse cipher?</h5>
<ul><li><p class="docList"><img src="U2295.GIF" border="0" /> is its own inverse</p></li><li><p class="docList">The inverse S-box is just given by a different table (see <a class="docLink" href="#ch03fig27">Figure 3-27</a>)</p><a name="ch03fig27"></a><p><center>
<h5 class="docFigureTitle">Figure 3-27. Rijndael inverse S-box</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="418" src="03fig27.jpg" /></p>
</li><li><p class="docList">The inverse of rotating a row or column is just rotating it the same amount in the opposite direction</p></li><li><p class="docList">The inverse of <span class="docEmphasis">MixColumn</span>, called <span class="docEmphasis">InvMixColumn</span>, is just like <span class="docEmphasis">MixColumn</span>, but with a different table (<a class="docLink" href="#ch03fig28">Figure 3-28</a>)</p><a name="ch03fig28"></a><p><center>
<h5 class="docFigureTitle">Figure 3-28. <span class="docEmphasis">InvMixColumn</span> table</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="897" src="03fig28.jpg" /></p>
</li></ul>
<p class="docText">So the inverse cipher can clearly be implemented by applying the inverses of the primitive operations comprising the cipher in the opposite sequence from that in the cipher. But as it turns out, due to various mathematical properties (and by clever design), the inverse cipher can be made to look just like the forward cipher but with inverse operations, and with the round keys not just in reverse order, but having <span class="docEmphasis">InvMixColumn</span> applied to all but the first and last of them. This will be explained in &sect;<a class="docLink" href="ch08lev1sec5.html#ch08lev1sec5">8.5</a> <span class="docEmphasis">Mathematics of Rijndael</span>.</p>
<a name="ch03lev2sec15"></a>
<h4 id="title-IDA4VZYF" class="docSection2Title">3.5.3. Key Expansion</h4>
<p class="docText">Key expansion starts with the key arranged as <span class="docEmphasis">N<sub>k</sub></span> 4-octet columns (see <a class="docLink" href="#ch03fig29">Figure 3-29</a>) and iteratively generates the next <span class="docEmphasis">N<sub>k</sub></span> columns of the expanded key (see <a class="docLink" href="#ch03fig30">Figure 3-30</a>). To generate the <span class="docEmphasis">i</span>th set of <span class="docEmphasis">N<sub>k</sub></span> columns (<span class="docEmphasis">i</span> starts at 1; the 0th set is the supplied key), all that is needed is the (<span class="docEmphasis">i</span>-1)th set. Column 0 of the new set is gotten by rotating the last column of the (<span class="docEmphasis">i</span>-1)th set upward one cell, applying the S-box to each octet, and then <img src="U2295.GIF" border="0" />ing a constant based on <span class="docEmphasis">i</span> (see <a class="docLink" href="#ch03tab01">Figure 3-31</a>) into octet 0. The rest of the columns in the set are generated in turn by <img src="U2295.GIF" border="0" />ing the previous column with the corresponding column from the previous [(<span class="docEmphasis">i</span>-1)th] set. There is one exception to thisÂif <span class="docEmphasis">N<sub>k</sub></span> &gt; 6, then an additional step is required to finish generating column 4, namely the application of the S-box to each octet (see <a class="docLink" href="#ch03fig31">Figure 3-32</a>). Key expansion terminates as soon as (<span class="docEmphasis">N<sub>r</sub></span>+1)<span class="docEmphasis">N<sub>b</sub></span> columns of expanded key have been generated; this may happen in the middle of a set.</p>
<a name="ch03fig29"></a><p><center>
<h5 class="docFigureTitle">Figure 3-29. Rijndael key expansion, creation of set 0</h5>
</center></p><p class="docText">
<img border="0" alt="" width="350" height="234" src="03fig29.jpg" /></p>
<br />
<a name="ch03fig30"></a><p><center>
<h5 class="docFigureTitle">Figure 3-30. Rijndael key expansion, iteration step, <span class="docEmphasis">N<sub>k</sub></span> <img src="U2264.GIF" border="0" /> 6</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="330" src="03fig30.jpg" /></p>
<br />
<a name="ch03tab01"></a><p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><caption><h5 class="docTableTitle">Figure 3-31. Rijndael key-expansion constants <span class="docEmphasis">C<sub>i</sub></span></h5></caption><colgroup align="center" span="11"><col width="100"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col><col width="30"></col></colgroup><thead></thead><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">i</span> = 1 thru 10:</p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>1</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>2</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>4</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>8</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>10</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>20</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>40</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>80</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>1b</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>36</tt></span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">i</span> = 11 thru 20:</p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>6c</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>d8</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>ab</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>4d</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>9a</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>2f</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>5e</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>bc</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>63</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>c6</tt></span></p></td></tr><tr><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphasis">i</span> = 21 thru 30:</p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>97</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>35</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>6a</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>d4</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>b3</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>7d</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>fa</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>ef</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>c5</tt></span></p></td><td class="docTableCell" align="center" valign="top"><p class="docText"><span class="docEmphStrong"><tt>(91)</tt></span></p></td></tr></table></p><br />
<a name="ch03fig31"></a><p><center>
<h5 class="docFigureTitle">Figure 3-32. Difference in Rijndael key expansion step, <span class="docEmphasis">N<sub>k</sub></span> = 8 [and similarly for <span class="docEmphasis">N<sub>k</sub></span> = 7]</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="109" src="03fig32.jpg" /></p>
<br />
<a name="ch03lev2sec16"></a>
<h4 id="title-IDAGF0YF" class="docSection2Title">3.5.4. Rounds</h4>
<p class="docText">Each round is an identical sequence of three operations:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Each octet of the state has the S-Box applied to it.</p></div></li><li><div style="font-weight:normal"><p class="docList">Row 1 of the state is rotated left 1 column.</p><p class="docList">Row 2 of the state is rotated left 2+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/8<sub><img src="U230B.GIF" border="0" /></sub> columns (2 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 8, 3 otherwise).</p><p class="docList">Row 3 of the state is rotated left 3+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/7<sub><img src="U230B.GIF" border="0" /></sub> columns (3 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 7, 4 otherwise).</p><p class="docList">(Note that for AES, this simplifies to rotating row <span class="docEmphasis">i</span> left <span class="docEmphasis">i</span> columns.)</p></div></li><li><div style="font-weight:normal"><p class="docList">Each column of the state has <span class="docEmphasis">MixColumn</span> applied to it. Round <span class="docEmphasis">N<sub>r</sub></span> omits this operation.</p></div></li></ol></div>
<a name="ch03lev2sec17"></a>
<h4 id="title-IDAPH0YF" class="docSection2Title">3.5.5. Inverse Rounds</h4>
<p class="docText">Since each operation is invertible, decryption can be done by performing the inverse of each operation in the opposite order from that for encryption, and using the round keys in the reverse order.</p>
<p class="docText">But as we mentioned earlier, we can make decryption have the same structure as encryption. To do this, we not only have to use the round keys in the opposite order, but we have to apply <span class="docEmphasis">InvMixColumn</span> to each column of all but the initial and final round keys. Then each inverse round is an identical sequence of three operations:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Each octet of the state has the inverse S-Box applied to it.</p></div></li><li><div style="font-weight:normal"><p class="docList">Row 1 of the state is rotated right 1 column.</p><p class="docList">Row 2 of the state is rotated right 2+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/8<sub><img src="U230B.GIF" border="0" /></sub> columns (2 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 8, 3 otherwise).</p><p class="docList">Row 3 of the state is rotated right 3+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/7<sub><img src="U230B.GIF" border="0" /></sub> columns (3 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 7, 4 otherwise).</p><p class="docList">(Note that for AES, this simplifies to rotating row <span class="docEmphasis">i</span> right <span class="docEmphasis">i</span> columns.)</p></div></li><li><div style="font-weight:normal"><p class="docList">Each column of the state has <span class="docEmphasis">InvMixColumn</span> applied to it. Round <span class="docEmphasis">N<sub>r</sub></span> omits this operation.</p></div></li></ol></div>
<a name="ch03lev2sec18"></a>
<h4 id="title-IDA3J0YF" class="docSection2Title">3.5.6. Optimization</h4>
<p class="docText">In the straightforward implementation of a round, each octet of the state undergoes a table-lookup to apply the S-Box, and the resulting octet is later used for another table-lookup as part of <span class="docEmphasis">MixColumn</span>. We can combine these into a single table-lookup that transforms an octet into the column found by applying the S-Box and looking up the result in the <span class="docEmphasis">MixColumn</span> table.</p>
<p class="docText">We can further optimize a round by retaining the old state while we compute the new state. We initialize the new state to the round key. For each octet in the old state, we perform the combined table-lookup and <img src="U2295.GIF" border="0" /> the resulting column (rotated downward by the old octet's row number) into the appropriate column of the new state. For the first row (row 0), this is the old octet's column. For the second row (row 1), it's the column one to the left. <sup class="docFootnote"><a class="docLink" href="#ch03fn03">[*]</a></sup> For the third row (row 2), it's either two or three columns to the left (depending on whether or not <span class="docEmphasis">N<sub>b</sub></span> &lt; 8); and for the last row (row 3), it's either three or four columns to the left (depending on whether or not <span class="docEmphasis">N<sub>b</sub></span> &lt; 7). When we've processed all the old octets, we've completed the round (including the following <img src="U2295.GIF" border="0" />).</p><blockquote><p class="docFootnote"><sup><a name="ch03fn03">[*]</a></sup> Think of the columns as residing on an upright cylinderÂthe rightmost column is immediately to the left of the leftmost.</p></blockquote>
<p class="docText">The last round is a little different. We initialize the new state to the round key. For each octet in the old state, we apply the S-Box by table-lookup and <img src="U2295.GIF" border="0" /> the result into the appropriate octet of the new state. The destination octet is in the same row as the source octet, and its column depends on the source row and column in the same manner as for the other rounds.</p>
<p class="docText">The inverse rounds can be optimized in the same manner (with <span class="docEmphasis">left</span> replaced by <span class="docEmphasis">right</span>).</p>
<a href="15051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch03lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch03lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>