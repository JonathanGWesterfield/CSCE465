<html><head><title>20.14. Annoying Text Format Issues</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch20lev1sec13.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch20lev1sec15.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch20lev1sec14"></a>
<h3 id="title-IDA2PAMZ" class="docSection1Title">20.14. Annoying Text Format Issues</h3>
<p class="docText">There is unfortunately no single standard for text representation. Some systems have &lt;LF&gt; (line feed, ASCII 10) as the line delimiter. Others have &lt;CR&gt; (carriage return, ASCII 13). Others have &lt;CR&gt;&lt;LF&gt; (&lt;CR&gt; followed by &lt;LF&gt;). Some systems have line-length limitations. Others happily wrap lines. Some systems expect parity on the high-order bit of each octet. Others get upset if the high-order bit is on. Still others don't get upset, but calmly clear the bit. Some systems don't even use ASCII, but use some other encoding for characters, such as <span class="docEmphRoman"><a class="docLink" href="app02.html#gloss01_079">EBCDIC</a></span>.</p>
<p class="docText"><a name="iddle1138"></a><a name="iddle2014"></a>When sending a text message to someone on another system, we'd like the message to appear to the human on the other end about the way it looked to the human who sent it. This is a messy, boring problem. Your system can't really know what the conventions are at the remote site, and the destination might have difficulties translating appropriately because it would not know what the conventions were at the source. The usual method of solving problems like these is to define a canonical format. The data is translated at the source into canonical format, and at the destination out of canonical format into local format. This way, each system only needs to know how to convert its local format to and from canonical format (as opposed to needing to know how to convert its local format to and from each other possible format).</p>
<p class="docText">Unfortunately, there is no single standard canonical format. SMTP (Simple Mail Transport Protocol, RFC 821) is a standard for Internet mail. The companion RFC 822 defines a canonical format that uses &lt;CR&gt;&lt;LF&gt; as the line delimiter. But there are non-SMTP mail systems, and messages can get modified in non-reversible ways as messages pass through various sorts of gateways. For instance, some mail gateways remove white space at the ends of lines (spaces immediately preceding the end of the line), add line breaks to lines that seem too long to fit on a screen, or turn the tab character into five spaces.</p>
<p class="docText">These sorts of transformations are mostly harmless when trying to send simple text messages from one user to another across diverse systems, but it causes problems when trying to send arbitrary data between systems. Certainly if you're trying to send arbitrary binary data, having all your high-order bits cleared or having &lt;CR&gt;&lt;LF&gt; inserted periodically will hopelessly mangle the data. But even if you are sending text, security features can get broken by mail gateways diddling with the data. For instance, a digital signature will no longer verify if any of the message is modified. It's difficult to predict exactly what kinds of modifications an arbitrary mail gateway will make to your file in its attempt to be helpful.</p>
<p class="docText">Mail is not the only application which has this problem. File transfer also has the problem. It would be easy just to send the bits in a file and have them appear at the destination machine exactly as they were at the source machine, but that is often not what is wanted. Because of the different representations for text, a text file might not display intelligibly on a different system. (And of course there are other problems besides displaying text. A floating point number is represented differently on different machines. Maybe you'd even like your executable code to run on a different machine!) Most file transfer protocols give you the choice of whether you are sending binary data (in which case it won't muck with your data) or text (in which case it will attempt to do transformations on the data so that it will display properly).</p>
<p class="docText">SMTP made the assumption that the only thing anyone would ever want to mail was text, so there is no capability of sending arbitrary data. The mail infrastructure is always allowed to play around with your data in an attempt to be helpful.</p>
<a name="ch20lev2sec12"></a>
<h4 id="title-IDAORAMZ" class="docSection2Title">20.14.1. Disguising Data as Text</h4>
<p class="docText"><a name="iddle1329"></a><a name="iddle2109"></a><a name="iddle2117"></a><a name="iddle2118"></a>People have long wanted to mail types of data other than simple text (for instance, diagrams, voice, pictures, or even text in languages with large character sets), and they have done so by coming up with an encoding that will pass through all known maulers ;-). The classic way UNIX systems did this was to run a program called <i><a class="docLink" href="app02.html#gloss01_238">uuencode</a></i> on the data, mail the result, and have the recipient <i><a class="docLink" href="app02.html#gloss01_237">uudecode</a></i> it. The encoding process accepts arbitrary octet strings and produces strings containing only &quot;safe&quot; characters with an occasional end-of-line delimiter to keep the mailers happy. There are obviously fewer than 256 safe values for an octet (otherwise, arbitrary binary data would work just fine). It turns out there are at least 64 safe characters, but not much more than that, so the encoding packs 6 bits of information into each character, by translating each of the possible values of the 6 bits into one of the safe characters, and adding &lt;CR&gt;&lt;LF&gt; sufficiently often. This encoding expands the information by about 33%.</p>
<p class="docText">S/MIME, PEM, and PGP make the assumption that they have to work with a mail system such as SMTP that will assume their data is text, so they both have a convention similar to uuencode/uudecode for packing and unpacking 6 bits into a character. We will use the term <span class="docEmphStrong">encode</span> to mean any similar mechanism, even if it isn't exactly the transformation that the UNIX utility provides. X.400 has a method of transmitting data unmodified, so it does not need to do this.</p>
<p class="docText">So there are two transformations of data. One is canonicalization, which is minor diddling such as changing the end-of-line character into &lt;CR&gt;&lt;LF&gt;. The other is encoding, which is packing 6 bits per character, thereby making the data completely unintelligible to humans and expanding it by about 33%.</p>
<p class="docText">There is a troublesome consequence of encoding, in that you can't always assume that the recipient of the mail message has S/MIME, PEM or PGP. The recipient might have to read the message with an ordinary mail program. Obviously they would not be able to read an encrypted message with an ordinary mail program, but you'd want them to be able to read a message that is unencrypted but integrity-protected.</p>
<p class="docText">Suppose Alice sends the message <span class="docEmphRomanAlt">Bob, your terminal is about to explode. You'd better quickly run out of your office.</span> She decides to use PEM so that it will add an integrity check to the message, since she <span class="docEmphasis">really cares</span> that Bob gets the message without it getting garbled. PEM helpfully reformats the message so that it now looks like:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PRIVACY-ENHANCED MESSAGE-----</span>
<span class="docEmphStrong">Proc-Type: 4,MIC-ONLY</span>
<span class="docEmphStrong">Originator-ID-Asymmetric: MEMxCzAJBgNVBAYTAlVTMSYwJAYDVQQKEx1EaWd</span>
 <span class="docEmphStrong">pdGFsIEVxdWlwbWVudCBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDTEtH,05</span>
<span class="docEmphStrong">MIC-Info: RSA-MD5,RSA,ZHiLe5DJdd4fE1/w++csvPbpFG9K9PWkPwU3fSLh9I+</span>
 <span class="docEmphStrong">ZNyFdZ7pBk1zPvXrya5+14XQcwIcb3Dcqk2RbnyzWzQ==</span>

<span class="docEmphStrong">Qm9iLCB5b3VyIHRlcm1pbmFsIGlzIGFib3V0IHRvDQpleHBsb2RlLiAgWW91J2Qg</span>
<span class="docEmphStrong">YmV0dGVyIHF1aWNrbHkgcnVuIG91dCBvZiB5b3VyIG9mZmljZS4NCg==</span>
<span class="docEmphStrong">-----END PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText"><a name="iddle1235"></a>The first five lines of cybercrud include information like the integrity check. The actual message is the bottom two lines:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Qm9iLCB5b3VyIHRlcm1pbmFsIGlzIGFib3V0IHRvDQpleHBsb2RlLiAgWW91J2Qg</span>
<span class="docEmphStrong">YmV0dGVyIHF1aWNrbHkgcnVuIG91dCBvZiB5b3VyIG9mZmljZS4NCg==</span></pre></div><br />
<p class="docText">Suppose Bob's mail program has not yet implemented PEM. It is reasonable to expect him to have problems understanding an encrypted message, but Alice did not encrypt the message. She merely requested an integrity check be added to the message. But PEM had to reformat the data, because the integrity check would fail if the text was modified in any way. The human Bob will have trouble processing</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">Qm9iLCB5b3VyIHRlcm1pbmFsIGlzIGFib3V0IHRvDQpleHBsb2RlLiAgWW91J2Qg</span>
<span class="docEmphStrong">YmV0dGVyIHF1aWNrbHkgcnVuIG91dCBvZiB5b3VyIG9mZmljZS4NCg==</span></pre></div><br />
<p class="docText">It's not encryptedÂit is easy to turn it back into human-readable text, if there is a utility at Bob's node to do this. Without such a utility, Bob will probably take longer than is prudent (given the contents of Alice's message) to read the message.</p>
<p class="docText">Because of this problem, S/MIME, PEM, and PGP have the capability of sending something without modification. When you use that mode, they will not modify the message. It's your problem if mail gateways modify the message and the integrity check no longer matches. The programs add an integrity check without encoding the message. The message would then look like this:</p>
<div class="docText"><pre>90</pre></div><br /><div class="docText"><pre><span class="docEmphStrong">-----BEGIN PRIVACY-ENHANCED MESSAGE-----</span>
<span class="docEmphStrong">Proc-Type: 4,MIC-CLEAR</span>
<span class="docEmphStrong">Originator-ID-Asymmetric: MEMxCzAJBgNVBAYTAlVTMSYwJAYDVQQKEx1EaWd</span>
 <span class="docEmphStrong">pdGFsIEVxdWlwbWVudCBDb3Jwb3JhdGlvbjEMMAoGA1UECxMDTEtH,05</span>
<span class="docEmphStrong">MIC-Info: RSA-MD5,RSA,ZHiLe5DJdd4fE1/w++csvPbpFG9K9PWkPwU3fSLh9I+</span>
 <span class="docEmphStrong">ZNyFdZ7pBk1zPvXrya5+14XQcwIcb3Dcqk2RbnyzWzQ==</span>
<span class="docEmphStrong">Bob, your terminal is about to explode. You'd better quickly run out of</span>
<span class="docEmphStrong">your office</span>
<span class="docEmphStrong">-----END PRIVACY-ENHANCED MESSAGE-----</span></pre></div><br />
<p class="docText">If Alice sends her message to Bob in this mode using something like PEM, then it is possible that she'll be lucky and one of the following will be true:</p>
<ul><li><p class="docList">The message happens to be encoded in a way which no mail utility en route will feel obliged to modify. Bob's mailer has PEM and the integrity check will succeed.</p></li><li><p class="docList"><a name="iddle1014"></a><a name="iddle1674"></a>Bob's mailer does not have PEM, and the message does not get maliciously corrupted en route by some third party Carol. What Bob sees is the actual text of the message, plus some cybercrud for the signature and so on, which he ignores.</p></li></ul>
<p class="docText">It is possible that she'll be unlucky (or rather, Bob will be unlucky in this case) and one of the following will happen:</p>
<ul><li><p class="docList">Bob's mail has PEM, and the message gets modified by a helpful mail utility in a &quot;harmless&quot; sort of way. The integrity check fails and Bob ignores the message.</p></li><li><p class="docList">Bob's mailer does not have PEM, and bad-guy Carol modifies the message en route into something like, <span class="docEmphRomanAlt">Are you still free for tennis today after work?</span></p></li></ul>
<p class="docText">In either case, Bob gets blown to bits.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch20lev1sec13.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch20lev1sec15.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>