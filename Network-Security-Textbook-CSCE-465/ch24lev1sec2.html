<html><head><title>24.2. NetWare V4</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch24lev1sec1.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch24lev1sec3.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch24lev1sec2"></a>
<h3 id="title-IDAVITZK" class="docSection1Title">24.2. NetWare V4</h3>
<p class="docText">There were two major reasons for modifying security in Version 4 of NetWare. The first was to utilize public key cryptography, which has the potential to make theft of the server database less of a security issue. The other was to simplify management. Instead of having a database entry for Alice separately managed at each server Alice is authorized to use, NetWare Directory Services (NDS) stores Alice's security information, and servers retrieve the information from NDS.</p>
<p class="docText">Each user has an RSA key, but of course the user does not remember that. The user remembers a password. NDS stores Alice's private key encrypted with her password. To prevent off-line password guessing, Alice's workstation must prove knowledge of her password before NDS will transmit her encrypted private key. The pre-authentication phase, where her workstation proves it knows her password, is similar to NetWare V3. NDS stores a hash of Alice's password and salt. In V3 we said the salt was useful because it made the hash of Alice's password different on different servers. That case does not apply for V4 since Alice's entry is only stored in one placeÂNetWare Directory Services. But the salt is still useful, since it means that an intruder who reads the directory service database has to conduct separate dictionary attacks against each account.</p>
<p class="docText">First Alice logs into the workstation by typing her name and password. The workstation then authenticates on Alice's behalf to NDS in order to obtain Alice's private key. For security as well as performance, once the workstation acquires Alice's private key from NDS, it converts it into a temporary Gillou-Quisquater (GQ) key (see &sect;<a class="docLink" href="#ch24lev2sec1">24.2.1</a> <span class="docEmphasis">NetWare's Guillou-Quisquater Authentication Scheme</span>) and then forgets her password and private RSA key.</p>
<p class="docText">Authentication with GQ is public key authentication, but there are two important differences from authenticating with RSA.</p>
<ul><li><p class="docList">A private RSA key lasts forever. A GQ key, as NetWare uses it, expiresÂthe workstation determines when the GQ key should expire when it creates the GQ key from the RSA key. If some untrustworthy software steals Alice's password or private RSA key, it can impersonate her forever (or until she notices what has happened and changes her long-term private key). Conversion to a GQ key limits the amount of time in which damage can be done. Note that this is the same reasoning that led the Kerberos designers to introduce the concept of a TGT and session key for the user rather than using the user's master key throughout a session.</p></li><li><p class="docList">GQ authentication is faster than RSA for the client (Alice, the thing proving her identity) but slower for the server (Bob, the thing authenticating Alice). The NetWare designers envisioned slow PCs for clients and fast PCs for servers.</p></li></ul>
<p class="docText">NetWare could have implemented the conversion of the long-term secret into a short-term secret differently. Rather than generate a GQ key pair, the workstation could choose a new RSA key pair, generate a certificate for it by signing it with the user's long-term private RSA key, and then forget the user's long-term secret. That is what DASS does, as we'll see in &sect;<a class="docLink" href="ch24lev1sec4.html#ch24lev1sec4">24.4</a> <span class="docEmphasis">DASS/SPX</span>. But generating a temporary GQ key is much faster than generating an RSA key, so the NetWare scheme has higher performance during login.</p>
<p class="docText">Once the workstation has acquired a GQ key for Alice, it stores it for the duration of her session and uses it to authenticate on her behalf to any servers she accesses during her session.</p>
<p class="docText">If Alice asks to log into server Bob, then Bob must retrieve Alice's public RSA key from NDS. Alice's temporary GQ key works with her permanent public RSA key, in the sense that a signature generated with her temporary GQ key is verified using her permanent public RSA key.</p>
<p class="docText">To summarize, the information stored for Alice in NDS includes</p>
<a name="ch24fig02"></a><p><center>
<h5 class="docFigureTitle">Figure 24-3. NetWare V4 NDS Database Entry for Alice</h5>
</center></p><p class="docText">
<img border="0" alt="" width="500" height="122" src="24fig03.jpg" /></p>
<br />
<p class="docText">Here is the protocol in which Alice's workstation obtains her encrypted private RSA key from NDS:</p>
<a name="ch24fig03"></a><p><center>
<h5 class="docFigureTitle">Figure 24-4. NetWare V4 Pre-authentication</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="24fig04_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="232" src="24fig04.jpg" /></p>
<br />
<p class="docText">First Alice logs in and her workstation communicates with NDS in order to obtain her private RSA key, which her workstation will use to generate a finite-lifetime GQ key for her:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Alice types her name and password to her workstation.</p></div></li><li><div style="font-weight:normal"><p class="docList">The workstation uses that information to authenticate Alice on her behalf to NDS, in an authentication exchange nearly identical to NetWare V3, except for the final message of the pre-authentication. The final message in V3 consists simply of <span class="docEmphasis">Y</span>, which is hash(<span class="docEmphasis">X</span>,<span class="docEmphasis">R</span>), where <span class="docEmphasis">R</span> is the challenge transmitted by the server. In V4, in addition to transmitting <span class="docEmphasis">Y</span>, the workstation <a name="iddle1410"></a><a name="iddle2001"></a>transmits a large random number <span class="docEmphasis">R</span><sub>2</sub> (chosen by the workstation), which will be used by NDS for concealing NDS's reply to the workstation from eavesdroppers. The entire message (<span class="docEmphasis">Y</span> and the random number <span class="docEmphasis">R</span><sub>2</sub>) is encrypted with the NDS's public key. Encrypting the message with NDS's public key means that an eavesdropper cannot use <span class="docEmphasis">Y</span> and <span class="docEmphasis">R</span> to verify password guesses off-line (as it could in V3).</p></div></li><li><div style="font-weight:normal"><p class="docList">Once NDS is assured that the workstation knows Alice's password, NDS transmits Alice's encrypted private RSA key to the workstation. To prevent off-line password guessing by eavesdroppers, the encrypted private RSA key is <img src="U2295.GIF" border="0" />'d with the random number <span class="docEmphasis">R</span><sub>2</sub> sent in the previous step, and then encrypted with <span class="docEmphasis">Y</span>.</p></div></li><li><div style="font-weight:normal"><p class="docList">The workstation decrypts Alice's private RSA key. It immediately turns it into a GQ key with an expiration time, and then forgets the password and private RSA key.</p></div></li></ol></div>
<p class="docText">Here is what occurs when Alice accesses a network resource, say a server named Bob.</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">Alice asks to log into Bob.</p></div></li><li><div style="font-weight:normal"><p class="docList">Bob obtains Alice's public key from NDS.</p></div></li><li><div style="font-weight:normal"><p class="docList">Alice is authenticated in a public key authentication handshake in which the workstation uses Alice's GQ key and Bob uses her public RSA key.</p></div></li><li><div style="font-weight:normal"><p class="docList">A session key is also established as part of the authentication handshake between the workstation and Bob, and that session key is used to integrity-protect the initial portion of each of the packets of the Alice-Bob exchange (just like in V3).</p></div></li></ol></div>
<a name="ch24lev2sec1"></a>
<h4 id="title-IDAXOTZK" class="docSection2Title">24.2.1. NetWare's Guillou-Quisquater Authentication Scheme</h4>
<p class="docText">NetWare V4 authentication is not based on RSA, but rather on a variant of an algorithm by Guillou and Quisquater. We'll call NetWare's variant <span class="docEmphStrong">GQ</span>. GQ requires that each user have an RSA key pair. The user's private RSA key is used to generate a private GQ key with a temporary lifetime. Then the workstation forgets the user's private RSA key, and future authentication is done using only the GQ key and the user's public RSA key. The GQ key can only do signatures (it can't encrypt or decrypt). Signature verification uses the public RSA key.</p>
<p class="docText">This is how the workstation acquires a private GQ key for the user:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">The workstation acquires the user's private RSA key.</p></div></li><li><div style="font-weight:normal"><p class="docList">The workstation generates a message, <span class="docEmphasis">m</span><sub>0</sub>, which includes the validity interval for the GQ key it is about to create.</p></div></li><li><div style="font-weight:normal"><p class="docList">The workstation signs <span class="docEmphasis">m</span><sub>0</sub> with the user's private RSA key. This signature of <span class="docEmphasis">m</span><sub>0</sub> is the user's private GQ key, <span class="docEmphasis">Q</span>. The workstation must not divulge this quantity.</p></div></li><li><div style="font-weight:normal"><p class="docList">The workstation forgets the user's private RSA key, but remembers <span class="docEmphasis">m</span><sub>0</sub> (which is used, together with the user's public RSA key, to verify a GQ signature) and <span class="docEmphasis">Q</span> (the RSA signature on <span class="docEmphasis">m</span><sub>0</sub>).</p></div></li></ol></div>
<p class="docText">This is how the GQ key is used to sign a message:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">To sign a message, say <span class="docEmphasis">m</span>, the workstation needs to know <span class="docEmphasis">Q</span>, <span class="docEmphasis">m</span>, and the user's public RSA key. These quantities are all fed into a magic function that outputs a signature. As used by NetWare, <span class="docEmphasis">m</span> is the challenge supplied by the server.</p></div></li><li><div style="font-weight:normal"><p class="docList">The signature verification function requires as input <span class="docEmphasis">m</span>, the signature on <span class="docEmphasis">m</span>, <span class="docEmphasis">m</span><sub>0</sub>, and the user's public RSA key. With these inputs, the signature verification function decides whether or not the signature is valid.</p></div></li></ol></div>
<p class="docText">The mathematics involved are ugly and unintuitive, but we'll document them here for completeness. We'll describe the mechanics, but to understand why it's secure, you should read [<a class="docLink" href="biblio01.html#biblio01_073">GUIL88</a>].</p>
<ul><li><p class="docList">The user's RSA key pair is &lt;<span class="docEmphasis">e</span>,<span class="docEmphasis">n</span>&gt; for the public key, and &lt;<span class="docEmphasis">d</span>,<span class="docEmphasis">n</span>&gt; for the private key.</p></li><li><p class="docList"><span class="docEmphasis">Q</span> = <span class="docEmphasis">m</span><sub>0</sub><span class="docEmphasis"><sup>d</sup></span> mod <span class="docEmphasis">n</span> is the RSA signature on <span class="docEmphasis">m</span><sub>0</sub>.</p></li></ul>
<p class="docText">To sign a message <span class="docEmphasis">m</span>, do the following:</p>
<a name="ch24pro01"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Generate eight random numbers <span class="docEmphasis">r</span><sub>1</sub>,...<span class="docEmphasis">r</span><sub>8</sub> in the range [2, <span class="docEmphasis">n</span>-2].<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Compute eight quantities <span class="docEmphasis">x</span><sub>1</sub>,...<span class="docEmphasis">x</span><sub>8</sub>, where 

<img border="0" alt="" width="60" height="23" src="601equ01.jpg" />


 mod <span class="docEmphasis">n</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Compute MD4(<span class="docEmphasis">m</span>|<span class="docEmphasis">x</span><sub>1</sub>|<span class="docEmphasis">x</span><sub>2</sub>|...|<span class="docEmphasis">x</span><sub>8</sub>).<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText">Break the 128-bit message digest computed in the previous step into 8 16-bit quantities and call the pieces <span class="docEmphasis">c</span><sub>1</sub>,...<span class="docEmphasis">c</span><sub>8</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Compute eight quantities <span class="docEmphasis">y</span><sub>1</sub>,...<span class="docEmphasis">y</span><sub>8</sub>, where 

<img border="0" alt="" width="80" height="22" src="601equ02.jpg" />


 mod <span class="docEmphasis">n</span>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>6. </b></div></td><td><div class="docText">The GQ signature of <span class="docEmphasis">m</span> consists of <span class="docEmphasis">x</span><sub>1</sub>,...<span class="docEmphasis">x</span><sub>8</sub>, and <span class="docEmphasis">y</span><sub>1</sub>,...<span class="docEmphasis">y</span><sub>8</sub>.<br /><br /></div></td></tr></table>
<p class="docText">To verify the GQ signature of <span class="docEmphasis">m</span>, do the following:</p>
<a name="ch24pro02"></a>
<table border="0" class="docText"><tr><td width="25" valign="top"><div class="docText"><b>1. </b></div></td><td><div class="docText">Receive <span class="docEmphasis">m</span><sub>0</sub>, <span class="docEmphasis">m</span>, <span class="docEmphasis">x</span><sub>1</sub>,...<span class="docEmphasis">x</span><sub>8</sub>, and <span class="docEmphasis">y</span><sub>1</sub>,...<span class="docEmphasis">y</span><sub>8</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>2. </b></div></td><td><div class="docText">Reliably find the user's public key &lt;<span class="docEmphasis">e</span>,<span class="docEmphasis">n</span>&gt;.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>3. </b></div></td><td><div class="docText">Compute MD4(<span class="docEmphasis">m</span>|<span class="docEmphasis">x</span><sub>1</sub>|<span class="docEmphasis">x</span><sub>2</sub>|...|<span class="docEmphasis">x</span><sub>8</sub>).<br /><br /></div></td></tr><tr><td></td><td></td></tr><tr><td width="25" valign="top"><div class="docText"><b>4. </b></div></td><td><div class="docText"><a name="iddle1032"></a><a name="iddle1085"></a><a name="iddle1294"></a><a name="iddle1442"></a><a name="iddle1523"></a><a name="iddle1554"></a><a name="iddle1686"></a><a name="iddle1694"></a>Break the 128-bit message digest computed in the previous step into 8 16-bit quantities and call the pieces <span class="docEmphasis">c</span><sub>1</sub>,...<span class="docEmphasis">c</span><sub>8</sub>.<br /><br /></div></td></tr><tr><td width="25" valign="top"><div class="docText"><b>5. </b></div></td><td><div class="docText">Accept the signature if for each <span class="docEmphasis">i</span>, 

<img border="0" alt="" width="100" height="23" src="602equ01.jpg" />


 mod <span class="docEmphasis">n</span>.<br /><br /></div></td></tr></table>
<p class="docText">Why does this work?</p>
<p><table cellspacing="0" frame="void" rules="none" cellpadding="5"><colgroup align="left" span="1"><col width="550"></col></colgroup><thead></thead><tr><td class="docTableCell" align="left" valign="top"><p class="docText">
<img border="0" alt="" width="80" height="22" src="602equ02.jpg" />


 mod <span class="docEmphasis">n</span> (this is how <span class="docEmphasis">y<sub>i</sub></span> got computed in the signing algorithm)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">
<img border="0" alt="" width="200" height="22" src="602equ03.jpg" />


 mod <span class="docEmphasis">n</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">
<img border="0" alt="" width="60" height="24" src="602equ04.jpg" />


 mod <span class="docEmphasis">n</span> (this is how <span class="docEmphasis">x<sub>i</sub></span> got computed in the signing algorithm)</p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">
<img border="0" alt="" width="60" height="23" src="602equ05.jpg" />


 mod <span class="docEmphasis">n</span>, so <span class="docEmphasis">Q<sup>e</sup></span> = <span class="docEmphasis">m</span><sub>0</sub> mod <span class="docEmphasis">n</span></p></td></tr><tr><td class="docTableCell" align="left" valign="top"><p class="docText">
<img border="0" alt="" width="300" height="25" src="602equ06.jpg" />


 mod <span class="docEmphasis">n</span>, which is what is being tested</p></td></tr></table></p><br />
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch24lev1sec1.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch24lev1sec3.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>