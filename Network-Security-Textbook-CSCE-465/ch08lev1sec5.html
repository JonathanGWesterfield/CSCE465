<html><head><title>8.5. Mathematics of Rijndael</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch08lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch08lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch08lev1sec5"></a>
<h3 id="title-IDA4JN1X" class="docSection1Title">8.5. Mathematics of Rijndael</h3>
<p class="docText">Rijndael is based on arithmetic in GF(2<sup>8</sup>). The nice thing about this is that each element of the field can be represented by an octet. The bits in this octet are the coefficients of a polynomial over <span class="docEmphStrong">Z</span><sub>2</sub> modulo the irreducible <span class="docEmphStrong">Z</span><sub>2</sub> polynomial <span class="docEmphasis">m</span>(<span class="docEmphasis">x</span>) = <span class="docEmphasis">x</span><sup>8</sup> + <span class="docEmphasis">x</span><sup>4</sup> + <span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphasis">x</span> + 1 (see <a class="docLink" href="ch08lev1sec7.html#ch08qa1q10">Homework Problem 10</a>), with the least significant bit being the coefficient of 1 and the most significant bit the coefficient of <span class="docEmphasis">x</span><sup>7</sup>. Addition in this representation is just bitwise <img src="U2295.GIF" border="0" />, since addition modulo 2 is the same as <img src="U2295.GIF" border="0" />. Also note that each element is its own negation. Multiplicative inverse is most easily done by table <a name="iddle1477"></a><a name="iddle1660"></a><a name="iddle1950"></a>lookup. The multiplicative inverse table has only 256 1-octet entries (well really 255, since <span class="docEmphRomanAlt">0</span> doesn't have an inverse). (See <a class="docLink" href="ch08lev1sec7.html#ch08qa1q11">Homework Problem 11</a>.) A multiplication table would have 65536 1-octet entriesÂone entry per pair of octets. Fortunately, Rijndael only requires multiplication by six different constants (elements of GF(2<sup>8</sup>)) not counting <span class="docEmphRomanAlt">0</span> and <span class="docEmphRomanAlt">1</span>. Rijndael key expansion uses a sequence of constants <span class="docEmphasis">C<sub>i</sub></span> tabulated in <a class="docLink" href="ch03lev1sec5.html#ch03tab01">Figure 3-31</a>; these are obtained by the formula <span class="docEmphasis">C<sub>i</sub></span> = <span class="docEmphasis">x</span><sup><span class="docEmphasis">i</span>-1</sup> mod <span class="docEmphasis">m</span>(<span class="docEmphasis">x</span>). (See <a class="docLink" href="ch08lev1sec7.html#ch08qa1q14">Homework Problem 14</a>.)</p>
<p class="docText">Rijndael also uses polynomials over GF(2<sup>8</sup>). These polynomials are taken modulo the GF(2<sup>8</sup>) polynomial <span class="docEmphasis">x</span><sup>4</sup> + 1. These polynomials are represented as 4-vectors of octets, with the coefficient of 1 being the first octet in the 4-vector. With this representation, multiplication by <span class="docEmphasis">x</span> is just a rotation, with the last octet becoming the first. Rijndael's <span class="docEmphasis">MixColumn</span> operation is multiplication by the fixed polynomial <span class="docEmphasis">c</span>(<span class="docEmphasis">x</span>) = <span class="docEmphRomanAlt">03</span><span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphRomanAlt">01</span><span class="docEmphasis">x</span><sup>2</sup> + <span class="docEmphRomanAlt">01</span><span class="docEmphasis">x</span> + <span class="docEmphRomanAlt">02</span>, which we'll call the <span class="docEmphStrong">MixColumn polynomial</span>. <span class="docEmphasis">InvMix-Column</span> is multiplication by <span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>) = <span class="docEmphRomanAlt">0B</span><span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphRomanAlt">0D</span><span class="docEmphasis">x</span><sup>2</sup> + <span class="docEmphRomanAlt">09</span><span class="docEmphasis">x</span> + <span class="docEmphRomanAlt">0E</span>, which we may as well call the <span class="docEmphStrong">Inv-MixColumn polynomial</span>. (See <a class="docLink" href="ch08lev1sec7.html#ch08qa1q13">Homework Problem 13</a>.)</p>
<p class="docText">Finally, for one of the operations composing its S-box, Rijndael treats octets as polynomials over <span class="docEmphStrong">Z</span><sub>2</sub> modulo the non-irreducible <span class="docEmphStrong">Z</span><sub>2</sub> polynomial <span class="docEmphasis">x</span><sup>8</sup> + 1, again with the least significant bit being the coefficient of 1 and the most significant bit the coefficient of <span class="docEmphasis">x</span><sup>7</sup>. This S-box component consists of multiplying by <span class="docEmphasis">x</span><sup>4</sup> + <span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphasis">x</span><sup>2</sup> + <span class="docEmphasis">x</span> + 1 and then adding <span class="docEmphasis">x</span><sup>6</sup> + <span class="docEmphasis">x</span><sup>5</sup> + <span class="docEmphasis">x</span> + 1. Its inverse consists of multiplying by <span class="docEmphasis">x</span><sup>6</sup> + <span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphasis">x</span> and then adding <span class="docEmphasis">x</span><sup>2</sup> + 1. (See <a class="docLink" href="ch08lev1sec7.html#ch08qa1q12">Homework Problem 12</a>.)</p>
<p class="docText">In fact, Rijndael's S-box is composed of a sequence of three invertible operations in which octets are interpreted as <span class="docEmphStrong">Z</span><sub>2</sub> polynomials:</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">a permutation in which each octet maps to its multiplicative inverse mod <span class="docEmphasis">m</span>(<span class="docEmphasis">x</span>) (except for <span class="docEmphRomanAlt">0</span> which maps to itself)</p></div></li><li><div style="font-weight:normal"><p class="docList">multiplication by <span class="docEmphasis">x</span><sup>4</sup> + <span class="docEmphasis">x</span><sup>3</sup> + <span class="docEmphasis">x</span><sup>2</sup> + <span class="docEmphasis">x</span> + 1 mod <span class="docEmphasis">x</span><sup>8</sup> + 1</p></div></li><li><div style="font-weight:normal"><p class="docList">addition of <span class="docEmphasis">x</span><sup>6</sup> + <span class="docEmphasis">x</span><sup>5</sup> + <span class="docEmphasis">x</span> + 1</p></div></li></ol></div>
<p class="docText">Rijndael's <span class="docEmphasis">MixColumn</span> is just multiplication by the MixColumn polynomial <span class="docEmphasis">c</span>(<span class="docEmphasis">x</span>) mod <span class="docEmphasis">x</span><sup>4</sup> + 1, and its inverse is just multiplication by the InvMixColumn polynomial <span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>) mod <span class="docEmphasis">x</span><sup>4</sup> + 1.</p>
<p class="docText">The rotation of the columns performed in Rijndael's key expansion can be thought of as multiplication by <span class="docEmphasis">x</span><sup>3</sup> mod <span class="docEmphasis">x</span><sup>4</sup> + 1.</p>
<a name="ch08lev2sec3"></a>
<h4 id="title-IDA2UN1X" class="docSection2Title">8.5.1. A Rijndael Round</h4>
<p class="docText">The actual description of a Rijndael round, as found in the spec, is as follows. Recall that each round operates on a state consisting of <span class="docEmphasis">N<sub>b</sub></span> 4-octet columns.</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">The S-box is applied to each octet in the state.</p></div></li><li><div style="font-weight:normal"><p class="docList">Row 0 (the top row) of the state is left alone.</p><p class="docList">Row 1 of the state is rotated left 1 column.</p><p class="docList">Row 2 of the state is rotated left 2+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/8<sub><img src="U230B.GIF" border="0" /></sub> columns (2 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 8, 3 otherwise).</p><p class="docList">Row 3 of the state is rotated left 3+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/7<sub><img src="U230B.GIF" border="0" /></sub> columns (3 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 7, 4 otherwise).</p></div></li><li><div style="font-weight:normal"><p class="docList"><span class="docEmphasis">MixColumn</span> is applied to each column.</p></div></li><li><div style="font-weight:normal"><p class="docList">The round key is <img src="U2295.GIF" border="0" />'d into the state.</p></div></li></ol></div>
<p class="docText">We can think of the initial <img src="U2295.GIF" border="0" /> as an initial round (round 0) which only has step 4. The final round (round <span class="docEmphasis">N<sub>r</sub></span>) is missing step 3.</p>
<p class="docText">You might think that the inverse of encryption would just run encryption backwards, with each operation replaced by its inverse. And this, of course, works fine. But by regrouping and reordering the operations, decryption can look much more like encryption. The key observations for this are that steps 1 and 2 can be exchanged without changing the result, and that <span class="docEmphasis">InvMixColumn</span> is polynomial multiplication, and so it distributes over addition (<img src="U2295.GIF" border="0" />): if <span class="docEmphasis">s</span>(<span class="docEmphasis">x</span>) is a column of the state, and <span class="docEmphasis">k</span>(<span class="docEmphasis">x</span>) is the corresponding column of the round key, and <span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>) is the InvMixColumn polynomial, then (<span class="docEmphasis">s</span>(<span class="docEmphasis">x</span>) <img src="U2295.GIF" border="0" /> <span class="docEmphasis">k</span>(<span class="docEmphasis">x</span>))&#183;<span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>) = <span class="docEmphasis">s</span>(<span class="docEmphasis">x</span>)<span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>) <img src="U2295.GIF" border="0" /> <span class="docEmphasis">k</span>(<span class="docEmphasis">x</span>)<span class="docEmphasis">d</span>(<span class="docEmphasis">x</span>), and of course this stays true mod <span class="docEmphasis">x</span><sup>4</sup> + 1.</p>
<p class="docText">So if we group steps 3 and 4 from one round with steps 1 and 2 from the next, then interchange steps 1 and 2, and interchange steps 3 and 4 by applying <span class="docEmphasis">InvMixColumn</span> to each column of the round key, then, when we run this backwards with the operations inverted, we get the following description of an inverse round.</p>
<div style="font-weight:bold"><ol class="docList" type="1"><li><div style="font-weight:normal"><p class="docList">The Inverse S-box is applied to each octet in the state.</p></div></li><li><div style="font-weight:normal"><p class="docList">Row 0 (the top row) of the state is left alone.</p><p class="docList">Row 1 of the state is rotated right 1 octet.</p><p class="docList">Row 2 of the state is rotated right 2+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/8<sub><img src="U230B.GIF" border="0" /></sub> columns (2 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 8, 3 otherwise).</p><p class="docList">Row 3 of the state is rotated right 3+<sub><img src="U230A.GIF" border="0" /></sub><span class="docEmphasis">N<sub>b</sub></span>/7<sub><img src="U230B.GIF" border="0" /></sub> columns (3 if <span class="docEmphasis">N<sub>b</sub></span> &lt; 7, 4 otherwise).</p></div></li><li><div style="font-weight:normal"><p class="docList"><span class="docEmphasis">InvMixColumn</span> is applied to each column.</p></div></li><li><div style="font-weight:normal"><p class="docList">The (modified) round key is <img src="U2295.GIF" border="0" />'d into the state.</p></div></li></ol></div>
<p class="docText">This is the way decryption rounds 1 through <span class="docEmphasis">N<sub>r</sub></span>-1 work. Decryption round 0 is just the inverse of step 4 from encryption round <span class="docEmphasis">N<sub>r</sub></span> (remember that there is no step 3 in that roundÂnow you know why), namely <img src="U2295.GIF" border="0" /> of the (unmodified) round key. Decryption round <span class="docEmphasis">N<sub>r</sub></span> is the inverse of step 4 (the only step) of encryption round 0 followed by steps 1 and 2 from encryption round 1. So it is missing inverse step 3 (there's the other side of the reason for the final round being the way it is), and its round key is unmodified (i.e. it's just encryption round key 0).</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch08lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch08lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>