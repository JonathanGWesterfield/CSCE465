<html><head><title>25.5. Cookies</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="16051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch25lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch25lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch25lev1sec5"></a>
<h3 id="643999-966" class="docSection1Title">25.5. Cookies</h3>
<p class="docText">If the client is browsing content that requires authentication and access control, or is accumulating information such as items in a virtual shopping basket to be purchased when the user is finished browsing the on-line catalog, the information for that session really needs to be kept somewhere. But HTTP is stateless. Each request/response interaction is allowed to take place over a fresh TCP connection. The <b><a class="docLink" href="app02.html#gloss01_053">cookie</a></b> mechanism enables the server to maintain context across many request/ response interactions. A cookie is a data structure created by the server and stored at the client.</p>
<a name="ch25lev2sec1"></a>
<h4 id="title-IDAWO5NM" class="docSection2Title">25.5.1. Alternatives to Cookies</h4>
<p class="docText">If the server wants to maintain context for the user's &quot;session&quot;, there are several approaches one might think of that the HTTP designers could have adopted:</p>
<ul><li><p class="docList">The server could attempt somehow to recognize a new TCP connection as belonging to some existing client-server &quot;session&quot;. It might be tempting to assume it could associate different TCP connections with the same session based on the IP address from which the request comes, but there might be many users on the same machine, all coming from the same IP address. Multiple users coming from the same IP address also results from requests going through the same proxy. If the server ever incorrectly assumed a request was part of a previous session, it would be similar to session hijacking; the new user would have the context of the previous user.</p></li><li><p class="docList">Perhaps the server could refine the algorithm for mapping TCP connections to sessions based on using both the IP address and TCP port from which the request comes. This would not work for many reasons. It is common for the user's browser to open multiple TCP connections, and each one would be assigned a different port. Also, a proxy might open a single connection to a server and interleave requests from multiple users on that same connection.</p><p class="docList">Therefore, different users might appear to the server as coming from the same IP address and port, and the same user might appear to the server as coming from different ports.</p></li><li><p class="docList">The server could dynamically generate the URLs on a page so that when you &quot;click&quot; from one page to the next, the target URL contains a session identifier and the page returned likewise has the session identifier in all of its embedded URLs. This approach would hurt performance, both because the server would have to generate all of those dynamic URLs and because web caches would not be able to share pages between different users' sessions.</p></li><li><p class="docList">The browser could include the user's name (or email address) in every request. This is even legal according to the HTTP specification (e.g., the from field). But users might want to browse anonymously.</p></li><li><p class="docList">The browser could generate a large random number each time a web surfing session was started. Call that number <span class="docEmphasis">X</span>. <span class="docEmphasis">X</span> could be sent in every request during a user's web surfing session. <span class="docEmphasis">X</span> would not identify the user, but would be used solely so that the server can associate multiple requests with the same web surfing session. This is a clever idea, but has security problems. If you typed your name and password at your stock broker's web site, and then <span class="docEmphasis">X</span> was used so that the server could recognize future requests as coming from you, then an eavesdropper could steal <span class="docEmphasis">X</span> and use it and be considered by your broker as authenticated as you.</p></li><li><p class="docList">People could have redesigned HTTP to keep state, so that interaction with a particular site would consist of an explicit connection similar to a TCP connection. But they didn't.</p></li></ul>
<p class="docText">Instead of these approaches, Netscape, in 1994, came up with the cookie design, a clever approach that solved the problem and sounded delicious.</p>
<a name="ch25lev2sec2"></a>
<h4 id="title-IDANQ5NM" class="docSection2Title">25.5.2. Cookie Rules</h4>
<p class="docText">The idea of a cookie is relatively simple. A server may, in any response, include a cookie. The client's browser is supposed to cache it and include it in future requests to the same site. The cookie might contain all the state necessary for maintaining the client's interaction with the server. For instance, it might contain all the items in the user's shopping basket. This form of cookie is useful when there are multiple related servers and no shared database, for instance, when there is a secure server that does checkout and takes credit cards and a less-protected one on which the user can browse the catalog. However, in order to prevent servers from taking up too much memory at the client, cookies are limited to 4K octets. So another solution is for the server to keep a database of all the information it needs about each of its current clients, and have the cookie value be an index into that database. Since there is no way to force users to &quot;log out&quot;, database entries must time out and might then be reused for a new user. That presents an opportunity for confusion if two users wind up with the same cookie.</p>
<p class="docText">When the server sends the cookie, it also specifies restrictions on who should receive the cookie. If it specifies a domain name (e.g., <span class="docEmphRomanAlt">dec.com</span>), then the cookie will be sent to any machine in that domain (<span class="docEmphRomanAlt">happy.dec.com</span>, <span class="docEmphRomanAlt">grumpy.dec.com</span>). The cookie designers were concerned about sites sharing information through cookies. If a cookie were allowed to be sent to any site, then it is trivial to track everything someone does during a web surfing session; the first site gives it a cookie with a unique ID, specifying that the cookie should be sent to every site the user visits. Then every site the user visits sees that unique ID. They could have specified that a cookie only go to the machine which sent it, but there are cases where a session involves a group of machines; e.g., one for browsing the catalog, another for ordering. There might even be multiple machines with the same information on it for load sharing. So the compromise is to allow the server to specify a &quot;domain&quot; in which the cookie would be returned. To prevent the domain over which the cookie could be shared from being too large, under some top level domains (<span class="docEmphRomanAlt">.com</span>, <span class="docEmphRomanAlt">.edu</span>, <span class="docEmphRomanAlt">.net</span>, <span class="docEmphRomanAlt">.org</span>, <span class="docEmphRomanAlt">.gov</span>, <span class="docEmphRomanAlt">.mil</span>, <span class="docEmphRomanAlt">.int</span>) there must be at least 2 dots, as in <span class="docEmphRomanAlt">foo.dec.com</span>. Under any of the other top level domains there must be at least three dots.</p>
<p class="docText">If no domain name is specified, then it only goes to the machine which sent it. It can also specify a path name (e.g., <span class="docEmphRomanAlt">/foo</span>), in which case the cookie will only be sent if the portion of the URL following the first single slash starts with the specified path name.</p>
<p class="docText">Cookies have lifetimes. Along with sending the cookie the server can specify when the cookie should be deleted, and whether it should be discarded when the browser terminates. Brows-ers might have the ability for users to specify restrictions on cookies, such as that all of them should be discarded when the browser terminates, or cookies from any site other than <span class="docEmphRomanAlt">xyz.com</span> should be discarded.</p>
<p class="docText">Cookies have received severe criticism from privacy advocates, but in theory they could be used as a privacy <span class="docEmphasis">enhancement</span>. Instead of storing state about the user on the server, the state would be given to the client to hold. If the server were broken into, there would be no client information to steal. But cookies are mostly not used that way. Information <span class="docEmphasis">is</span> stored at the server, and the cookie is just to index into that database.</p>
<a name="ch25lev2sec3"></a>
<h4 id="title-IDAAT5NM" class="docSection2Title">25.5.3. Tracking Users</h4>
<p class="docText">It may be possible to track everything that was done during a web surfing sessionÂwhich sites were visited, for instanceÂbut not to identify the actual individual. Just that someone did x, y, and z on Tuesday, November 4. Or it might be possible to track him through many sessions, so that the site knows this is user 78394, the same user who visited a month ago. Or it may be possible in some cases to figure out who the actual user isÂwhat his name is, where he lives, how old he is.</p>
<p class="docText">Correlating that the same entity visited multiple sites can be done by having those sites collude with each other, and share log information, or put information into the <span class="docEmphSmaller">REFERER</span> field or into URLs. This only tells these sites that <span class="docEmphasis">someone</span> did all those things. But that someone turns into a specific identifiable person if he authenticates to any of the colluding sites, perhaps by ordering something at an on-line merchant.</p>
<p class="docText">Why would anyone want to keep track of which sites a user visits? And why would anyone care if they did? Information is valuable, and can be sold. Even if it's not obvious what the information might be used for, there are sites that would like to collect it, just in case it proves valuable, e.g., for targeted advertising. Even if the profile of interests can't be traced to an individual, creating a profile for a class of individuals might be useful. For instance, ads for mail ordering live bait would probably not be particularly effective when displayed on a Martha Stewart web page devoted to hosting an elegant dinner party. It's possible that advertisers might figure this one out on their own, but by doing automated tracking of viewing history, they might find unexpected correlations.</p>
<p class="docText">A more frightening example is that insurance companies might want to know which individuals are browsing sites with medical information about serious diseases and on that basis deny coverage. Or information might be collected in order to embarrass an individual. A prominent American was once embarrassed by having someone publicize his history of video rentals.</p>
<p class="docText">Cookies take most of the heat for violating privacy. Legislation has even been proposed to outlaw cookies! But a lot of information is available even without cookies, and the design of cookies has attempted to prevent some of the more straightforward &quot;evil&quot; uses.</p>
<p class="docText">Cookies only go to the domain they are sent from. So how is it possible to correlate that the user who visited site A is the same user who visited site B? There are many ways of correlating information:</p>
<ul><li><p class="docText"><span class="docEmphRoman">Server logs.</span> Servers can (and do) keep track of requests they receive; when they occurred, what the request consisted of, and what IP address it came from. This doesn't necessarily track an individual user. Since the user might browse from different machines on different days, or even have the IP address of his machine dynamically assigned, a given user might be using different IP addresses at different times. With multi-user machines and proxies, many users might be coming in from the same IP address. With proxies, many requests can be satisfied from the cache, and the server will never see the request and therefore it cannot appear in the log. But the server log will still contain some information.</p></li><li><p class="docText"><span class="docEmphRoman">Eavesdropping.</span> It might be possible to collect information by observing traffic. Even with encryption, the packet headers give some information, such as which sites are talking to each other. But there is no single wire through which all Internet traffic flows, so eavesdropping will only collect a small sample of the traffic.</p></li><li><p class="docText"><span class="docEmphRoman">Proxy logs.</span> <a name="iddle2130"></a>A proxy can keep track of requests. It is common for an employer to log requests, as well as refuse connection to certain sites known to be non-business related. ISPs might also monitor web browsing patterns.</p></li><li><p class="docText"><span class="docEmphRoman">Redirects or embedded images.</span> Suppose two sites A and B have each given the user a cookie, so A knows the user as <span class="docEmphRomanAlt">userxyz</span>, and B knows him as <span class="docEmphRomanAlt">userqvj</span>. They would like to correlate that <span class="docEmphRomanAlt">userxyz</span>=<span class="docEmphRomanAlt">userqvj</span>. This can be done by having site A embed a redirect or an embedded image to B, tacking onto the end of the URL <span class="docEmphRomanAlt">userxyz</span>. When the user's browser visits site B, the URL will tell B that A knows the user by <span class="docEmphRomanAlt">userxyz</span> and the cookie that the user will return to B will tell B that this is the user B knows as <span class="docEmphRomanAlt">userqvj</span>. In particular, if there were a consortium of sites, one site, say C, could coordinate all the information, by having all consortium sites embed a redirect or embedded image to C on their web pages. The content to be fetched could be an invisible (1 pixel x 1 pixel) image known as a <span class="docEmphStrong">web bug.</span> A user would never notice a web bug except by examining the HTML source of the web page.</p></li><li><p class="docText"><span class="docEmphRoman">Software at the client.</span> Browsers keep some information about sites visited. If someone could install software at user Alice's machine, perhaps without her knowledge, everything she does can be logged, even if she is careful to use encryption.</p></li></ul>
<ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"><a href="16051538.html"><img src="btn_next_.gif" width="1" height="1" alt="Next" border="0" /></a> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch25lev1sec4.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch25lev1sec6.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>