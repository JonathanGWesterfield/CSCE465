<html><head><title>19.6. Computing the Keys</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top">Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch19lev1sec6"></a>
<h3 id="title-IDA0THAE" class="docSection1Title">19.6. Computing the Keys</h3>
<p class="docText">The secret <span class="docEmphasis">S</span> sent in the first exchange is the pre-master secret. It is shuffled with the two <span class="docEmphasis">R</span>s to produce the master secret <span class="docEmphasis">K</span>. In other words <span class="docEmphasis">K</span> =<span class="docEmphasis">f</span>(<span class="docEmphasis">S</span>,<span class="docEmphasis">R</span><sub>Alice</sub>,<span class="docEmphasis">R</span><sub>Bob</sub>). For each connection (including the first) the master secret is shuffled with the two <span class="docEmphasis">R</span>s to produce the six keys used for that connection (for each side: encryption, integrity, and IV), i.e., each of the keys is <span class="docEmphasis">g<sub>i</sub></span>(<span class="docEmphasis">K</span>,<span class="docEmphasis">R</span><sub>Alice</sub>,<span class="docEmphasis">R</span><sub>Bob</sub>).</p>
<p class="docText">Note that this is unnecessarily complex in the case of using RSA, since on the first connection, the <span class="docEmphasis">R</span>s get shuffled in twice. It would have been fine with RSA to just use <span class="docEmphasis">S</span> the way <span class="docEmphasis">K</span> is used; for each connection, combine <span class="docEmphasis">S</span> with that connection's <span class="docEmphasis">R</span>s to produce the six keys used for that connection. However, there are other authentication methods that would wind up always computing the same pre-master secret <span class="docEmphasis">S</span>. For instance, with Diffie-Hellman using a fixed Diffie-Hellman number as your public key, the same two parties (Alice and Bob) will always compute the same <span class="docEmphasis">S</span>. If <span class="docEmphasis">S</span> were kept around in memory, it's possible that malicious software might steal it. So it's safer to hash it with some nonces to produce <span class="docEmphasis">K</span> (the master secret), since if <span class="docEmphasis">K</span> is stolen, it will only affect communication between Alice and Bob during the single session.</p>
<p class="docText">The keyed hashes are keyed with <span class="docEmphasis">K</span>, and are sent protected with the data keys (i.e., encrypted using the encryption key and IV, and integrity-protected with the integrity key).</p>
<p class="docText">The <span class="docEmphasis">R</span>s are 32 octets long, and it is recommended (but not enforced) that the first 4 octets not be randomly chosen, but instead be the Unix time (seconds since January 1, 1970) when the message was generated. This ensures (assuming that at least a second has elapsed) that Alice and Bob will choose different 32-octet <span class="docEmphasis">R</span>s each time a session under the same master secret is resumed, even if their random number generators are really bad or they're <span class="docEmphasis">really</span> unlucky. If the same <span class="docEmphasis">R</span>s were chosen with the same master secret, an attacker might be able to successfully replay packets.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec5.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec7.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>