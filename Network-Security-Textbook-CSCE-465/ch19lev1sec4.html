<html><head><title>19.4. SSL/TLS Basic Protocol</title><title>TeamUnknown</title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/globalstyle.css" /><link href="includes/searchResults.css" rel="stylesheet" type="text/css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/style.css" /><link rel="STYLESHEET" type="text/css" href="portals/bvdep/xsltemplates/docsafari.css" /><body><table width="100%" border="0" cellspacing="0" cellpadding="0"><td class="docBookTitle"><a href="toc.html"><b>[ Team Unknown ]</b></a></td></table><td align="center"><a name="MainContent"></a><table width="95%"><tr><td align="left" class="v2"><!--Copyright (c) 2002 Safari Tech Books Online--><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><div id="section"><br /><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top"><a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a>Networking Security Networking Security Networking Security Security Networking Security Networking Security Networking Charlie Kaufman Radia Perlman Mike Speciner Prentice Hall Network Security: Private Communication in a Public World, Second Edition<a name="ch19lev1sec4"></a>
<h3 id="title-IDAPNPCK" class="docSection1Title">19.4. SSL/TLS Basic Protocol</h3>
<p class="docText">Using the reliable octet stream service provided by TCP, SSL/TLS partitions this octet stream into records, with headers and cryptographic protection, to provide a reliable, encrypted, and integrity-protected stream of octets to the application. There are four types of records: user data, handshake messages, alerts (error messages or notification of connection closure), and change cipher spec (which should be a handshake message, but they chose to make it a separate record type).</p>
<p class="docText">In the basic protocol the client (Alice) initiates contact with the server (Bob). Then Bob sends Alice his certificate. Alice verifies the certificate, extracts Bob's public key, picks a random number <span class="docEmphasis">S</span> from which the session keys will be computed, and sends <span class="docEmphasis">S</span> to Bob, encrypted with Bob's public key. Then the remainder of the session is encrypted and integrity-protected with those session keys. (There are actually six secrets computed when encryption algorithms that require IVs are usedÂfor each direction: integrity protection key, encryption key, and IV.) First we'll present a simplified form of the protocol, then discuss various issues in the full protocol, and finally discuss the details.</p>
<ul><li><p class="docText"><span class="docEmphRoman">Message 1.</span> Alice says she would like to talk (but doesn't identify herself), and gives a list of cryptographic algorithms she supports, along with a random number <span class="docEmphasis">R</span><sub>Alice</sub>, that will be combined with the <span class="docEmphasis">S</span> in message 3 to form the various keys.</p></li><li><p class="docText"><span class="docEmphRoman">Message 2.</span> Bob sends Alice his certificate, a random number <span class="docEmphasis">R</span><sub>Bob</sub> that will also contribute to the keys, and responds with one of the ciphers Alice listed in message 1 that Bob also supports.</p></li><li><p class="docText"><span class="docEmphRoman">Message 3.</span> Alice chooses a random number <span class="docEmphasis">S</span> (known as the <span class="docEmphStrong">pre-master secret</span>) and sends it, encrypted with Bob's public key. She also sends a hash of the <span class="docEmphStrong">master secret</span> <span class="docEmphasis">K</span> and the hand-shake messages, both to prove she knows the key and to ensure that tampering of the handshake messages would be detected. The hash is an (unnecessarily) complex function based on one of the early versions of HMAC. To ensure that the keyed hash Alice sends is different from the keyed hash Bob sends, each side includes a constant ASCII string in the hash. The initiator constant is <span class="docEmphRomanAlt">CLNT</span> in SSLv3 and <span class="docEmphRomanAlt">client finished</span> in TLS. The constant Bob will hash into the stew is <span class="docEmphRomanAlt">SRVR</span> in SSLv3 and <span class="docEmphRomanAlt">server finished</span> in TLS. Surprisingly (and unnecessarily), the keyed hash is sent encrypted and integrity-protected. The keys used for encrypting the keyed hash, like the rest of the data in the session will be, are derived from hashing <span class="docEmphasis">K</span>, <span class="docEmphasis">R</span><sub>Alice</sub>, and <span class="docEmphasis">R</span><sub>Bob</sub>. The keys used for transmission are known as <span class="docEmphasis">write</span> keys, and the keys used for receipt are known as <span class="docEmphasis">read</span> keys. So, for instance, Bob's write-encryption key is Alice's read-encryption key. The keys are encryption, integrity, and IV in each direction, so there are six keys derived. (In SSLv2 there are only two session keys, one in each direction, each used both for integrity protection and encryption.)</p><a name="ch19fig01"></a><p><center>
<h5 class="docFigureTitle">Protocol 19-1. (simplified) SSLv3/TLS</h5>
</center></p><p class="docText"><div class="v1"><a target="_blank" href="19fig01_alt.jpg">[View full size image]</a></div><img border="0" alt="" width="500" height="248" src="19fig01.jpg" /></p>
</li><li><p class="docText"><span class="docEmphRoman">Message 4.</span> Bob proves he knows the session keys, and ensures that the early messages arrived intact, by sending a keyed hash of all the handshake messages, encrypted with his write-encryption key, and integrity-protected with his write-integrity key. Since the session keys are derived from <span class="docEmphasis">S</span> this proves he knows Bob's private key, because he needed it in order to extract <span class="docEmphasis">S</span>.</p></li></ul>
<p class="docText">At this point, Alice has authenticated Bob, but Bob has no idea to whom he's talking. As deployed today, authentication is seldom mutualÂthe client authenticates the server but the server does not authenticate the client. In theory SSL/TLS could be used for mutual authentication and the protocol <a name="iddle1432"></a><a name="iddle1989"></a>allows optional authentication of the client if the client has a certificate. But in the most common case today, if the application on the server wishes to authenticate the user, it's usually done by having the user Alice send her name and password to the server Bob, cryptographically protected with the session keys.</p>
<a href="16051538.html"><img src="pixel.gif" alt="" width="1" height="1" border="0" /></a><ul></ul></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="middle" class="v2" height="5"><img src="pixel.gif" width="1" height="5" alt="" border="0" /></td></tr><tr><td valign="middle" class="v2"><table cellpadding="0" cellspacing="0" border="0" width="100%"><tr><td align="left"><span style="white-space:nowrap">&nbsp;</span>
                  &nbsp;
                  <span style="white-space:nowrap"> &nbsp;&nbsp;</span>
            &nbsp;<span style="white-space:nowrap">&nbsp;</span></td></tr></table></td><td></td><td valign="middle" class="v2" align="right"> 
          &nbsp;
          <span style="white-space:nowrap"><a target="_self" href="ch19lev1sec3.html" title="Previous section"><img border="0" align="absmiddle" src="btn_prev.gif" alt="Previous section" id="btn_prev" /></a></span>
				
				&nbsp;
				
				<span style="white-space:nowrap"><a target="_self" href="ch19lev1sec5.html" title="Next section"><img border="0" align="absmiddle" src="btn_next.gif" alt="Next section" id="btn_next" /></a></span></td></tr></table><table width="100%" border="0" cellspacing="0" cellpadding="2"><tr><td valign="top" align="right"><span style="white-space:nowrap"><a target="_self" href="#toppage" title="Top"></a></span></td></tr></table></div><!--IP User 2--></td></tr></table></td></body></head></html>